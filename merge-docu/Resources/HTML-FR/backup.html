<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="fr"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Sauvegarde · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="Une sauvegarde peut être déclenchée de trois manières :" name="description" /><meta content="fr" name="docsearch:language" /><meta content="Sauvegarde · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="Une sauvegarde peut être déclenchée de trois manières :" property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#backup.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Sauvegarde<a aria-hidden="true" class="anchor" id="backup.html"></a></h1></header><article><div><p><span>Une sauvegarde peut être déclenchée de trois manières:</span></p><ul><li><span>Manuellement, via la commande<strong>Sauvegarde...</strong> du menu <strong>Fichier</strong> de4D ou le bouton <strong>Sauvegarde</strong> du <a href="#backup.html">Centre de sécurité et de maintenance(CSM)</a>.</span></li><li><span>Automatiquement, via le programmateur paramétrable dansles Propriétés,</span></li><li><span>Par programmation, à l’aide de la commande<code>BACKUP</code>.</span></li></ul><blockquote><p><span>4D Server : Il est possible de déclencher “manuellement”une sauvegarde depuis un poste distant, via une méthode appelant lacommande <code>BACKUP</code>. Dans tous les cas, la commande seraexécutée sur le serveur.</span></p></blockquote><h2><span><a aria-hidden="true" class="anchor" id="backup.html_sauvegarde-manuelle"></a><a aria-hidden="true" class="hash-link" href="#backup.html_sauvegarde-manuelle"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Sauvegarde manuelle</span></h2><ol><li><span>Choisissez la commande <strong>Sauvegarde...</strong>dans le menu <strong>Fichier</strong> de 4D.<br />La fenêtre de sauvegarde s’affiche : <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/Backup/backup01.png" />Vous pouvez visualiser l'emplacement du dossier de sauvegarde àl'aide du pop up menu associé à la zone "Destination de lasauvegarde". Cet emplacement est défini dans la Page<strong>Sauvegarde/Configuration</strong> des Propriétés de labase.</span></li></ol><ul><li><span>Vous pouvez également sélectionner <a href="#overview.html">Centre de sécurité et de maintenance</a> de 4D etafficher la <a href="#backup.html">Page Sauvegarde</a>.</span></li></ul><p><span>Le bouton <strong>Propriétés de la base...</strong>provoque l’affichage de la boîte de dialogue des Propriétés destructure.</span></p><ol start="2"><li><span>Cliquez sur le bouton <strong>Sauvegarde</strong> pourdéclencher la sauvegarde avec les paramètres courants.</span></li></ol><h2><span><a aria-hidden="true" class="anchor" id="backup.html_sauvegarde-automatique-p%C3%A9riodique"></a><a aria-hidden="true"class="hash-link" href="#backup.html_sauvegarde-automatique-p%25C3%25A9riodique"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Sauvegarde automatique périodique</span></h2><p><span>Les sauvegardes périodiques sont déclenchéesautomatiquement. Elles sont configurées dans la Page<strong>Sauvegarde/Périodicité</strong> des<strong>Propriétés</strong>.</span></p><p><span>Les sauvegardes s'effectuent automatiquement au momentdéfini, sans intervention de l’utilisateur. Pour plusd’informations sur le fonctionnement de cette boîte de dialogue,reportez-vous à la section <a href="#backup.html_scheduler">Définirdes sauvegardes périodiques</a>.</span></p><h2><span><a aria-hidden="true" class="anchor" id="backup.html_commande-backup"></a><a aria-hidden="true" class="hash-link" href="#backup.html_commande-backup"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Commande BACKUP</span></h2><p><span>Lorsque la commande <code>BACKUP</code> est exécutéedepuis une méthode, la sauvegarde est alors déclenchée avec lesparamètres courants définis dans les propriétés. Vous pouvezutiliser la Méthode base <code>On Backup Startup</code> et <code>OnBackup Shutdown</code> afin de contrôler le déroulement de lasauvegarde (cf. le manuel <em>Langage de 4D</em>).</span></p><h2><span><a aria-hidden="true" class="anchor" id="backup.html_d%C3%A9roulement-de-la-sauvegarde"></a><a aria-hidden="true" class="hash-link" href="#backup.html_d%25C3%25A9roulement-de-la-sauvegarde"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Déroulement de la sauvegarde</span></h2><p><span>Une fois qu’une sauvegarde a été déclenchée, 4D afficheune boîte de dialogue comportant un thermomètre indiquant laprogression de l’opération :</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/Backup/backupProgress.png" /></span></p><p><span>Le thermomètre est également affiché en bas de la page<a href="#backup.html">“Sauvegarde” du CSM</a> si vous avez utilisécette boîte de dialogue.</span></p><p><span>Le bouton <strong>Arrêter</strong> permet à l’utilisateurd’interrompre la sauvegarde à tout instant (cf. paragraphe <a href="#backup.html_handling-backup-issues">En cas de problème au coursde la sauvegarde</a>).</span></p><p><span>Le compte-rendu de la dernière sauvegarde (succès ouéchec) est stocké dans la zone "Informations sur la dernièresauvegarde" dans la <a href="#backup.html">Page Sauvegarde duCSM</a> ou dans la <strong>Page de maintenance</strong> de 4DServer. Il est également enregistré dans le <strong>Backupjournal.txt</strong>.</span></p><h3><span><a aria-hidden="true" class="anchor" id="backup.html_acc%C3%A8s-%C3%A0-lapplication-durant-la-sauvegarde"></a><a aria-hidden="true"class="hash-link" href="#backup.html_acc%25C3%25A8s-%25C3%25A0-lapplication-durant-la-sauvegarde"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Accès à l'application durant la sauvegarde</span></h3><p><span>4D verrouille les process liés aux types de fichiersinclus dans la sauvegarde : si seul le fichier de structure estsauvegardé, l’accès à la structure est impossible mais l’accès auxdonnées est autorisé. Pendant la sauvegarde, les accès àl'application sont restreints par 4D en fonction ducontexte.</span></p><p><span>A l’inverse, si seul le fichier de données est sauvegardé,l’accès à la structure reste autorisé. Dans ce cas, lespossibilités d’accès à l'application sont les suivantes:</span></p><ul><li><span>Avec 4D version monoposte, l'application est verrouilléeen lecture et en écriture, tous les process sont gelés. Touteaction est alors impossible.</span></li><li><span>Avec 4D Server, l'application est verrouillée uniquementen écriture, les postes clients peuvent consulter les données. Siun poste client envoie une requête d’ajout, de suppression ou demodification au serveur, il obtient une fenêtre l’invitant àattendre la fin de la sauvegarde. Une fois l'applicationsauvegardée, la fenêtre disparaît d’elle-même et l’action estexécutée. Pour annuler la requête en cours et ne pas avoir àattendre la fin de la sauvegarde, il suffit de cliquer sur lebouton <strong>Annuler l’opération</strong>. Cependant, si l’actionen attente provient d’une méthode lancée avant la sauvegarde, ilest déconseillé de l’annuler car seules les opérations restant àeffectuer seront annulées. Or, une méthode “à moitié” exécutée peutconduire à des incohérences logiques dans les données. Lorsquel’action en attente provient d’une méthode et que l’utilisateurclique sur le bouton <strong>Annuler l’opération</strong>, 4DServer renvoie l’erreur -9976 (Cette commande ne peut être exécutéecar la base est en cours de sauvegarde).</span></li></ul><h3><span><a aria-hidden="true" class="anchor" id="backup.html_en-cas-de-probl%C3%A8me-au-cours-de-la-sauvegarde"></a><a aria-hidden="true"class="hash-link" href="#backup.html_en-cas-de-probl%25C3%25A8me-au-cours-de-la-sauvegarde"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>En cas de problème au cours de la sauvegarde</span></h3><p><span>Il est possible qu'une sauvegarde ne s’effectue pascorrectement. Les causes de l’échec peuvent être diverses :interruption par l’utilisateur, fichier joint introuvable, disquede destination défaillant, transaction non terminée, etc. 4D traitel'incident selon la cause de l'échec.</span></p><p><span>Dans tous les cas, le statut de la dernière sauvegarde(succès ou échec) est stocké dans la zone "Informations sur ladernière sauvegarde" dans la <a href="#backup.html">Page Sauvegardedu CSM</a> ou dans la <strong>Page de maintenance</strong> de 4DServer, ainsi que dans le <strong>Backupjournal.txt</strong>.</span></p><ul><li><span><strong>Interruption par l’utilisateur</strong> : lebouton <strong>Arrêter</strong> de la boîte de dialogue deprogression de la sauvegarde permet aux utilisateurs d’interromprela sauvegarde à tout instant. Dans ce cas, la copie des élémentsest stoppée et l'erreur 1406 est générée. Vous pouvez interceptercette erreur dans la Méthode base <code>On BackupShutdown</code>.</span></li><li><span><strong>Fichier joint introuvable</strong> : lorsqu’unfichier joint est introuvable, 4D effectue une sauvegarde partielle(sauvegarde des fichiers de l'application et des fichiers jointsaccessibles) et retourne une erreur.</span></li><li><span><strong>Sauvegarde impossible</strong> (disque plein ouprotégé en écriture, disque manquant, panne du disque, transactionnon terminée, projet non lancé au moment d’une sauvegardeautomatique périodique, etc.) : S’il s’agit du premier échec, 4Deffectuera ultérieurement une seconde tentative. Le délai d’attenteentre les deux tentatives est défini dans la Page<strong>Sauvegarde/Sauvegarde&amp; et Restitution</strong> desPropriétés. Si la seconde tentative échoue également, une boîte dedialogue d’alerte système est affichée et une erreur est générée.Vous pouvez intercepter cette erreur dans la Méthode base <code>OnBackup Shutdown</code>.</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="backup.html_journal-de-sauvegarde-backup-journal"></a><a aria-hidden="true"class="hash-link" href="#backup.html_journal-de-sauvegarde-backup-journal"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Journal de sauvegarde (Backup Journal)</span></h2><p><span>Pour faciliter le suivi et la vérification dessauvegardes, le module de sauvegarde résume chaque opérationeffectuée dans un fichier spécial, similaire à un journald'activité. Comme un manuel intégré, toutes les opérations de labase de données (sauvegardes, restaurations, intégrations defichiers d'historique) sont consignées dans ce fichier, qu’ellesaient été planifiées ou exécutées manuellement. La date et l'heureauxquelles ces opérations ont eu lieu sont également notées dans lejournal.</span></p><p><span>Le journal de sauvegarde s'appelle "BackupJournal[001].txt" et se trouve dans le dossier "Logs" du projet. Lejournal de sauvegarde peut être ouvert avec n'importe quel éditeurde texte.</span></p><h4><span><a aria-hidden="true" class="anchor" id="backup.html_gestion-de-la-taille-du-journal-de-sauvegarde"></a><a aria-hidden="true"class="hash-link" href="#backup.html_gestion-de-la-taille-du-journal-de-sauvegarde"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Gestion de la taille du journal de sauvegarde</span></h4><p><span>Dans certaines stratégies de sauvegarde (par exemple, dansle cas où de nombreuses pièces jointes sont sauvegardées), lejournal de sauvegarde peut rapidement atteindre une tailleimportante. Deux mécanismes peuvent être utilisés pour gérer cettetaille :</span></p><ul><li><span><strong>Sauvegarde automatique</strong> : Avant chaquesauvegarde, l'application examine la taille du fichier backupjournal courant. Si elle est supérieure à 10 Mo, le fichier courantest archivé et un nouveau fichier est créé avec le numéro [xxx]incrémenté, par exemple "Backup Journal[002] .txt”. Une fois lenuméro de fichier 999 atteint, la numérotation reprend à 1 et lesfichiers existants seront remplacés.</span></li><li><span><strong>Possibilité de réduire la quantité d'informationsenregistrées</strong> : Pour ce faire, il suffit de modifier lavaleur de la clé <code>VerboseMode</code> dans le fichier<em>Backup.4DSettings</em> du projet. Par défaut, cette clé estdéfinie sur True. Si vous définissez la valeur de cette clé surFalse, seules les informations principales sont stockées dans lejournal de sauvegarde : la date et l'heure du début de l'opérationet les éventuelles erreurs générées. Les clés XML concernant laconfiguration de la sauvegarde sont décrites dans le manuel<em>Sauvegarde des clés XML 4D</em>.</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="backup.html_backuphistoryjson"></a><a aria-hidden="true" class="hash-link" href="#backup.html_backuphistoryjson"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>backupHistory.json</span></h2><p><span>Toutes les informations concernant les dernièresopérations de sauvegarde et de restitution sont stockées dans lefichier <strong>backupHistory.json</strong> de l'application. Cedernier enregistre le chemin de chaque fichier sauvegardé (ycompris les pièces jointes) ainsi que le numéro, la date, l'heure,la durée et le statut de chaque opération. Afin de limiter lataille du fichier, le nombre d'opérations enregistrées et le nombrede sauvegardes disponibles ("Keep only the last X backup files")définies dans les propriétés de sauvegarde estidentique.</span></p><p><span>Le fichier <strong>backupHistory.json</strong> se situedans le dossier de destination de sauvegarde courant. Vous pouvezobtenir le chemin de ce fichier à l'aide de la déclaration suivante:</span></p><pre><span><code class="hljs css language-4d"><span class="hljs-variable">$backupHistory</span>:=<span class="hljs-function">Get 4D file</span>(Backup history file)</code></span></pre><blockquote><p><strong>ATTENTION</strong><br />La suppression ou le déplacement du fichier<strong>backupHistory.json</strong> entraînera la réinitialisationdu prochain numéro de sauvegarde. Le fichier<strong>backupHistory.json</strong> est formaté afin d'être utilisépar l'application 4D. Si vous recherchez un état lisible sur lesopérations de sauvegarde, le journal de sauvegarde sera plusprécis.</p></blockquote></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#overview.html"><span class="arrow-prev">←</span><span>Aperçu</span></a><a class="docs-next button" href="#settings.html"><span>Paramètres de sauvegarde</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#backup.html_sauvegarde-manuelle">Sauvegardemanuelle</a></li><li><a href="#backup.html_sauvegarde-automatique-p%25C3%25A9riodique">Sauvegardeautomatique périodique</a></li><li><a href="#backup.html_commande-backup">Commande BACKUP</a></li><li><a href="#backup.html_d%25C3%25A9roulement-de-la-sauvegarde">Déroulement dela sauvegarde</a><ul class="toc-headings"><li><a href="#backup.html_acc%25C3%25A8s-%25C3%25A0-lapplication-durant-la-sauvegarde">Accès à l'application durant la sauvegarde</a></li><li><a href="#backup.html_en-cas-de-probl%25C3%25A8me-au-cours-de-la-sauvegarde">En cas de problème au cours de la sauvegarde</a></li></ul></li><li><a href="#backup.html_journal-de-sauvegarde-backup-journal">Journal desauvegarde (Backup Journal)</a></li><li><a href="#backup.html_backuphistoryjson">backupHistory.json</a></li></ul></nav></div></div></body></html>