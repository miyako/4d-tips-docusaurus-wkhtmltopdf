<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="en"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Shared objects and collections · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="**Shared objects** and **shared collections** are specific [objects](/docs/Rx/en/Concepts/object.html) and [collections](/docs/Rx/en/Concepts/collection.html) whose contents are shared between processes. In contrast to [interprocess variables](/docs/Rx/en/Concepts/variables.html#interprocess-variables), shared objects and shared collections have the advantage of being compatible with **preemptive 4D processes**: they can be passed by reference as parameters to commands such as `New process` or `CALL WORKER`."name="description" /><meta content="en" name="docsearch:language" /><meta content="Shared objects and collections · 4D Documentation"property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="**Shared objects** and **shared collections** are specific [objects](/docs/Rx/en/Concepts/object.html) and [collections](/docs/Rx/en/Concepts/collection.html) whose contents are shared between processes. In contrast to [interprocess variables](/docs/Rx/en/Concepts/variables.html#interprocess-variables), shared objects and shared collections have the advantage of being compatible with **preemptive 4D processes**: they can be passed by reference as parameters to commands such as `New process` or `CALL WORKER`."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#shared.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Shared objects andcollections<a aria-hidden="true" class="anchor" id="shared.html"></a></h1></header><article><div><p><span><strong>Shared objects</strong> and <strong>sharedcollections</strong> are specific <a href="#object.html">objects</a> and <a href="#collection.html">collections</a> whose contents are sharedbetween processes. In contrast to <a href="#shared.html_interprocess-variables">interprocess variables</a>,shared objects and shared collections have the advantage of beingcompatible with <strong>preemptive 4D processes</strong>: they canbe passed by reference as parameters to commands such as <code>Newprocess</code> or <code>CALL WORKER</code>.</span></p><p><span>Shared objects and shared collections can be stored invariables declared with standard <code>C_OBJECT</code> and<code>C_COLLECTION</code> commands, but must be instantiated usingspecific commands:</span></p><ul><li><span>to create a shared object, use the <code>New sharedobject</code> command,</span></li><li><span>to create a shared collection, use the <code>New sharedcollection</code> command.</span></li></ul><p><span><strong>Note:</strong> Shared objects and collections canbe set as properties of standard (not shared) objects orcollections.</span></p><p><span>In order to modify a shared object/collection, the<strong>Use...End use</strong> structure must be called. Reading ashared object/collection value does not require <strong>Use...Enduse</strong>.</span></p><p><span>A unique, global catalog returned by the<code>Storage</code> command is always available throughout theapplication and its components, and can be used to store all sharedobjects and collections.</span></p><h2><span><a aria-hidden="true" class="anchor" id="shared.html_using-shared-objects-or-collections"></a><a aria-hidden="true"class="hash-link" href="#shared.html_using-shared-objects-or-collections"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Using shared objects or collections</span></h2><p><span>Once instantiated with the <code>New shared object</code>or <code>New shared collection</code> commands, sharedobject/collection properties and elements can be modified or readfrom any process of the application.</span></p><h3><span><a aria-hidden="true" class="anchor" id="shared.html_modification"></a><a aria-hidden="true" class="hash-link" href="#shared.html_modification"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Modification</span></h3><p><span>Modifications can be applied to shared objects and sharedcollections:</span></p><ul><li><span>adding or removing object properties,</span></li><li><span>adding or editing values (provided they are supported inshared objects), including other shared objects or collections(which creates a shared group, see below).</span></li></ul><p><span>However, all modification instructions in a shared objector collection must be surrounded by the <code>Use...End use</code>keywords, otherwise an error is generated.</span></p><pre><span><code class="hljs css language-4d"> <span class="hljs-variable">$s_obj</span>:=<span class="hljs-function">New shared object</span>(<span class="hljs-string">"prop1"</span>;<span class="hljs-string">"alpha"</span>)<span class="hljs-keyword"> Use</span>(<span class="hljs-variable">$s_obj</span>)    <span class="hljs-variable">$s_obj</span>.prop1:=<span class="hljs-string">"omega"</span> End<span class="hljs-keyword"> Use</span></code></span></pre><p>A shared object/collection can only be modified by one processat a time. <code>Use</code> locks the shared object/collection fromother threads, while <code>End use</code> unlocks the sharedobject/collection (if the locking counter is at 0, see below). .Trying to modify a shared object/collection without at least one<code>Use...End use</code> generates an error. When a process calls<code>Use...End use</code> on a shared object/collection that isalready in use by another process, it is simply put on hold untilthe <code>End use</code> unlocks it (no error is generated).Consequently, instructions within <code>Use...End use</code>structures should execute quickly and unlock the elements as soonas possible. Thus, it is strongly advised to avoid modifying ashared object or collection directly from the interface, e.g.through a dialog box.</p><p>Assigning shared objects/collections to properties or elementsof other shared objects/collections is allowed and creates<strong>shared groups</strong>. A shared group is automaticallycreated when a shared object/collection is set as property value orelement of another shared object/collection. Shared groups allownesting shared objects and collections but enforce additionalrules:</p><ul><li>Calling <code>Use</code> on a shared object/collectionbelonging to a group locks properties/elements of all sharedobjects/collections of the group and increments its lockingcounter. Calling <code>End use</code> decrements the lockingcounter of the group and when the counter is at 0, all the linkedshared objects/collections are unlocked.</li><li>A shared object/collection can only belong to one shared group.An error is returned if you try to set an already grouped sharedobject/collection to a different group.</li><li>Grouped shared objects/collections cannot be ungrouped. Onceincluded in a shared group, a shared object/collection is linkedpermanently to that group during the whole session. Even if allreferences of an object/collection are removed from the parentobject/collection, they will remain linked.</li></ul><p>Please refer to example 2 for an illustration of shared grouprules.</p><p><strong>Note:</strong> Shared groups are managed through aninternal property named <em>locking identifier</em>. For detailedinformation on this value, please refer to the 4D Developer'sguide.</p><h3><a aria-hidden="true" class="anchor" id="shared.html_read"></a><a aria-hidden="true" class="hash-link"href="#shared.html_read"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Read</h3><p>Reading properties or elements of a shared object/collection isallowed without having to call the <code>Use...End use</code>structure, even if the shared object/collection is in use byanother process.</p><p>However, it is necessary to read a shared object/collectionwithin <code>Use...End use</code> when several values are linkedtogether and must be read at once, for consistency reasons.</p><h3><a aria-hidden="true" class="anchor" id="shared.html_duplication"></a><a aria-hidden="true" class="hash-link" href="#shared.html_duplication"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Duplication</h3><p>Calling <code>OB Copy</code> with a shared object (or with anobject containing shared object(s) as properties) is possible, butwill return a standard (not shared) object including its containedobjects (if any).</p><h3><a aria-hidden="true" class="anchor" id="shared.html_storage"></a><a aria-hidden="true" class="hash-link"href="#shared.html_storage"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Storage</h3><p><strong>Storage</strong> is a unique shared object,automatically available on each application and machine. Thisshared object is returned by the <code>Storage</code> command. Youcan use this object to reference all shared objects/collectionsdefined during the session that you want to be available from anypreemptive or standard processes.</p><p>Note that, unlike standard shared objects, the<code>storage</code> object does not create a shared group whenshared objects/collections are added as its properties. Thisexception allows the <strong>Storage</strong> object to be usedwithout locking all connected shared objects or collections.</p><p>For more information, refer to the <code>Storage</code> commanddescription.</p><h2><a aria-hidden="true" class="anchor" id="shared.html_useend-use"></a><a aria-hidden="true" class="hash-link" href="#shared.html_useend-use"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Use...End use</h2><p>The formal syntax of the <code>Use...End use</code> structureis:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> Use</span>(Shared_object_or_Shared_collection)<span class="hljs-function">    statement</span>(s)<span class="hljs-keyword"> End use</span></code></pre><p>The <code>Use...End use</code> structure defines a sequence ofstatements that will execute tasks on the<em>Shared_object_or_Shared_collection</em> parameter under theprotection of an internal semaphore.<em>Shared_object_or_Shared_collection</em> can be any valid sharedobject or shared collection.</p><p>Shared objects and shared collections are designed to allowcommunication between processes, in particular, <strong>preemptive4D processes</strong>. They can be passed by reference asparameters from a process to another one. For detailed informationon shared objects or shared collections, refer to the<strong>Shared objects and shared collections</strong> page.Surrounding modifications on shared objects or shared collectionsby the <code>Use...End use</code> keywords is mandatory to preventconcurrent access between processes.</p><ul><li>Once the <strong>Use</strong> line is successfully executed,all <em>Shared_object_or_Shared_collection</em> properties/elementsare locked for all other process in write access until thecorresponding <code>End use</code> line is executed.</li><li>The <em>statement(s)</em> sequence can execute any modificationon the Shared_object_or_Shared_collection properties/elementswithout risk of concurrent access.</li><li>If another shared object or collection is added as a propertyof the <em>Shared_object_or_Shared_collection</em> parameter, theybecome connected within the same shared group (see <strong>Usingshared objects or collections</strong>).</li><li>If another process tries to access one of the<em>Shared_object_or_Shared_collection</em> properties or connectedproperties while a <strong>Use...End use</strong> sequence is beingexecuted, it is automatically put on hold and waits until thecurrent sequence is terminated.</li><li>The <strong>End use</strong> line unlocks the<em>Shared_object_or_Shared_collection</em> properties and allobjects of the same group.</li><li>Several <strong>Use...End use</strong> structures can be nestedin the 4D code. In the case of a group, each <strong>Use</strong>increments the locking counter of the group and each <strong>Enduse</strong> decrements it; all properties/elements will bereleased only when the last <strong>End use</strong> call sets thelocking counter to 0.</li></ul><p><strong>Note:</strong> If a collection method modifies a sharedcollection, an internal <strong>Use</strong> is automaticallycalled for this shared collection while the function isexecuted.</p><h2><a aria-hidden="true" class="anchor" id="shared.html_example-1"></a><a aria-hidden="true" class="hash-link"href="#shared.html_example-1"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Example 1</h2><p>You want to launch several processes that perform an inventorytask on different products and update the same shared object. Themain process instantiates an empty shared object and then, launchesthe other processes, passing the shared object and the products tocount as parameters:</p><pre><code class="hljs css language-4d"><span class="hljs-function"> ARRAY TEXT</span>(<span class="hljs-variable">$_items</span>;<span class="hljs-number">0</span>) ... <span class="hljs-comment">//fill the array with items to count</span> <span class="hljs-variable">$nbItems</span>:=<span class="hljs-function">Size of array</span>(<span class="hljs-variable">$_items</span>)<span class="hljs-function"> C_OBJECT</span>(<span class="hljs-variable">$inventory</span>) <span class="hljs-variable">$inventory</span>:=New shared object<span class="hljs-keyword"> Use</span>(<span class="hljs-variable">$inventory</span>)    <span class="hljs-variable">$inventory</span>.nbItems:=<span class="hljs-variable">$nbItems</span><span class="hljs-keyword"> End use</span>   <span class="hljs-comment">//Create processes</span><span class="hljs-keyword"> For</span>(<span class="hljs-variable">$i</span>;<span class="hljs-number">1</span>;<span class="hljs-variable">$nbItems</span>)    <span class="hljs-variable">$ps</span>:=<span class="hljs-function">New process</span>(<span class="hljs-string">"HowMany"</span>;<span class="hljs-number">0</span>;<span class="hljs-string">"HowMany_"</span>+<span class="hljs-variable">$_items{</span><span class="hljs-variable">$i}</span>;<span class="hljs-variable">$_items{</span><span class="hljs-variable">$i}</span>;<span class="hljs-variable">$inventory</span>)  <span class="hljs-comment">//$inventory object sent by reference</span><span class="hljs-keyword"> End for</span></code></pre><p>In the "HowMany" method, inventory is done and the $inventoryshared object is updated as soon as possible:</p><pre><code class="hljs css language-4d"><span class="hljs-function"> C_TEXT</span>(<span class="hljs-variable">$1</span>)<span class="hljs-function"> C_TEXT</span>(<span class="hljs-variable">$what</span>)<span class="hljs-function"> C_OBJECT</span>(<span class="hljs-variable">$2</span>)<span class="hljs-function"> C_OBJECT</span>(<span class="hljs-variable">$inventory</span>) <span class="hljs-variable">$what</span>:=<span class="hljs-variable">$1 </span><span class="hljs-comment">//for better readability</span> <span class="hljs-variable">$inventory</span>:=<span class="hljs-variable">$2</span>  <span class="hljs-variable">$count</span>:=<span class="hljs-function">CountMethod</span>(<span class="hljs-variable">$what</span>) <span class="hljs-comment">//method to count products</span><span class="hljs-keyword"> Use</span>(<span class="hljs-variable">$inventory</span>) <span class="hljs-comment">//use shared object</span>    <span class="hljs-variable">$inventory</span>[<span class="hljs-variable">$what</span>]:=<span class="hljs-variable">$count  </span><span class="hljs-comment">//save the results for this item</span><span class="hljs-keyword"> End use</span></code></pre><h2><a aria-hidden="true" class="anchor" id="shared.html_example-2"></a><a aria-hidden="true" class="hash-link"href="#shared.html_example-2"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Example 2</h2><p>The following examples highlight specific rules when handlingshared groups:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$ob1</span>:=New shared object <span class="hljs-variable">$ob2</span>:=New shared object<span class="hljs-keyword"> Use</span>(<span class="hljs-variable">$ob1</span>)    <span class="hljs-variable">$ob1</span>.a:=<span class="hljs-variable">$ob2  </span><span class="hljs-comment">//group 1 is created</span><span class="hljs-keyword"> End use</span>  <span class="hljs-variable">$ob3</span>:=New shared object <span class="hljs-variable">$ob4</span>:=New shared object<span class="hljs-keyword"> Use</span>(<span class="hljs-variable">$ob3</span>)    <span class="hljs-variable">$ob3</span>.a:=<span class="hljs-variable">$ob4  </span><span class="hljs-comment">//group 2 is created</span><span class="hljs-keyword"> End use</span><span class="hljs-keyword">  Use</span>(<span class="hljs-variable">$ob1</span>) <span class="hljs-comment">//use an object from group 1</span>    <span class="hljs-variable">$ob1</span>.b:=<span class="hljs-variable">$ob4  </span><span class="hljs-comment">//ERROR</span>  <span class="hljs-comment">//$ob4 already belongs to another group</span>  <span class="hljs-comment">//assignment is not allowed</span><span class="hljs-keyword"> End use</span><span class="hljs-keyword">  Use</span>(<span class="hljs-variable">$ob3</span>)    <span class="hljs-variable">$ob3</span>.a:=<span class="hljs-literal">Null</span> <span class="hljs-comment">//remove any reference to $ob4 from group 2</span><span class="hljs-keyword"> End use</span><span class="hljs-keyword">  Use</span>(<span class="hljs-variable">$ob1</span>) <span class="hljs-comment">//use an object from group 1</span>    <span class="hljs-variable">$ob1</span>.b:=<span class="hljs-variable">$ob4  </span><span class="hljs-comment">//ERROR</span>  <span class="hljs-comment">//$ob4 still belongs to group 2</span>  <span class="hljs-comment">//assignment is not allowed</span><span class="hljs-keyword"> End use</span></code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#parameters.html"><span class="arrow-prev">←</span><span>Parameters</span></a><a class="docs-next button" href="#classes.html"><span>Classes</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#shared.html_using-shared-objects-or-collections">Using sharedobjects or collections</a><ul class="toc-headings"><li><a href="#shared.html_modification">Modification</a></li><li><a href="#shared.html_read">Read</a></li><li><a href="#shared.html_duplication">Duplication</a></li><li><a href="#shared.html_storage">Storage</a></li></ul></li><li><a href="#shared.html_useend-use">Use...End use</a></li><li><a href="#shared.html_example-1">Example 1</a></li><li><a href="#shared.html_example-2">Example 2</a></li></ul></nav></div></div></body></html>