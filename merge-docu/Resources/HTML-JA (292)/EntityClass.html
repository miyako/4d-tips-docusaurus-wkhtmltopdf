<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="ja"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Entity · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="レコードとテーブルの関係と同様に、[エンティティ](/docs/Rx/ja/ORDA/dsmapping.html#エンティティ) は [データクラス](/docs/Rx/ja/ORDA/dsmapping.html#データクラス) のインスタンスです。 エンティティはデータクラスと同じ属性を持つほか、データ値や、特有のプロパティおよび関数を持ちます。"name="description" /><meta content="ja" name="docsearch:language" /><meta content="Entity · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="レコードとテーブルの関係と同様に、[エンティティ](/docs/Rx/ja/ORDA/dsmapping.html#エンティティ) は [データクラス](/docs/Rx/ja/ORDA/dsmapping.html#データクラス) のインスタンスです。 エンティティはデータクラスと同じ属性を持つほか、データ値や、特有のプロパティおよび関数を持ちます。"property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#EntityClass.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Entity<a aria-hidden="true" class="anchor" id="EntityClass.html"></a></h1></header><article><div><p><span>レコードとテーブルの関係と同様に、<a href="#EntityClass.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3">エンティティ</a>は <a href="#EntityClass.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25B9">データクラス</a> のインスタンスです。エンティティはデータクラスと同じ属性を持つほか、データ値や、特有のプロパティおよび関数を持ちます。</span></p><h3><span><a aria-hidden="true" class="anchor" id="EntityClass.html_%E6%A6%82%E8%A6%81"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E6%25A6%2582%25E8%25A6%2581"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>概要</span></h3><table><thead><tr><th></th></tr></thead><tbody><tr><td><a href="#EntityClass.html_attributename"><strong><em>.attributeName</em></strong>: any</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティの属性値を格納します</p></td></tr><tr><td><a href="#EntityClass.html_clone"><strong>.clone()</strong> :4D.Entity</a><p>&nbsp;&nbsp;&nbsp;&nbsp;対象エンティティと同じレコードを参照する新規エンティティをメモリ内に作成します</p></td></tr><tr><td><a href="#EntityClass.html_diff"><strong>.diff</strong>(<em>entityToCompare</em> : 4D.Entity { ;<em>attributesToCompare</em> : Collection } ) : Collection</a><p>&nbsp;&nbsp;&nbsp;&nbsp;二つのエンティティの中身を比較し、その差異を返します</p></td></tr><tr><td><a href="#EntityClass.html_drop"><strong>.drop</strong>({<em>mode</em> : Integer} ) : Object</a><p>&nbsp;&nbsp;&nbsp;&nbsp;データストアのエンティティに格納されているデータを削除します</p></td></tr><tr><td><a href="#EntityClass.html_first"><strong>.first()</strong>:4D.Entity</a><p>&nbsp;&nbsp;&nbsp;&nbsp;対象エンティティが所属するエンティティセレクションの先頭エンティティへの参照を返します</p></td></tr><tr><td><a href="#EntityClass.html_fromobject"><strong>.fromObject</strong>(<em>filler</em> : Object )</a><p>&nbsp;&nbsp;&nbsp;&nbsp;<em>filler</em>に指定した内容でエンティティの属性値を設定します</p></td></tr><tr><td><a href="#EntityClass.html_getdataclass"><strong>.getDataClass()</strong> :4D.DataClass</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティのデータクラスを返します</p></td></tr><tr><td><a href="#EntityClass.html_getkey"><strong>.getKey</strong>( {<em>mode</em> : Integer } ) : Text<br /><strong>.getKey</strong>( { <em>mode</em> : Integer } ) :Integer</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティのプライマリーキー値を返します</p></td></tr><tr><td><a href="#EntityClass.html_getremotecontextattributes"><strong>.getRemoteContextAttributes()</strong>: Text</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティによって使われている最適化コンテキストの情報を返します</p></td></tr><tr><td><a href="#EntityClass.html_getselection"><strong>.getSelection()</strong>:4D.EntitySelection</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティが所属するエンティティセレクションを返します</p></td></tr><tr><td><a href="#EntityClass.html_getstamp"><strong>.getStamp()</strong> :Integer</a><p>&nbsp;&nbsp;&nbsp;&nbsp; エンティティのスタンプの値を返します</p></td></tr><tr><td><a href="#EntityClass.html_indexof"><strong>.indexOf</strong>({ <em>entitySelection</em> : 4D.EntitySelection } ) : Integer</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティセレクション内におけるエンティティの位置を返します</p></td></tr><tr><td><a href="#EntityClass.html_isnew"><strong>.isNew()</strong> :Boolean</a><p>&nbsp;&nbsp;&nbsp;&nbsp; 対象エンティティが作成されたばかりで、まだデータストアに保存されていない場合にtrue を返します</p></td></tr><tr><td><a href="#EntityClass.html_last"><strong>.last()</strong> :4D.Entity</a><p>&nbsp;&nbsp;&nbsp;&nbsp;対象エンティティが所属するエンティティセレクションの最終エンティティへの参照を返します</p></td></tr><tr><td><a href="#EntityClass.html_lock"><strong>.lock</strong>( {<em>mode</em> : Integer } ) : Object</a><p>&nbsp;&nbsp;&nbsp;&nbsp;対象エンティティが参照するレコードにペシミスティック・ロックをかけます</p></td></tr><tr><td><a href="#EntityClass.html_next"><strong>.next()</strong> :4D.Entity</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティが所属するエンティティセレクションの次のエンティティへの参照を返します</p></td></tr><tr><td><a href="#EntityClass.html_previous"><strong>.previous()</strong> :4D.Entity</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティが所属するエンティティセレクションの前のエンティティへの参照を返します</p></td></tr><tr><td><a href="#EntityClass.html_reload"><strong>.reload()</strong> :Object</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティの中身をメモリ内にリロードします</p></td></tr><tr><td><a href="#EntityClass.html_save"><strong>.save</strong>( {<em>mode</em> : Integer } ) : Object</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティの変更内容を保存します</p></td></tr><tr><td><a href="#EntityClass.html_toobject"><strong>.toObject</strong>() :Object<br /><strong>.toObject</strong>( <em>filterString</em> : Text { ;<em>options</em> : Integer} ) : Object<br /><strong>.toObject</strong>( <em>filterCol</em> : Collection { ;<em>options</em> : Integer } ) : Object</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティからビルトされたオブジェクトを返します</p></td></tr><tr><td><a href="#EntityClass.html_touched"><strong>.touched()</strong>: Boolean</a><p>&nbsp;&nbsp;&nbsp;&nbsp;エンティティがメモリに読み込まれてから、あるいは保存されてから、エンティティ属性が変更されたかどうかをテストします</p></td></tr><tr><td><a href="#EntityClass.html_touchedattributes"><strong>.touchedAttributes()</strong>: Collection</a><p>&nbsp;&nbsp;&nbsp;&nbsp;メモリに読み込み後に変更されたエンティティの属性名を返します</p></td></tr><tr><td><a href="#EntityClass.html_unlock"><strong>.unlock()</strong> :Object</a><p>&nbsp;&nbsp;&nbsp;&nbsp;対象エンティティが参照するレコードのペシミスティック・ロックを解除します</p></td></tr></tbody></table><h2><span><a aria-hidden="true" class="anchor" id="EntityClass.html_attributename"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_attributename"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.<em>attributeName</em></span></h2><details><summary><span>履歴</span></summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><span><strong><em>.attributeName</em></strong> : any</span></p><h4><span><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</span></h4><p><span>データクラス属性はすべてエンティティのプロパティとして利用可能です。各エンティティのプロパティは、当該エンティティの属性値を格納します。</span></p><blockquote><p><span>データクラス属性は [ ] を使用したシンタックスを使用することでもアクセス可能です。</span></p></blockquote><p><span>この属性値タイプは属性の種類 (<a href="#EntityClass.html_kind"></a>.kind; リレーションまたはストレージ)によります。</span></p><ul><li><span><em>attributeName</em> で指定した属性がストレージ型の場合:<code>.attributeName</code>は <em>attributeName</em>と同じ型の値を返します。</span></li><li><span><em>attributeName</em> で指定した属性がリレートエンティティ型の場合:<code>.attributeName</code> はリレートエンティティを返します。リレートエンティティの値は、ドット記法でプロパティを繋げることでアクセス可能です。例:"myEntity.employer.employees[0].lastname"</span></li><li><span><em>attributeName</em> で指定した属性がリレートエンティティズ型の場合:<code>.attributeName</code> はリレートエンティティの新しいエンティティセレクションを返します。重複しているエンティティは取り除かれます (返されるのは順列なしのエンティティセレクションです)。</span></li></ul><h4><span><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</span></h4><pre><span><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$myEntity </span>: cs.EmployeeEntity <span class="hljs-variable">$myEntity</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-comment">// エンティティを新規作成します</span> <span class="hljs-variable">$myEntity</span>.name:=<span class="hljs-string">"Dupont"</span> <span class="hljs-comment">// 'Dupont' を 'name' 属性に代入します</span> <span class="hljs-variable">$myEntity</span>.firstname:=<span class="hljs-string">"John"</span> <span class="hljs-comment">// 'John' を 'firstname' 属性に代入します</span> <span class="hljs-variable">$myEntity</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">// エンティティを保存します</span></code></span></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_clone"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_clone"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.clone()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.clone()</strong> : 4D.Entity</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.Entity</td><td style="text-align:center">&lt;-</td><td>同レコードを参照する新しいエンティティ</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.clone()</code> 関数は、対象エンティティと同じレコードを参照する新規エンティティをメモリ内に作成します。このメソッドを使用するとエンティティを個別に更新することができます。</p><blockquote><p>エンティティに対して何らかの変更をおこなった場合、それらは <a href="#EntityClass.html_save"><code>.save( )</code></a>関数が実行されたときのみ、参照先のレコードに保存されるという点に注意してください。</p></blockquote><p>この関数は、すでにデータベースに保存されているエンティティに対してのみ使用可能です。新規に作成されたエンティティ(<a href="#EntityClass.html_isnew"><code>.isNew()</code></a> が<strong>true</strong> を返すもの) に対して呼び出すことはできません。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$emp</span>; <span class="hljs-variable">$empCloned </span>: cs.EmployeeEntity <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">672</span>) <span class="hljs-variable">$empCloned</span>:=<span class="hljs-variable">$emp</span>.<span class="hljs-function">clone</span>() <span class="hljs-variable">$emp</span>.lastName:=<span class="hljs-string">"Smith"</span> <span class="hljs-comment">// $emp に対する変更は $empCloned には適用されません</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_diff"></a><a aria-hidden="true" class="hash-link"href="#EntityClass.html_diff"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.diff()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.diff</strong>( <em>entityToCompare</em> : 4D.Entity { ;<em>attributesToCompare</em> : Collection } ) : Collection</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>entityToCompare</td><td>4D.Entity</td><td style="text-align:center">-&gt;</td><td>対象エンティティと比較するエンティティ</td></tr><tr><td>attributesToCompare</td><td>Collection</td><td style="text-align:center">-&gt;</td><td>比較する属性の名称</td></tr><tr><td>戻り値</td><td>Collection</td><td style="text-align:center">&lt;-</td><td>エンティティ間の差異</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-2"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-2"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.diff()</code> 関数は、 二つのエンティティの中身を比較し、その差異を返します。</p><p><em>entityToCompare</em> には、オリジナルのエンティティと比較をするエンティティを渡します。</p><p><em>attributesToCompare</em> 引数で、比較する属性を指定することができます。これを渡した場合、指定された属性に対してのみ比較がおこなわれます。 省略時には、エンティティ間の差異がすべて返されます。</p><p>エンティティの差異は、以下のプロパティを持つオブジェクトのコレクションとして返されます:</p><table><thead><tr><th>プロパティ名</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>attributeName</td><td>String</td><td>属性名</td></tr><tr><td>value</td><td>any - 属性の型による</td><td>オリジナルエンティティの属性値</td></tr><tr><td>otherValue</td><td>any - 属性の型による</td><td><em>entityToCompare</em> の属性値</td></tr></tbody></table><p>コレクションに含まれるのは異なる値を持っていた属性のみです。 差異が見つからない場合、<code>diff()</code>は空のコレクションを返します。</p><p>この関数は、種類 (<a href="#EntityClass.html_kind">kind</a>) が<strong>storage</strong> あるいは <strong>relatedEntity</strong>であるプロパティに適用されます。 リレート先のエンティティそのものが変更された場合(外部キーの変更)、リレーションの名称とそのプライマリーキー名が <em>attributeName</em> プロパティに返されます(リレーション名についての <em>value</em> および <em>otherValue</em> は空になります)。</p><p>比較するどちらかのエンティティが <strong>Null</strong> である場合、エラーが生成されます。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 1</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$diff1</span>; <span class="hljs-variable">$diff2 </span>: Collection employee:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"ID=1001"</span>).<span class="hljs-function">first</span>() <span class="hljs-variable">$clone</span>:=employee.<span class="hljs-function">clone</span>() employee.firstName:=<span class="hljs-string">"MARIE"</span> employee.lastName:=<span class="hljs-string">"SOPHIE"</span> employee.salary:=<span class="hljs-number">500</span> <span class="hljs-variable">$diff1</span>:=<span class="hljs-variable">$clone</span>.<span class="hljs-function">diff</span>(employee) <span class="hljs-comment">// すべての差異が返されます</span> <span class="hljs-variable">$diff2</span>:=<span class="hljs-variable">$clone</span>.<span class="hljs-function">diff</span>(employee;New collection<span class="hljs-string">"firstName"</span>;<span class="hljs-string">"lastName"</span>))  <span class="hljs-comment">// firstName と lastName についての差異のみが返されます</span></code></pre><p>$diff1:</p><pre><code class="hljs css language-4d">[    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"firstName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Natasha"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"MARIE"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"lastName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Locke"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"SOPHIE"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"salary"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-number">66600</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-number">500</span>    }]<span class="hljs-variable">$diff2</span>:[    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"firstName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Natasha"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"MARIE"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"lastName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Locke"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"SOPHIE"</span>    }]</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-2"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-2"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 2</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> vCompareResult1; vCompareResult2; vCompareResult3; <span class="hljs-variable">$attributesToInspect </span>: Collection vCompareResult1:=New collection vCompareResult2:=New collection vCompareResult3:=New collection <span class="hljs-variable">$attributesToInspect</span>:=New collection <span class="hljs-variable">$e1</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">636</span>) <span class="hljs-variable">$e2</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">636</span>) <span class="hljs-variable">$e1</span>.firstName:=<span class="hljs-variable">$e1</span>.firstName+<span class="hljs-string">" update"</span> <span class="hljs-variable">$e1</span>.lastName:=<span class="hljs-variable">$e1</span>.lastName+<span class="hljs-string">" update"</span> <span class="hljs-variable">$c</span>:=ds.Company.<span class="hljs-function">get</span>(<span class="hljs-number">117</span>) <span class="hljs-variable">$e1</span>.employer:=<span class="hljs-variable">$c</span> <span class="hljs-variable">$e2</span>.salary:=<span class="hljs-number">100</span> <span class="hljs-variable">$attributesToInspect</span>.<span class="hljs-function">push</span>(<span class="hljs-string">"firstName"</span>) <span class="hljs-variable">$attributesToInspect</span>.<span class="hljs-function">push</span>(<span class="hljs-string">"lastName"</span>) vCompareResult1:=<span class="hljs-variable">$e1</span>.<span class="hljs-function">diff</span>(<span class="hljs-variable">$e2</span>) vCompareResult2:=<span class="hljs-variable">$e1</span>.<span class="hljs-function">diff</span>(<span class="hljs-variable">$e2</span>;<span class="hljs-variable">$attributesToInspect</span>) vCompareResult3:=<span class="hljs-variable">$e1</span>.<span class="hljs-function">diff</span>(<span class="hljs-variable">$e2</span>;<span class="hljs-variable">$e1</span>.<span class="hljs-function">touchedAttributes</span>())</code></pre><p>vCompareResult1 (すべての差異が返されています):</p><pre><code class="hljs css language-4d">[    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"firstName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Karla update"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"Karla"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"lastName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Marrero update"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"Marrero"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"salary"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-number">33500</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-number">100</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"employerID"</span>, <span class="hljs-comment">// プライマリーキー名</span>        <span class="hljs-string">"value"</span>: <span class="hljs-number">117</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-number">118</span>    },  {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"employer"</span>, <span class="hljs-comment">// リレーション名</span>        <span class="hljs-string">"value"</span>: <span class="hljs-string">"[object Entity]"</span>,<span class="hljs-comment">// Company のエンティティ 117</span>        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"[object Entity]"</span><span class="hljs-comment">// Company のエンティティ 118</span>    }]</code></pre><p>vCompareResult2 ($attributesToInspect についての差異のみ返されます)</p><pre><code class="hljs css language-4d">[    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"firstName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Karla update"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"Karla"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"lastName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Marrero update"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"Marrero"</span>    }]</code></pre><p>vCompareResult3 ($e1 において更新された (touch された) 属性のみが返されます)</p><pre><code class="hljs css language-4d">[    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"firstName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Karla update"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"Karla"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"lastName"</span>,        <span class="hljs-string">"value"</span>: <span class="hljs-string">"Marrero update"</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"Marrero"</span>    },    {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"employerID"</span>, <span class="hljs-comment">// プライマリーキー名</span>        <span class="hljs-string">"value"</span>: <span class="hljs-number">117</span>,        <span class="hljs-string">"otherValue"</span>: <span class="hljs-number">118</span>    },     {        <span class="hljs-string">"attributeName"</span>: <span class="hljs-string">"employer"</span>, <span class="hljs-comment">// リレーション名</span>        <span class="hljs-string">"value"</span>: <span class="hljs-string">"[object Entity]"</span>,<span class="hljs-comment">// Company のエンティティ 117</span>        <span class="hljs-string">"otherValue"</span>: <span class="hljs-string">"[object Entity]"</span><span class="hljs-comment">// Company のエンティティ 118</span>    }]</code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_drop"></a><a aria-hidden="true" class="hash-link"href="#EntityClass.html_drop"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.drop()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.drop</strong>( {<em>mode</em> : Integer} ) : Object</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>mode</td><td>Integer</td><td style="text-align:center">-&gt;</td><td><code>dk force drop if stamp changed</code>:スタンプが変更されていた場合でも強制的にドロップする</td></tr><tr><td>戻り値</td><td>Object</td><td style="text-align:center">&lt;-</td><td>ドロップの結果</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-3"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.drop()</code> 関数は、データクラスに対応するテーブルにおいて、データストアのエンティティに格納されているデータを削除します。エンティティそのものはメモリ内に残るという点に注意してください。</p><p>マルチユーザー、あるいはマルチプロセスアプリケーションにおいて、<code>.drop()</code> 関数は<a href="#EntityClass.html_entity-locking">"オプティミスティック・ロック"</a>機構のもとで実行されます。これはレコードが保存されるたびに内部的なロックスタンプが自動的に増分していくという機構です。</p><p><em>mode</em>引数を渡さなかった場合のデフォルトでは、同エンティティが他のプロセスまたはユーザーによって変更されていた場合(つまり、スタンプが変更されていた場合) にエラーを返します (以下参照)。</p><p><em>mode</em> に <code>dk force drop if stamp changed</code>オプションを渡すと、スタンプが変更されていてもエンティティはドロップされます (プライマリーキーは変わらない場合)。</p><p><strong>戻り値</strong></p><p><code>.drop( )</code> によって返されるオブジェクトには以下のプロパティが格納されます:</p><table><thead><tr><th>プロパティ</th><th></th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>success</td><td></td><td>boolean</td><td>ドロップが成功した場合には true、それ以外は false</td></tr><tr><td></td><td></td><td></td><td><strong><em>エラーの場合にのみ利用可能:</em></strong></td></tr><tr><td>status(*)</td><td></td><td>number</td><td>エラーコード、以下参照</td></tr><tr><td>statusText(*)</td><td></td><td>テキスト</td><td>エラーの詳細、以下参照</td></tr><tr><td></td><td></td><td></td><td><strong><em>ペシミスティック・ロックエラーの場合にのみ利用可能:</em></strong></td></tr><tr><td>lockKindText</td><td></td><td>テキスト</td><td>"Locked by record"</td></tr><tr><td>lockInfo</td><td></td><td>object</td><td>ロック元についての情報</td></tr><tr><td></td><td>task_id</td><td>number</td><td>プロセスID</td></tr><tr><td></td><td>user_name</td><td>テキスト</td><td>マシン上でのセッションユーザー名</td></tr><tr><td></td><td>user4d_alias</td><td>テキスト</td><td><code>SET USER ALIAS</code> で設定されていればユーザーエイリアス。それ以外は4Dディレクトリのユーザー名</td></tr><tr><td></td><td>host_name</td><td>テキスト</td><td>マシン名</td></tr><tr><td></td><td>task_name</td><td>テキスト</td><td>プロセス名</td></tr><tr><td></td><td>client_version</td><td>テキスト</td><td></td></tr><tr><td></td><td></td><td></td><td><strong><em>深刻なエラーの場合にのみ利用可能(深刻なエラーとは、プライマリーキーを重複させようとした、ディスクがいっぱいであった、などです):</em></strong></td></tr><tr><td>errors</td><td></td><td>Object の Collection</td><td></td></tr><tr><td></td><td>message</td><td>テキスト</td><td>エラーメッセージ</td></tr><tr><td></td><td>component signature</td><td>テキスト</td><td>内部コンポーネント署名 (例 "dmbg" はデータベースコンポーネントを表します)</td></tr><tr><td></td><td>errCode</td><td>number</td><td>エラーコード</td></tr></tbody></table><p>(*) エラー時には <em>Result</em> オブジェクトの <em>status</em> あるいは<em>statusText</em> プロパティに以下のいずれかの値が返されます:</p><table><thead><tr><th>定数</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><code>dk status entity does not exist anymore</code></td><td>5</td><td>エンティティはもうデータ内に存在していません。 このエラーは以下のような場合に起きえます:<br /><ul><li>エンティティがドロップされている (スタンプが変更されていて、メモリ空間は解放されている)</li><li>エンティティがドロップされていて、他のプライマリーキー値を持つエンティティで置き換えられている(スタンプは変更されていて、新しいエンティティがメモリ空間を使用している)。 entity.drop( )を使用するとき、このエラーは dk force drop if stamp changedオプションを使用した場合に返されることがあります。 entity.lock( ) を使用するとき、このエラーは dk reloaddrop if stamp changed オプションを使用した場合に返されることがあります。</li><p><strong>割り当てられた statusText</strong>: "エンティティはもう存在しません"</p></ul></td></tr><tr><td><code>dk status locked</code></td><td>3</td><td>エンティティはペシミスティック・ロックでロックされています。<br /><strong>割り当てられた statusText</strong>: "既にロックされています"</td></tr><tr><td><code>dk status serious error</code></td><td>4</td><td>深刻なエラーとは、低レベルのデータベースエラー (例: 重複キー)、ハードウェアエラーなどです。<br /><strong>割り当てられた statusText</strong>: "その他のエラー"</td></tr><tr><td><code>dk status stamp has changed</code></td><td>2</td><td>エンティティの内部的なスタンプ値がデータ内に保存されているエンティティのものと合致しません(オプティミスティック・ロック)。<br /><ul><li>entity.save( ) の場合: dk auto merge オプションが使用されていない場合に限りエラー</li><li>entity.drop( ) の場合: dk force drop if stamp changedオプションが使用されていない場合に限りエラー</li><li>entity.lock( ) の場合: dk reload if stamp changedオプションが使用されていない場合に限りエラー</li><li><strong>割り当てられた statusText</strong>: "スタンプが変更されています"</li></ul></td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1-2"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1-2"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 1</h4><p><code>dk force drop if stamp changed</code> オプションを使用しない例:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Smith"</span>) <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>.<span class="hljs-function">first</span>() <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">drop</span>()<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$employee</span>.firstName+<span class="hljs-string">" "</span>+<span class="hljs-variable">$employee</span>.lastName+<span class="hljs-string">" をドロップしました。"</span>) <span class="hljs-comment">// ドロップされたエンティティはメモリ内に残ります</span>    :(<span class="hljs-variable">$status</span>.status=dk status stamp has changed)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$status</span>.statusText)<span class="hljs-keyword"> End case</span></code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-2-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-2-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 2</h4><p><code>dk force drop if stamp changed</code> オプションを使用する例:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Smith"</span>) <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>.<span class="hljs-function">first</span>() <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">drop</span>(dk force drop if stamp changed)<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$employee</span>.firstName+<span class="hljs-string">" "</span>+<span class="hljs-variable">$employee</span>.lastName+<span class="hljs-string">" をドロップしました。"</span>) <span class="hljs-comment">// ドロップされたエンティティはメモリ内に残ります</span>    :(<span class="hljs-variable">$status</span>.status=dk status entity does not exist anymore)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$status</span>.statusText)<span class="hljs-keyword"> End case</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_first"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_first"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.first()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.first()</strong>: 4D.Entity</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.Entity</td><td style="text-align:center">&lt;-</td><td>エンティティセレクションの先頭エンティティへの参照 (見つからなければ null)</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-4"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-4"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.first()</code> 関数は、対象エンティティが所属するエンティティセレクションの先頭エンティティへの参照を返します。</p><p>対象エンティティが所属する既存エンティティセレクションが存在しない場合 (つまり <a href="#EntityClass.html_getselection">entity.getSelection( )</a> が Nullを返す場合)、関数は Null値を返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-3"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee</span>; <span class="hljs-variable">$firstEmployee </span>: cs.EmployeeEntity <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName = :1"</span>;<span class="hljs-string">"H@"</span>) <span class="hljs-comment">// このエンティティセレクションは 3件のエンティティを持ちます</span> <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">2</span>] <span class="hljs-variable">$firstEmployee</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">first</span>() <span class="hljs-comment">// $firstEmployee は、$employees エンティティセレクションの先頭エンティティです</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_fromobject"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_fromobject"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.fromObject()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.fromObject</strong>( <em>filler</em> : Object )</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>filler</td><td>Object</td><td style="text-align:center">-&gt;</td><td>エンティティの属性値を設定するオブジェクト</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-5"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-5"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.fromObject()</code> 関数は、 <em>filler</em>に指定した内容でエンティティの属性値を設定します。</p><blockquote><p>このコマンドは、元のエンティティを変更します。</p></blockquote><p>オブジェクトとエンティティ間のマッピングは属性名でおこなわれます:</p><ul><li>オブジェクトのプロパティがデータクラスに存在しない場合、それは無視されます。</li><li>データタイプは同じである必要があります。 オブジェクトとデータクラス間で型が合致しない場合、4Dは可能であればデータを変換しようとし (<a href="#EntityClass.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25BF%25E3%2582%25A4%25E3%2583%2597%25E3%2581%25AE%25E5%25A4%2589%25E6%258F%259B"><code>データタイプの変換</code></a>)参照)、それ以外の場合にはその属性は更新されません。</li><li>プライマリーキーはそのまま、あるいは "__KEY" プロパティを (プライマリーキー値とともに)使って指定することができます。 その値のエンティティがデータクラス内に存在しない場合には、<a href="#EntityClass.html_save">.save()</a>が呼び出されたときに指定値を使ってエンティティが作成されます。プライマリーキーを指定していない場合、エンティティは作成され、データベースのルールに基づいてプライマリーキー値が割り当てられます。自動インクリメント機能はプライマリーキーが null の場合にのみ計算されます。</li></ul><p><em>filler</em>引数のオブジェクトは、以下の条件のいずれかを満たしている場合にはリレートエンティティを扱うことができます:</p><ul><li><em>filler</em> が外部キーを格納している</li><li><em>filler</em> が、リレートエンティティ名と同じ名称のプロパティを格納しており、その値であるオブジェクトは"__KEY" という名称の単一のプロパティを格納している</li><li>リレートエンティティが存在しない場合、無視されます。</li></ul><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-4"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-4"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><p>以下のような $o オブジェクトがある場合:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Mary"</span>,    <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Smith"</span>,    <span class="hljs-string">"salary"</span>: <span class="hljs-number">36500</span>,    <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"1958-10-27T00:00:00.000Z"</span>,    <span class="hljs-string">"woman"</span>: true,    <span class="hljs-string">"managerID"</span>: <span class="hljs-number">411</span>,<span class="hljs-comment">// リレートエンティティを主キー属性値で指定します</span>    <span class="hljs-string">"employerID"</span>: <span class="hljs-number">20</span> <span class="hljs-comment">// リレートエンティティを主キー属性値で指定します</span>}</code></pre><p>以下のコードを実行すると、manager およびemployerというリレートエンティティを持つエンティティを作成します。</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$o </span>: Object<span class="hljs-keyword"> var</span> <span class="hljs-variable">$entity </span>: cs.EmpEntity <span class="hljs-variable">$entity</span>:=ds.Emp.<span class="hljs-function">new</span>() <span class="hljs-variable">$entity</span>.<span class="hljs-function">fromObject</span>(<span class="hljs-variable">$o</span>) <span class="hljs-variable">$entity</span>.<span class="hljs-function">save</span>()</code></pre><p>また、オブジェクトとして提供されたリレートエンティティを使用することもできます:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Marie"</span>,    <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Lechat"</span>,    <span class="hljs-string">"salary"</span>: <span class="hljs-number">68400</span>,    <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"1971-09-03T00:00:00.000Z"</span>,    <span class="hljs-string">"woman"</span>: false,    <span class="hljs-string">"employer"</span>: {<span class="hljs-comment">// リレートエンティティをオブジェクトで指定します</span>        <span class="hljs-string">"__KEY"</span>: <span class="hljs-string">"21"</span>    },    <span class="hljs-string">"manager"</span>: {<span class="hljs-comment">//  リレートエンティティをオブジェクトで指定します</span>        <span class="hljs-string">"__KEY"</span>: <span class="hljs-string">"411"</span>    }}</code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_getdataclass"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_getdataclass"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.getDataClass()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17 R5</td><td>追加</td></tr></tbody></table></details><p><strong>.getDataClass()</strong> : 4D.DataClass</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.DataClass</td><td style="text-align:center">&lt;-</td><td>エンティティが所属している DataClass オブジェクト</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-6"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-6"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.getDataClass()</code> 関数は、 エンティティのデータクラスを返します。この関数は汎用的なコードを書くのに有用です。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-5"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-5"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><p>以下の汎用的なコードは、あらゆるエンティティを複製します:</p><pre><code class="hljs css language-4d">  <span class="hljs-comment">// duplicate_entity メソッド </span>  <span class="hljs-comment">// duplicate_entity($entity) </span> #<span class="hljs-function">DECLARE</span>(<span class="hljs-variable">$entity </span>: 4D.Entity)<span class="hljs-keyword">   var</span> <span class="hljs-variable">$entityNew </span>: 4D.Entity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object <span class="hljs-variable">$entityNew</span>:=<span class="hljs-variable">$entity</span>.<span class="hljs-function">getDataClass</span>().<span class="hljs-function">new</span>() <span class="hljs-comment">// 親データクラスに新しいエンティティを作成します</span> <span class="hljs-variable">$entityNew</span>.<span class="hljs-function">fromObject</span>(<span class="hljs-variable">$entity</span>.<span class="hljs-function">toObject</span>()) <span class="hljs-comment">// 全属性を取得します</span> <span class="hljs-variable">$entityNew</span>[<span class="hljs-variable">$entity</span>.<span class="hljs-function">getDataClass</span>().<span class="hljs-function">getInfo</span>().primaryKey]:=<span class="hljs-literal">Null</span> <span class="hljs-comment">// プライマリーキーをリセットします</span> <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$entityNew</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">// 複製したエンティティを保存します</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_getkey"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_getkey"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.getKey()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.getKey</strong>( { <em>mode</em> : Integer } ) :Text<br /><strong>.getKey</strong>( { <em>mode</em> : Integer } ) :Integer</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>mode</td><td>Integer</td><td style="text-align:center">-&gt;</td><td><code>dk key as string</code>:プライマリーキーの型にかかわらず、プライマリーキーを文字列として返します</td></tr><tr><td>戻り値</td><td>Text</td><td style="text-align:center">&lt;-</td><td>エンティティのテキスト型プライマリーキーの値</td></tr><tr><td>戻り値</td><td>Integer</td><td style="text-align:center">&lt;-</td><td>エンティティの数値型プライマリーキーの値</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-7"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-7"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.getKey()</code> 関数は、 エンティティのプライマリーキー値を返します。</p><p>プライマリーキーは数値 (倍長整数) あるいは文字列です。 <em>mode</em> 引数として <code>dk keyas string</code>オプションを渡すことで、実際のプライマリーキーの型に関係なく、返されるプライマリーキー値の型を文字列に "強制"することができます。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-6"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-6"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Smith"</span>) <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">0</span>]<span class="hljs-function"> ALERT</span>(<span class="hljs-string">"プライマリーキー: "</span>+<span class="hljs-variable">$employee</span>.<span class="hljs-function">getKey</span>(dk key as string))</code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_getremotecontextattributes"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_getremotecontextattributes"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.getRemoteContextAttributes()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v19R5</td><td>追加</td></tr></tbody></table></details><p><strong>.getRemoteContextAttributes()</strong> : Text</p><table><thead><tr><th>引数</th><th>タイプ</th><th></th><th>説明</th></tr></thead><tbody><tr><td>result</td><td>テキスト</td><td>&lt;-</td><td>エンティティにリンクされたコンテキスト属性 (カンマ区切り)</td></tr></tbody></table><blockquote><p><strong>上級者向け:</strong>この機能は、特定の構成のため、ORDAのデフォルト機能をカスタマイズする必要がある開発者向けです。ほとんどの場合、使用する必要はないでしょう。</p></blockquote><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-8"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-8"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.getRemoteContextAttributes()</code> 関数は、エンティティによって使われている最適化コンテキストの情報を返します 。</p><p>エンティティについて <a href="#EntityClass.html_%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25A4%25E3%2582%25A2%25E3%2583%25B3%25E3%2583%2588%25E3%2582%25B5%25E3%2583%25BC%25E3%2583%2590%25E3%2583%25BC%25E3%2581%25AE%25E6%259C%2580%25E9%2581%25A9%25E5%258C%2596">最適化コンテキスト</a> が存在しない場合、関数は空のテキストを返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-7"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-7"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword">var</span> <span class="hljs-variable">$ds </span>: 4D.DataStoreImplementation<span class="hljs-keyword">var</span> <span class="hljs-variable">$address </span>: cs.AddressEntity<span class="hljs-keyword">var</span> <span class="hljs-variable">$p </span>: cs.PersonsEntity<span class="hljs-keyword">var</span> <span class="hljs-variable">$contextA </span>: Object<span class="hljs-keyword">var</span> <span class="hljs-variable">$info </span>: Text<span class="hljs-keyword">var</span> <span class="hljs-variable">$text </span>: Text<span class="hljs-variable">$ds</span>:=<span class="hljs-function">Open datastore</span>(<span class="hljs-function">New object</span>(<span class="hljs-string">"hostname"</span>; <span class="hljs-string">"www.myserver.com"</span>); <span class="hljs-string">"myDS"</span>)<span class="hljs-variable">$contextA</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"context"</span>; <span class="hljs-string">"contextA"</span>)<span class="hljs-variable">$address</span>:=<span class="hljs-variable">$ds</span>.Address.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>; <span class="hljs-variable">$contextA</span>)<span class="hljs-variable">$text</span>:=<span class="hljs-string">""</span><span class="hljs-keyword"> For each</span> (<span class="hljs-variable">$p</span>; <span class="hljs-variable">$address</span>.persons)    <span class="hljs-variable">$text</span>:=<span class="hljs-variable">$p</span>.firstname+<span class="hljs-string">" "</span>+<span class="hljs-variable">$p</span>.lastname<span class="hljs-keyword">End for each</span> <span class="hljs-variable">$info</span>:=<span class="hljs-variable">$address</span>.<span class="hljs-function">getRemoteContextAttributes</span>()<span class="hljs-comment">//$info = "persons,persons.lastname,persons.firstname"</span></code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E5%8F%82%E7%85%A7"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E5%258F%2582%25E7%2585%25A7"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>参照</h4><p><a href="#EntityClass.html_getRemoteContextAttributes">EntitySelection.getRemoteContextAttributes()</a><br /><a href="#EntityClass.html_clearallremotecontexts">.clearAllRemoteContexts()</a><br /><a href="#EntityClass.html_getremotecontextinfo">.getRemoteContextInfo()</a><br /><a href="#EntityClass.html_getallremotecontexts">.getAllRemoteContexts()</a><br /><a href="#EntityClass.html_setremotecontextinfo">.setRemoteContextInfo()</a></p><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_getselection"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_getselection"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.getSelection()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.getSelection()</strong>: 4D.EntitySelection</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.EntitySelection</td><td style="text-align:center">&lt;-</td><td>エンティティが所属するエンティティセレクション (見つからなければ null)</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-9"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-9"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.getSelection()</code> 関数は、エンティティが所属するエンティティセレクションを返します。</p><p>対象エンティティがエンティティセレクションに所属していない場合、関数は Null値を返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-8"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-8"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$emp </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees</span>; <span class="hljs-variable">$employees2 </span>: cs.EmployeeSelection <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">672</span>) <span class="hljs-comment">// エンティティセレクションに属していないエンティティです</span> <span class="hljs-variable">$employees</span>:=<span class="hljs-variable">$emp</span>.<span class="hljs-function">getSelection</span>() <span class="hljs-comment">// $employees は Null です</span> <span class="hljs-variable">$employees2</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Smith"</span>) <span class="hljs-comment">// このエンティティセレクションは 6件のエンティティを格納しています</span> <span class="hljs-variable">$emp</span>:=<span class="hljs-variable">$employees2</span>[<span class="hljs-number">0</span>]  <span class="hljs-comment">// エンティティセレクションに所属しているエンティティです</span><span class="hljs-function"> ALERT</span>(<span class="hljs-string">"エンティティセレクションには "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$emp</span>.<span class="hljs-function">getSelection</span>().length)+<span class="hljs-string">" 件のエンティティが含まれています"</span>)</code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_getstamp"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_getstamp"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.getStamp()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.getStamp()</strong> : Integer</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>整数</td><td style="text-align:center">&lt;-</td><td>エンティティのスタンプ (エンティティが作成されたばかりの場合には 0)</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-10"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-10"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.getStamp()</code> 関数は、 エンティティのスタンプの値を返します。</p><p>内部スタンプは、エンティティが保存されるたびに 4D によって自動的にインクリメントされます。これは同じエンティティに対する複数のユーザーの同時アクセス・編集を管理します。この機構の詳細については、<a href="#EntityClass.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%25AD%25E3%2583%2583%25E3%2582%25AD%25E3%2583%25B3%25E3%2582%25B0"><strong>エンティティロッキング</strong></a>を参照ください。</p><blockquote><p>(一度も保存されていない) 新規エンティティに対しては、このメソッドは 0 を返します。しかしながら、エンティティがまだ作成されたばかりかどうかを調べるには、<a href="#EntityClass.html_isnew">isNew()</a> の使用が推奨されます。</p></blockquote><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-9"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-9"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$entity </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$stamp </span>: Integer <span class="hljs-variable">$entity</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-variable">$entity</span>.lastname:=<span class="hljs-string">"Smith"</span> <span class="hljs-variable">$entity</span>.<span class="hljs-function">save</span>() <span class="hljs-variable">$stamp</span>:=<span class="hljs-variable">$entity</span>.<span class="hljs-function">getStamp</span>() <span class="hljs-comment">//$stamp=1</span> <span class="hljs-variable">$entity</span>.lastname:=<span class="hljs-string">"Wesson"</span> <span class="hljs-variable">$entity</span>.<span class="hljs-function">save</span>() <span class="hljs-variable">$stamp</span>:=<span class="hljs-variable">$entity</span>.<span class="hljs-function">getStamp</span>() <span class="hljs-comment">//$stamp=2</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_indexof"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_indexof"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.indexOf()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.indexOf</strong>( { <em>entitySelection</em> :4D.EntitySelection } ) : Integer</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>entitySelection</td><td>4D.EntitySelection</td><td style="text-align:center">-&gt;</td><td>エンティティの位置を取得する対象のエンティティセレクション</td></tr><tr><td>戻り値</td><td>整数</td><td style="text-align:center">&lt;-</td><td>エンティティセレクション内でのエンティティの位置</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-11"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-11"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.indexOf()</code> 関数は、エンティティセレクション内におけるエンティティの位置を返します。</p><p><em>entitySelection</em>引数が渡されなかった場合はデフォルトで、所属エンティティセレクション内でのエンティティの位置が返されます。<em>entitySelection</em>引数を渡した場合は、指定されたエンティティセレクション内でのエンティティの位置を返します。</p><p>戻り値は、0 と、エンティティセレクションの length より 1 を引いた値の範囲内の数値です。</p><ul><li>エンティティがエンティティセレクションを持たない場合、あるいは <em>entitySelection</em>引数で指定したエンティティセレクションに含まれていない場合には、-1 が返されます。</li><li><em>entitySelection</em> 引数で指定したエンティティセレククションが Nullである、あるいはエンティティと同じデータクラスのものでない場合には、エラーが生成されます。</li></ul><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-10"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-10"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName = :1"</span>;<span class="hljs-string">"H@"</span>) <span class="hljs-comment">// このエンティティセレクションには 3件のエンティティが格納されています</span> <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">1</span>] <span class="hljs-comment">// このエンティティはエンティティセレクションに所属しています</span><span class="hljs-function"> ALERT</span>(<span class="hljs-string">"The index of the entity in its own entity selection is "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$employee</span>.<span class="hljs-function">indexOf</span>())) <span class="hljs-comment">// 1</span> <span class="hljs-variable">$employee</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">725</span>) <span class="hljs-comment">// エンティティセレクションに所属していないエンティティです</span><span class="hljs-function"> ALERT</span>(<span class="hljs-string">"The index of the entity is "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$employee</span>.<span class="hljs-function">indexOf</span>())) <span class="hljs-comment">// -1</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_isnew"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_isnew"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.isNew()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.isNew()</strong> : Boolean</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>ブール</td><td style="text-align:center">&lt;-</td><td>エンティティが作成されたばかりで未保存の場合は true。 それ以外は false。</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-12"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-12"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.isNew()</code> 関数は、対象エンティティが作成されたばかりで、まだデータストアに保存されていない場合に true を返します。 そうでない場合には、falseを返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-11"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-11"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$emp </span>: cs.EmployeeEntity <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">new</span>()<span class="hljs-keyword"> If</span>(<span class="hljs-variable">$emp</span>.<span class="hljs-function">isNew</span>())<span class="hljs-function">    ALERT</span>(<span class="hljs-string">"新規エンティティです。"</span>)<span class="hljs-keyword"> End if</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_last"></a><a aria-hidden="true" class="hash-link"href="#EntityClass.html_last"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.last()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.last()</strong> : 4D.Entity</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.Entity</td><td style="text-align:center">&lt;-</td><td>エンティティセレクションの最終エンティティへの参照 (見つからなければ null)</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-13"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-13"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.last()</code> 関数は、対象エンティティが所属するエンティティセレクションの最終エンティティへの参照を返します。</p><p>対象エンティティが所属する既存エンティティセレクションが存在しない場合 (つまり <a href="#EntityClass.html_getselection">entity.getSelection( )</a> が Nullを返す場合)、関数は Null値を返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-12"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-12"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee</span>; <span class="hljs-variable">$lastEmployee </span>: cs.EmployeeEntity <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName = :1"</span>;<span class="hljs-string">"H@"</span>) <span class="hljs-comment">// このエンティティセレクションは 3件のエンティティを持ちます</span> <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">0</span>] <span class="hljs-variable">$lastEmployee</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">last</span>() <span class="hljs-comment">// $lastEmployee は、$employees エンティティセレクションの最終エンティティです</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_lock"></a><a aria-hidden="true" class="hash-link"href="#EntityClass.html_lock"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.lock()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.lock</strong>( { <em>mode</em> : Integer } ) :Object</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>mode</td><td>整数</td><td style="text-align:center">-&gt;</td><td><code>dk reload if stamp changed</code>:スタンプが変更されてる場合はロック前にリロードします</td></tr><tr><td>戻り値</td><td>オブジェクト</td><td style="text-align:center">&lt;-</td><td>ロックの結果</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-14"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-14"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.lock()</code> 関数は、 対象エンティティが参照するレコードにペシミスティック・ロックをかけます。<a href="#EntityClass.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%25AD%25E3%2583%2583%25E3%2582%25AD%25E3%2583%25B3%25E3%2582%25B0">ロック</a>はレコードと、カレントプロセス内の当該エンティティの参照すべてに対してかけられます。</p><p>他のプロセスからはこのレコードがロックされて見えます(この関数を使って同エンティティをロックしようとした場合、<code>result.success</code> プロパティにはfalse が返されます)。 ロックをおこなったセッション内で実行される関数のみが、当該エンティティの属性を編集・保存できます。他のセッションは同エンティティを読み取り専用にロードできますが、値の入力・保存はできません。</p><p><code>.lock()</code> でロックされたレコードは、以下の場合にロック解除されます:</p><ul><li>同プロセス内で合致するエンティティに対して <a href="#EntityClass.html_unlock"><code>.unlock()</code></a>関数が呼び出された場合</li><li>メモリ内のどのエンティティからも参照されなくなった場合、自動的にロックが解除されます。たとえば、エンティティのローカル参照に対してのみロックがかかっていた場合、関数の実行が終了すればロックは解除されます。メモリ内にエンティティへの参照がある限り、レコードはロックされたままです。</li></ul><blockquote><p>エンティティは <a href="#lock.html">RESTセッションによってロックされる</a>場合もあります。</p></blockquote><p><em>mode</em>引数を渡さなかった場合のデフォルトでは、同エンティティが他のプロセスまたはユーザーによって変更されていた場合(つまり、スタンプが変更されていた場合) にエラーを返します (以下参照)。</p><p><em>mode</em> に <code>dk reload if stamp changed</code>オプションを渡すと、スタンプが変更されていてもエラーは返されず、エンティティは再読み込みされます(エンティティが引き続き存在し、プライマリーキーも変わらない場合)。</p><p><strong>戻り値</strong></p><p><code>.lock( )</code> によって返されるオブジェクトには以下のプロパティが格納されます:</p><table><thead><tr><th>プロパティ</th><th></th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>success</td><td></td><td>boolean</td><td>ロックに成功した場合 (あるいはエンティティがすでにカレントプロセスでロックされていた場合) には true、それ以外はfalse</td></tr><tr><td></td><td></td><td></td><td><strong><em><code>dk reload if stamp changed</code>オプションが使用されていた場合にのみ利用可能:</em></strong></td></tr><tr><td><strong>wasReloaded</strong></td><td></td><td>boolean</td><td>エンティティがリロードされ、かつリロードに成功した場合には true、それ以外は false</td></tr><tr><td></td><td></td><td></td><td><strong><em>エラーの場合にのみ利用可能:</em></strong></td></tr><tr><td>status(*)</td><td></td><td>number</td><td>エラーコード、以下参照</td></tr><tr><td>statusText(*)</td><td></td><td>テキスト</td><td>エラーの詳細、以下参照</td></tr><tr><td></td><td></td><td></td><td><strong><em>ペシミスティック・ロックエラーの場合にのみ利用可能:</em></strong></td></tr><tr><td>lockKindText</td><td></td><td>テキスト</td><td>"Locked by record" 4Dプロセスによるロック、"Locked by session"RESTセッションによるロック</td></tr><tr><td>lockInfo</td><td></td><td>object</td><td>ロック元についての情報。 返されるプロパティはロック元 (4Dプロセスまたは RESTセッション)によって異なります。</td></tr><tr><td></td><td></td><td></td><td><strong><em>4Dプロセスによるロックの場合:</em></strong></td></tr><tr><td></td><td>task_id</td><td>number</td><td>プロセスID</td></tr><tr><td></td><td>user_name</td><td>テキスト</td><td>マシン上でのセッションユーザー名</td></tr><tr><td></td><td>user4d_alias</td><td>テキスト</td><td>4D ユーザーの名前またはエイリアス</td></tr><tr><td></td><td>user4d_id</td><td>number</td><td>4DデータベースディレクトリでのユーザーID</td></tr><tr><td></td><td>host_name</td><td>テキスト</td><td>マシン名</td></tr><tr><td></td><td>task_name</td><td>テキスト</td><td>プロセス名</td></tr><tr><td></td><td>client_version</td><td>テキスト</td><td>クライアントのバージョン</td></tr><tr><td></td><td></td><td></td><td><strong><em>RESTセッションによるロックの場合:</em></strong></td></tr><tr><td></td><td>host</td><td>テキスト</td><td>エンティティをロックした URL (例: "<a href="http://www.myserver.com">www.myserver.com</a>")</td></tr><tr><td></td><td>IPAddr</td><td>テキスト</td><td>ロック元の IPアドレス (例: "127.0.0.1")</td></tr><tr><td></td><td>userAgent</td><td>テキスト</td><td>ロック元の userAgent (例: Mozilla/5.0 (Macintosh; Intel Mac OS X10_15_3) AppleWebKit/537.36 (KHTML, like Gecko)Chrome/96.0.4664.110 Safari/537.36")</td></tr><tr><td></td><td></td><td></td><td><strong><em>深刻なエラーの場合にのみ利用可能</em></strong>(深刻なエラーとは、プライマリーキーを重複させようとした、ディスクがいっぱいであった、などです):</td></tr><tr><td>errors</td><td></td><td>Object の Collection</td><td></td></tr><tr><td></td><td>message</td><td>テキスト</td><td>エラーメッセージ</td></tr><tr><td></td><td>component signature</td><td>テキスト</td><td>内部コンポーネント署名 (例 "dmbg" はデータベースコンポーネントを表します)</td></tr><tr><td></td><td>errCode</td><td>number</td><td>エラーコード</td></tr></tbody></table><p>(*) エラー時には <em>Result</em> オブジェクトの <em>status</em> あるいは<em>statusText</em> プロパティに以下のいずれかの値が返されます:</p><table><thead><tr><th>定数</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><code>dk status entity does not exist anymore</code></td><td>5</td><td>エンティティはもうデータ内に存在していません。 このエラーは以下のような場合に起きえます:<ul><li>エンティティがドロップされている (スタンプが変更されていて、メモリ空間は解放されている)</li><li>エンティティがドロップされていて、他のプライマリーキー値を持つエンティティで置き換えられている(スタンプは変更されていて、新しいエンティティがメモリ空間を使用している)。 entity.drop( )を使用するとき、このエラーは dk force drop if stamp changedオプションを使用した場合に返されることがあります。 entity.lock( ) を使用するとき、このエラーは dk reloaddrop if stamp changed オプションを使用した場合に返されることがあります。</li><br /><strong>割り当てられた statusText</strong>: "エンティティはもう存在しません"</ul></td></tr><tr><td><code>dk status locked</code></td><td>3</td><td>エンティティはペシミスティック・ロックでロックされています。<p><strong>割り当てられた statusText</strong>: "既にロックされています"</p></td></tr><tr><td><code>dk status serious error</code></td><td>4</td><td>深刻なエラーとは、低レベルのデータベースエラー (例: 重複キー)、ハードウェアエラーなどです。<p><strong>割り当てられた statusText</strong>: "その他のエラー"</p></td></tr><tr><td><code>dk status stamp has changed</code></td><td>2</td><td>エンティティの内部的なスタンプ値がデータ内に保存されているエンティティのものと合致しません (オプティミスティック・ロック)。<ul><li>entity.save( ) の場合: dk auto merge オプションが使用されていない場合に限りエラー</li><li>entity.drop( ) の場合: dk force drop if stamp changedオプションが使用されていない場合に限りエラー</li><li>entity.lock( ) の場合: dk reload if stamp changedオプションが使用されていない場合に限りエラー</li><br /><strong>割り当てられた statusText</strong>: "スタンプが変更されています"</ul></td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1-3"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1-3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 1</h4><p>エラーのある例題:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object <span class="hljs-variable">$employee</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">716</span>) <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">lock</span>()<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$employee</span>.firstName+<span class="hljs-string">" "</span>+<span class="hljs-variable">$employee</span>.lastName+<span class="hljs-string">"をロックしました"</span>)    :(<span class="hljs-variable">$status</span>.status=dk status stamp has changed)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$status</span>.statusText)<span class="hljs-keyword"> End case</span></code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-2-2"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-2-2"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 2</h4><p><code>dk reload if stamp changed</code> オプションを使用する例:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object <span class="hljs-variable">$employee</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">717</span>) <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">lock</span>(dk reload if stamp changed)<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$employee</span>.firstName+<span class="hljs-string">" "</span>+<span class="hljs-variable">$employee</span>.lastName+<span class="hljs-string">" をロックしました"</span>)    :(<span class="hljs-variable">$status</span>.status=dk status entity does not exist anymore)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$status</span>.statusText)<span class="hljs-keyword"> End case</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_next"></a><a aria-hidden="true" class="hash-link"href="#EntityClass.html_next"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.next()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.next()</strong> : 4D.Entity</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.Entity</td><td style="text-align:center">&lt;-</td><td>エンティティセレクション内の次のエンティティへの参照 (見つからなければ null)</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-15"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-15"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.next()</code> 関数は、エンティティが所属するエンティティセレクションの次のエンティティへの参照を返します。</p><p>対象エンティティが所属する既存エンティティセレクションが存在しない場合 (つまり <a href="#EntityClass.html_getselection">entity.getSelection()</a> が Nullを返す場合)、関数は Null値を返します。</p><p>エンティティセレクション内に有効な次のエンティティが存在しない場合 (セレクションの最終エンティティの場合)、関数は Nullを返します。 次のエンティティがドロップされていた場合、関数はその次の有効なエンティティを返します (セレクションの最後に辿り着くとNull を返します)。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-13"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-13"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee</span>; <span class="hljs-variable">$nextEmployee </span>: cs.EmployeeEntity <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName = :1"</span>;<span class="hljs-string">"H@"</span>) <span class="hljs-comment">// このエンティティセレクションは 3件のエンティティを持ちます</span> <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">0</span>] <span class="hljs-variable">$nextEmployee</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">next</span>() <span class="hljs-comment">// $nextEmployee は、$employees エンティティセレクションの 2番目のエンティティです</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_previous"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_previous"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.previous()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.previous()</strong> : 4D.Entity</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>4D.Entity</td><td style="text-align:center">&lt;-</td><td>エンティティセレクション内の前のエンティティへの参照 (見つからなければ null)</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-16"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-16"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.previous()</code> 関数は、エンティティが所属するエンティティセレクションの前のエンティティへの参照を返します。</p><p>対象エンティティが所属する既存エンティティセレクションが存在しない場合 (つまり <a href="#EntityClass.html_getselection">entity.getSelection()</a> が Nullを返す場合)、関数は Null値を返します。</p><p>エンティティセレクション内に有効な前のエンティティが存在しない場合 (セレクションの先頭エンティティの場合)、関数は Nullを返します。 前のエンティティがドロップされていた場合、関数はその前の有効なエンティティを返します (セレクションの先頭に辿り着くとNull を返します)。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-14"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-14"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee</span>; <span class="hljs-variable">$previousEmployee </span>: cs.EmployeeEntity <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName = :1"</span>;<span class="hljs-string">"H@"</span>) <span class="hljs-comment">// このエンティティセレクションは 3件のエンティティを持ちます</span> <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">1</span>] <span class="hljs-variable">$previousEmployee</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">previous</span>() <span class="hljs-comment">// $previousEmployee は、$employees エンティティセレクションの先頭エンティティです</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_reload-"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_reload-"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.reload( )</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.reload()</strong> : Object</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>オブジェクト</td><td style="text-align:center">&lt;-</td><td>ステータスオブジェクト</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-17"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-17"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.reload()</code> 関数は、データストアのデータクラスに対応するテーブルに保存されている情報に応じて、エンティティの中身をメモリ内にリロードします。エンティティが同じプライマリーキーで存在している場合にのみリロードは実行されます。</p><p><strong>戻り値</strong></p><p><code>.reload( )</code> によって返されるオブジェクトには以下のプロパティが格納されます:</p><table><thead><tr><th>プロパティ</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>success</td><td>boolean</td><td>リロードが成功した場合には true、それ以外は false<p><strong><em>エラーの場合にのみ利用可能</em></strong>:</p></td></tr><tr><td>status(*)</td><td>number</td><td>エラーコード、以下参照</td></tr><tr><td>statusText(*)</td><td>テキスト</td><td>エラーの詳細、以下参照</td></tr></tbody></table><p>(*) エラー時には <em>Result</em> オブジェクトの <em>status</em> あるいは<em>statusText</em> プロパティに以下のいずれかの値が返されます:</p><table><thead><tr><th>定数</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><code>dk status entity does not exist anymore</code></td><td>5</td><td>エンティティはもうデータ内に存在していません。 このエラーは以下のような場合に起きえます:<br /><ul><li>エンティティがドロップされている (スタンプが変更されていて、メモリ空間は解放されている)</li><li>エンティティがドロップされていて、他のプライマリーキー値を持つエンティティで置き換えられている(スタンプは変更されていて、新しいエンティティがメモリ空間を使用している)。 entity.drop( )を使用するとき、このエラーは dk force drop if stamp changedオプションを使用した場合に返されることがあります。 entity.lock( ) を使用するとき、このエラーは dk reloaddrop if stamp changed オプションを使用した場合に返されることがあります。</li><br /><strong><em>割り当てられた statusText</em></strong>:"エンティティはもう存在しません"</ul></td></tr><tr><td><code>dk status serious error</code></td><td>4</td><td>深刻なエラーとは、低レベルのデータベースエラー (例: 重複キー)、ハードウェアエラーなどです。<br /><strong><em>割り当てられた statusText</em></strong>: "その他のエラー"</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-15"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-15"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$result </span>: Object <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Hollis"</span>) <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>[<span class="hljs-number">0</span>] <span class="hljs-variable">$employee</span>.firstName:=<span class="hljs-string">"Mary"</span> <span class="hljs-variable">$result</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">reload</span>()<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$result</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-string">"エンティティはリロードされました"</span>)    :(<span class="hljs-variable">$result</span>.status=dk status entity does not exist anymore)<span class="hljs-function">       ALERT</span>(<span class="hljs-string">"エンティティはドロップされています"</span>)<span class="hljs-keyword"> End case</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_save"></a><a aria-hidden="true" class="hash-link"href="#EntityClass.html_save"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.save()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.save</strong>( { <em>mode</em> : Integer } ) :Object</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>mode</td><td>整数</td><td style="text-align:center">-&gt;</td><td><code>dk auto merge</code>: 自動マージモードを有効化します</td></tr><tr><td>戻り値</td><td>オブジェクト</td><td style="text-align:center">&lt;-</td><td>保存の結果</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-18"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-18"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.save()</code> 関数は、データクラスに対応するテーブル内に、 エンティティの変更内容を保存します 。エンティティを作成したあと、あるいはエンティティに対して保存したい変更をおこなったあとにはこの関数を呼び出す必要があります。</p><p>保存処理は、少なくとも一つのエンティティ属性が "touched" である (更新されている) 場合にのみ実行されます(<a href="#EntityClass.html_touched"><code>.touched()</code></a>および <a href="#EntityClass.html_touchedattributes"><code>.touchedAttributes()</code></a>関数参照)。 そうでない場合、関数は何もしません (トリガーは呼び出されません)。</p><p>マルチユーザー、あるいはマルチプロセスアプリケーションにおいて、<code>.save()</code> 関数は<a href="#EntityClass.html_entity-locking">"オプティミスティック・ロック"</a>機構のもとで実行されます。これはレコードが保存されるたびに内部的なロックスタンプが自動的に増分していくという機構です。</p><p><em>mode</em>引数を渡さなかった場合のデフォルトでは、いずれの属性に関わらず同エンティティが他のプロセスまたはユーザーによって変更されていた場合にエラーを返します(以下参照)。</p><p><em>mode</em> に <code>dk auto merge</code>オプションを渡すと自動マージモードが有効化され、別のプロセス/ユーザーが同エンティティに対して同時に変更をおこなっていても、異なる属性に対する変更であればエラーは生成されません。エンティティに保存されるデータは、別々の変更処理の組み合わせ ("マージ (併合)") になります(同じ属性に対して変更がおこなわれた場合には、自動マージモードであっても保存は失敗し、エラーが返されます)。</p><blockquote><p>ピクチャー・オブジェクト・テキスト型属性で、データを外部保存にしている場合には、自動マージモードは利用できません。これらの属性に同時の変更があった場合には <code>dk status stamp has changed</code>エラーになります。</p></blockquote><p><strong>戻り値</strong></p><p><code>.save()</code> によって返されるオブジェクトには以下のプロパティが格納されます:</p><table><thead><tr><th>プロパティ</th><th></th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>success</td><td></td><td>boolean</td><td>保存に成功した場合には true、それ以外は false</td></tr><tr><td></td><td></td><td></td><td><strong><em><code>dk auto merge</code>オプションが使用されていた場合にのみ利用可能</em></strong>:</td></tr><tr><td>autoMerged</td><td></td><td>boolean</td><td>自動マージが実行された場合には true、それ以外は false</td></tr><tr><td></td><td></td><td></td><td><strong><em>エラーの場合にのみ利用可能</em></strong>:</td></tr><tr><td>status</td><td></td><td>number</td><td>エラーコード、<a href="#EntityClass.html_status-%25E3%2581%25A8-statustext">以下参照</a></td></tr><tr><td>statusText</td><td></td><td>テキスト</td><td>エラーの詳細、<a href="#EntityClass.html_status-%25E3%2581%25A8-statustext">以下参照</a></td></tr><tr><td></td><td></td><td></td><td><strong><em>ペシミスティック・ロックエラーの場合にのみ利用可能</em></strong>:</td></tr><tr><td>lockKindText</td><td></td><td>テキスト</td><td>"Locked by record"</td></tr><tr><td>lockInfo</td><td></td><td>object</td><td>ロック元についての情報</td></tr><tr><td></td><td>task_id</td><td>number</td><td>プロセスID</td></tr><tr><td></td><td>user_name</td><td>テキスト</td><td>マシン上でのセッションユーザー名</td></tr><tr><td></td><td>user4d_alias</td><td>テキスト</td><td><code>SET USER ALIAS</code> で設定されていればユーザーエイリアス。それ以外は4Dディレクトリのユーザー名</td></tr><tr><td></td><td>host_name</td><td>テキスト</td><td>マシン名</td></tr><tr><td></td><td>task_name</td><td>テキスト</td><td>プロセス名</td></tr><tr><td></td><td>client_version</td><td>テキスト</td><td></td></tr><tr><td></td><td></td><td></td><td><strong><em>深刻なエラーの場合にのみ利用可能</em></strong>(深刻なエラーとは、プライマリーキーを重複させようとした、ディスクがいっぱいであった、などです):</td></tr><tr><td>errors</td><td></td><td>Object の Collection</td><td></td></tr><tr><td></td><td>message</td><td>テキスト</td><td>エラーメッセージ</td></tr><tr><td></td><td>componentSignature</td><td>テキスト</td><td>内部コンポーネント署名 (例 "dmbg" はデータベースコンポーネントを表します)</td></tr><tr><td></td><td>errCode</td><td>number</td><td>エラーコード</td></tr></tbody></table><h5><a aria-hidden="true" class="anchor" id="EntityClass.html_status-%E3%81%A8-statustext"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_status-%25E3%2581%25A8-statustext"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>status と statusText</h5><p>エラー時には Result オブジェクトの <code>status</code> あるいは<code>statusText</code> プロパティに以下のいずれかの値が返されます:</p><table><thead><tr><th>定数</th><th>値</th><th>説明</th></tr></thead><tbody><tr><td><code>dk status automerge failed</code></td><td>6</td><td>(<code>dk auto merge</code> オプションが使用されたときのみ)エンティティを保存するときに自動マージオプションが失敗しました。<p><strong>割り当てられた statusText</strong>: "自動マージ失敗"</p></td></tr><tr><td><code>dk status entity does not exist anymore</code></td><td>5</td><td>エンティティはもうデータ内に存在していません。 このエラーは以下のような場合に起きえます:<br /><ul><li>エンティティがドロップされている (スタンプが変更されていて、メモリ空間は解放されている)</li><li>エンティティがドロップされていて、他のプライマリーキー値を持つエンティティで置き換えられている(スタンプは変更されていて、新しいエンティティがメモリ空間を使用している)。 entity.drop( )を使用するとき、このエラーは dk force drop if stamp changedオプションを使用した場合に返されることがあります。 entity.lock( ) を使用するとき、このエラーは dk reloaddrop if stamp changed オプションを使用した場合に返されることがあります。</li><br /><strong>割り当てられた statusText</strong>: "エンティティはもう存在しません"</ul></td></tr><tr><td><code>dk status locked</code></td><td>3</td><td>エンティティはペシミスティック・ロックでロックされています。<p><strong>割り当てられた statusText</strong>: "既にロックされています"</p></td></tr><tr><td><code>dk status serious error</code></td><td>4</td><td>深刻なエラーとは、低レベルのデータベースエラー (例: 重複キー)、ハードウェアエラーなどです。<p><strong>割り当てられた statusText</strong>: "その他のエラー"</p></td></tr><tr><td><code>dk status stamp has changed</code></td><td>2</td><td>エンティティの内部的なスタンプ値がデータ内に保存されているエンティティのものと合致しません(オプティミスティック・ロック)。<br /><ul><li>entity.save( ) の場合: dk auto merge オプションが使用されていない場合に限りエラー</li><li>entity.drop( ) の場合: dk force drop if stamp changedオプションが使用されていない場合に限りエラー</li><li>entity.lock( ) の場合: dk reload if stamp changedオプションが使用されていない場合に限りエラー</li><br /><strong>割り当てられた statusText</strong>: "スタンプが変更されています"</ul></td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1-4"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1-4"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 1</h4><p>新しいエンティティを作成します:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity <span class="hljs-variable">$employee</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-variable">$employee</span>.firstName:=<span class="hljs-string">"Mary"</span> <span class="hljs-variable">$employee</span>.lastName:=<span class="hljs-string">"Smith"</span> <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">save</span>()<span class="hljs-keyword"> If</span>(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">    ALERT</span>(<span class="hljs-string">"Employee が作成されました"</span>)<span class="hljs-keyword"> End if</span></code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-2-3"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-2-3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 2</h4><p><code>dk auto merge</code> オプションを使わずにエンティティを更新します:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Smith"</span>) <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>.<span class="hljs-function">first</span>() <span class="hljs-variable">$employee</span>.lastName:=<span class="hljs-string">"Mac Arthur"</span> <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">save</span>()<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-string">"Employee が更新されました"</span>)    :(<span class="hljs-variable">$status</span>.status=dk status stamp has changed)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$status</span>.statusText)<span class="hljs-keyword"> End case</span></code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-3-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-3-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 3</h4><p><code>dk auto merge</code> オプションを使ってエンティティを更新します:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$employees </span>: cs.EmployeeSelection <span class="hljs-variable">$employees</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastName=:1"</span>;<span class="hljs-string">"Smith"</span>) <span class="hljs-variable">$employee</span>:=<span class="hljs-variable">$employees</span>.<span class="hljs-function">first</span>() <span class="hljs-variable">$employee</span>.lastName:=<span class="hljs-string">"Mac Arthur"</span> <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">save</span>(dk auto merge)<span class="hljs-keyword"> Case of</span>    :(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">       ALERT</span>(<span class="hljs-string">"Employee を更新しました"</span>)    :(<span class="hljs-variable">$status</span>.status=dk status automerge failed)<span class="hljs-function">       ALERT</span>(<span class="hljs-variable">$status</span>.statusText)<span class="hljs-keyword"> End case</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_toobject"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_toobject"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.toObject()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.toObject</strong>() : Object<br /><strong>.toObject</strong>( <em>filterString</em> : Text { ;<em>options</em> : Integer} ) : Object<br /><strong>.toObject</strong>( <em>filterCol</em> : Collection { ;<em>options</em> : Integer } ) : Object</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>filterString</td><td>テキスト</td><td style="text-align:center">-&gt;</td><td>取得する属性 (カンマ区切り)</td></tr><tr><td>filterCol</td><td>コレクション</td><td style="text-align:center">-&gt;</td><td>取得する属性のコレクション</td></tr><tr><td>options</td><td>整数</td><td style="text-align:center">-&gt;</td><td><code>dk with primary key</code>: __KEY プロパティを追加;<br /><code>dk with stamp</code>: __STAMP プロパティを追加</td></tr><tr><td>戻り値</td><td>オブジェクト</td><td style="text-align:center">&lt;-</td><td>エンティティを元にビルドされたオブジェクト</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-19"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-19"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.toObject()</code> 関数は、 エンティティからビルトされたオブジェクトを返します。オブジェクト内部のプロパティ名はエンティティの属性名と合致します。</p><p><em>filterString</em> 引数が空の文字列、あるいは "*" の場合、以下のいずれかが返されます:</p><ul><li>すべてのストレージエンティティ属性</li><li>リレートエンティティ型の属性 (<a href="#EntityClass.html_kind">kind</a> が<code>relatedEntity</code>) : リレートエンティティと同じ名前 (N対1リレーション名) のプロパティ。属性は単純な形式で取得されます。</li><li>リレートエンティティズ型の属性 (<a href="#EntityClass.html_kind">kind</a> が<code>relatedEntities</code>): 属性は返されません。</li></ul><p>最初の引数として、取得するエンティティ属性を渡します。 以下のものを渡すことができます:</p><ul><li><em>filterString</em>: プロパティパスをカンマで区切った文字列: "propertyPath1,propertyPath2, ..." または</li><li><em>filterCol</em>: 文字列のコレクション:["propertyPath1","propertyPath2";...]</li></ul><p>filter 引数がリレートエンティティ型の属性を指定する場合:</p><ul><li>propertyPath = "relatedEntity" -&gt; 単純な形式で取得されます: __KEYプロパティ(プライマリーキー) を持つオブジェクト</li><li>propertyPath = "relatedEntity.*" -&gt; 全プロパティが取得されます</li><li>propertyPath = "relatedEntity.propertyName1;relatedEntity.propertyName2; ..." -&gt; 指定されたプロパティのみが取得されます</li></ul><p>filter 引数がリレートエンティティズ型の属性を指定する場合:</p><ul><li>propertyPath = "relatedEntities.*" -&gt; 全プロパティが取得されます</li><li>propertyPath = "relatedEntities.propertyName1;relatedEntities.propertyName2; ..." -&gt; 指定されたプロパティのみが取得されます</li></ul><p><em>options</em> に <code>dk with primary key</code> または <code>dkwith stamp</code>セレクターを渡すことで、エンティティのプライマリーキー/スタンプを、取得するオブジェクトに追加するかどうかを指定できます。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1-5"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1-5"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 1</h4><p>このセクションの例題では、以下のストラクチャーを使います:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/API/dataclassAttribute4.png" /></p><p>filter 引数を渡さない場合:</p><pre><code class="hljs css language-4d">employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>()</code></pre><p>戻り値:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"ID"</span>: <span class="hljs-number">413</span>,    <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Greg"</span>,    <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Wahl"</span>,    <span class="hljs-string">"salary"</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"1963-02-01T00:00:00.000Z"</span>,    <span class="hljs-string">"woman"</span>: false,    <span class="hljs-string">"managerID"</span>: <span class="hljs-number">412</span>,    <span class="hljs-string">"employerID"</span>: <span class="hljs-number">20</span>,    <span class="hljs-string">"photo"</span>: <span class="hljs-string">"[object Picture]"</span>,    <span class="hljs-string">"extra"</span>: null,    <span class="hljs-string">"employer"</span>: { <span class="hljs-comment">// 単純な形式で取得されたリレートエンティティ</span>        <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">20</span>    },    <span class="hljs-string">"manager"</span>: {        <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">412</span>    }}</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-2-4"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-2-4"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 2</h4><p>プライマリーキーとスタンプを取得します:</p><pre><code class="hljs css language-4d">employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>(<span class="hljs-string">""</span>;dk with primary key+dk with stamp)</code></pre><p>戻り値:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">413</span>,   <span class="hljs-string">"__STAMP"</span>: <span class="hljs-number">1</span>,    <span class="hljs-string">"ID"</span>: <span class="hljs-number">413</span>,    <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Greg"</span>,    <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Wahl"</span>,    <span class="hljs-string">"salary"</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"1963-02-01T00:00:00.000Z"</span>,    <span class="hljs-string">"woman"</span>: false,    <span class="hljs-string">"managerID"</span>: <span class="hljs-number">412</span>,    <span class="hljs-string">"employerID"</span>: <span class="hljs-number">20</span>,    <span class="hljs-string">"photo"</span>: <span class="hljs-string">"[object Picture]"</span>,    <span class="hljs-string">"extra"</span>: null,    <span class="hljs-string">"employer"</span>: {        <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">20</span>    },    <span class="hljs-string">"manager"</span>: {        <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">412</span>    }}</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-3-2"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-3-2"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 3</h4><p>リレートエンティティズのプロパティをすべて展開します:</p><pre><code class="hljs css language-4d">employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>(<span class="hljs-string">"directReports.*"</span>)</code></pre><pre><code class="hljs css language-4d">{    <span class="hljs-string">"directReports"</span>: [        {            <span class="hljs-string">"ID"</span>: <span class="hljs-number">418</span>,            <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Lorena"</span>,            <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Boothe"</span>,            <span class="hljs-string">"salary"</span>: <span class="hljs-number">44800</span>,            <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"1970-10-02T00:00:00.000Z"</span>,            <span class="hljs-string">"woman"</span>: true,            <span class="hljs-string">"managerID"</span>: <span class="hljs-number">413</span>,            <span class="hljs-string">"employerID"</span>: <span class="hljs-number">20</span>,            <span class="hljs-string">"photo"</span>: <span class="hljs-string">"[object Picture]"</span>,            <span class="hljs-string">"extra"</span>: null,            <span class="hljs-string">"employer"</span>: {                <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">20</span>            },            <span class="hljs-string">"manager"</span>: {                <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">413</span>            }        },        {            <span class="hljs-string">"ID"</span>: <span class="hljs-number">419</span>,            <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Drew"</span>,            <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Caudill"</span>,            <span class="hljs-string">"salary"</span>: <span class="hljs-number">41000</span>,            <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"2030-01-12T00:00:00.000Z"</span>,            <span class="hljs-string">"woman"</span>: false,            <span class="hljs-string">"managerID"</span>: <span class="hljs-number">413</span>,            <span class="hljs-string">"employerID"</span>: <span class="hljs-number">20</span>,            <span class="hljs-string">"photo"</span>: <span class="hljs-string">"[object Picture]"</span>,            <span class="hljs-string">"extra"</span>: null,            <span class="hljs-string">"employer"</span>: {                <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">20</span>            },            <span class="hljs-string">"manager"</span>: {                <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">413</span>            }        },        {            <span class="hljs-string">"ID"</span>: <span class="hljs-number">420</span>,            <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Nathan"</span>,            <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Gomes"</span>,            <span class="hljs-string">"salary"</span>: <span class="hljs-number">46300</span>,            <span class="hljs-string">"birthDate"</span>: <span class="hljs-string">"2010-05-29T00:00:00.000Z"</span>,            <span class="hljs-string">"woman"</span>: false,            <span class="hljs-string">"managerID"</span>: <span class="hljs-number">413</span>,            <span class="hljs-string">"employerID"</span>: <span class="hljs-number">20</span>,            <span class="hljs-string">"photo"</span>: <span class="hljs-string">"[object Picture]"</span>,            <span class="hljs-string">"extra"</span>: null,            <span class="hljs-string">"employer"</span>: {                <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">20</span>            },            <span class="hljs-string">"manager"</span>: {                <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">413</span>            }        }    ]}</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-4-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-4-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 4</h4><p>リレートエンティティズの一部のプロパティを取得します:</p><pre><code class="hljs css language-4d"> employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>(<span class="hljs-string">"firstName, directReports.lastName"</span>)</code></pre><p>戻り値:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Greg"</span>,    <span class="hljs-string">"directReports"</span>: [        {            <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Boothe"</span>        },        {            <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Caudill"</span>        },        {            <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Gomes"</span>        }    ]}</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-5-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-5-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 5</h4><p>リレートエンティティを単純な形式で取得します:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$coll</span>:=<span class="hljs-function">New collection</span>(<span class="hljs-string">"firstName"</span>;<span class="hljs-string">"employer"</span>) employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>(<span class="hljs-variable">$coll</span>)</code></pre><p>戻り値:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Greg"</span>,    <span class="hljs-string">"employer"</span>: {        <span class="hljs-string">"__KEY"</span>: <span class="hljs-number">20</span>    }}</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-6-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-6-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 6</h4><p>リレートエンティティの全プロパティを取得します:</p><pre><code class="hljs css language-4d"> employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>(<span class="hljs-string">"employer.*"</span>)</code></pre><p>戻り値:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"employer"</span>: {        <span class="hljs-string">"ID"</span>: <span class="hljs-number">20</span>,        <span class="hljs-string">"name"</span>: <span class="hljs-string">"India Astral Secretary"</span>,        <span class="hljs-string">"creationDate"</span>: <span class="hljs-string">"1984-08-25T00:00:00.000Z"</span>,        <span class="hljs-string">"revenues"</span>: <span class="hljs-number">12000000</span>,        <span class="hljs-string">"extra"</span>: null    }}</code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-7-1"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-7-1"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 7</h4><p>リレートエンティティの一部のプロパティを取得します:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$col</span>:=New collection <span class="hljs-variable">$col</span>.<span class="hljs-function">push</span>(<span class="hljs-string">"employer.name"</span>) <span class="hljs-variable">$col</span>.<span class="hljs-function">push</span>(<span class="hljs-string">"employer.revenues"</span>) employeeObject:=employeeSelected.<span class="hljs-function">toObject</span>(<span class="hljs-variable">$col</span>)</code></pre><p>戻り値:</p><pre><code class="hljs css language-4d">{    <span class="hljs-string">"employer"</span>: {        <span class="hljs-string">"name"</span>: <span class="hljs-string">"India Astral Secretary"</span>,        <span class="hljs-string">"revenues"</span>: <span class="hljs-number">12000000</span>    }}</code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_touched-"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_touched-"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.touched( )</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.touched()</strong> : Boolean</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>ブール</td><td style="text-align:center">&lt;-</td><td>少なくとも一つのエンティティ属性が編集されていて未保存の場合に true、それ以外の場合には false</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-20"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-20"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.touched()</code> 関数は、エンティティがメモリに読み込まれてから、あるいは保存されてから、エンティティ属性が変更されたかどうかをテストします。</p><p>属性が更新あるいは計算されていた場合、関数は true を返し、それ以外は false を返します。この関数を使用することで、エンティティを保存する必要があるかどうかを確認することができます。</p><p>この関数は、(<a href="#EntityClass.html_new"><code>.new( )</code></a>で作成された) 新規エンティティに対しては常に false を返します。ただし、エンティティの属性を計算する関数を使用した場合には、<code>.touched()</code> 関数は trueを返します。 たとえば、プライマリーキーを計算するために <a href="#EntityClass.html_getkey"><code>.getKey()</code></a>を呼び出した場合、<code>.touched()</code> メソッドは true を返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-16"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-16"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><p>エンティティを保存する必要があるかどうかをチェックします:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$emp </span>: cs.EmployeeEntity <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">672</span>) <span class="hljs-variable">$emp</span>.firstName:=<span class="hljs-variable">$emp</span>.firstName <span class="hljs-comment">// 同じ値で更新されても、属性は変更されたと判定されます</span><span class="hljs-keyword"> If</span>(<span class="hljs-variable">$emp</span>.<span class="hljs-function">touched</span>()) <span class="hljs-comment">// 一つ以上の属性が変更されていた場合</span>    <span class="hljs-variable">$emp</span>.<span class="hljs-function">save</span>()<span class="hljs-keyword"> End if</span> <span class="hljs-comment">// そうでない場合はエンティティを保存する必要はありません</span></code></pre><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_touchedattributes-"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_touchedattributes-"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.touchedAttributes( )</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.touchedAttributes()</strong> : Collection</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>コレクション</td><td style="text-align:center">&lt;-</td><td>変更された属性の名前、あるいは空のコレクション</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-21"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-21"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.touchedAttributes()</code> 関数は、メモリに読み込み後に変更されたエンティティの属性名を返します。</p><p>この関数は、種類 (<a href="#EntityClass.html_kind">kind</a>) が<code>storage</code> あるいは <code>relatedEntity</code>である属性に適用されます。</p><p>リレート先のエンティティそのものが更新されていた場合(外部キーの変更)、リレートエンティティの名称とそのプライマリーキー名が返されます。</p><p>エンティティ属性がいずれも更新されていなかった場合、関数は空のコレクションを返します。</p><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-1-6"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-1-6"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 1</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$touchedAttributes </span>: Collection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$emp </span>: cs.EmployeeEntity <span class="hljs-variable">$touchedAttributes</span>:=New collection <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">725</span>) <span class="hljs-variable">$emp</span>.firstName:=<span class="hljs-variable">$emp</span>.firstName <span class="hljs-comment">// 同じで値で更新されていても、属性は変更されたと判定されます</span> <span class="hljs-variable">$emp</span>.lastName:=<span class="hljs-string">"Martin"</span> <span class="hljs-variable">$touchedAttributes</span>:=<span class="hljs-variable">$emp</span>.<span class="hljs-function">touchedAttributes</span>()  <span class="hljs-comment">//$touchedAttributes: ["firstName","lastName"]</span></code></pre><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-2-5"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-2-5"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題 2</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$touchedAttributes </span>: Collection<span class="hljs-keyword"> var</span> <span class="hljs-variable">$emp </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$company </span>: cs.CompanyEntity <span class="hljs-variable">$touchedAttributes</span>:=New collection <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">672</span>) <span class="hljs-variable">$emp</span>.firstName:=<span class="hljs-variable">$emp</span>.firstName <span class="hljs-variable">$emp</span>.lastName:=<span class="hljs-string">"Martin"</span> <span class="hljs-variable">$company</span>:=ds.Company.<span class="hljs-function">get</span>(<span class="hljs-number">121</span>) <span class="hljs-variable">$emp</span>.employer:=<span class="hljs-variable">$company</span> <span class="hljs-variable">$touchedAttributes</span>:=<span class="hljs-variable">$emp</span>.<span class="hljs-function">touchedAttributes</span>()  <span class="hljs-comment">// $touchedAttributes コレクション: ["firstName","lastName","employer","employerID"]</span></code></pre><p>この場合において:</p><ul><li>firstName および lastName はストレージ (<code>storage</code>) 型です</li><li>employer はリレートエンティティ (<code>relatedEntity</code>) 型です</li><li>employerID は、employer リレートエンティティの外部キーです</li></ul><h2><a aria-hidden="true" class="anchor" id="EntityClass.html_unlock"></a><a aria-hidden="true" class="hash-link" href="#EntityClass.html_unlock"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>.unlock()</h2><details><summary>履歴</summary><table><thead><tr><th>バージョン</th><th>内容</th></tr></thead><tbody><tr><td>v17</td><td>追加</td></tr></tbody></table></details><p><strong>.unlock()</strong> : Object</p><table><thead><tr><th>引数</th><th>タイプ</th><th style="text-align:center"></th><th>説明</th></tr></thead><tbody><tr><td>戻り値</td><td>オブジェクト</td><td style="text-align:center">&lt;-</td><td>ステータスオブジェクト</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E8%AA%AC%E6%98%8E-22"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E8%25AA%25AC%25E6%2598%258E-22"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>説明</h4><p><code>.unlock()</code> 関数は、データストアおよび、データクラスに対応するテーブル内の、対象エンティティが参照するレコードのペシミスティック・ロックを解除します 。</p><blockquote><p>詳細については <a href="#EntityClass.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%25AD%25E3%2583%2583%25E3%2582%25AD%25E3%2583%25B3%25E3%2582%25B0">エンティティロッキング</a> を参照ください。</p></blockquote><p>ロックしているプロセス内のどのエンティティからもレコードが参照されなくなった場合、自動的にレコードロックが解除されます(たとえば、エンティティのローカル参照に対してのみロックがかかっていた場合、プロセスが終了すればエンティティおよびレコードのロックは解除されます)。</p><blockquote><p>レコードがロックされている場合、ロックしているプロセスから、ロックされたエンティティ参照に対してロックを解除する必要があります:たとえば:</p></blockquote><pre><code class="hljs css language-4d"> <span class="hljs-variable">$e1</span>:=ds.Emp.<span class="hljs-function">all</span>()[<span class="hljs-number">0</span>] <span class="hljs-variable">$e2</span>:=ds.Emp.<span class="hljs-function">all</span>()[<span class="hljs-number">0</span>] <span class="hljs-variable">$res</span>:=<span class="hljs-variable">$e1</span>.<span class="hljs-function">lock</span>() <span class="hljs-comment">//$res.success=true</span> <span class="hljs-variable">$res</span>:=<span class="hljs-variable">$e2</span>.<span class="hljs-function">unlock</span>() <span class="hljs-comment">//$res.success=false</span> <span class="hljs-variable">$res</span>:=<span class="hljs-variable">$e1</span>.<span class="hljs-function">unlock</span>() <span class="hljs-comment">//$res.success=true</span></code></pre><p><strong>戻り値</strong></p><p><code>.unlock()</code> によって返されるオブジェクトには以下のプロパティが格納されます:</p><table><thead><tr><th>プロパティ</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>success</td><td>Boolean</td><td>ロック解除が成功した場合には true、それ以外は falseドロップされたエンティティや、ロックされてないレコード、あるいは他のプロセスや他のエンティティによってロックされたレコードに対してロック解除を実行した場合、successには false が返されます。</td></tr></tbody></table><h4><a aria-hidden="true" class="anchor" id="EntityClass.html_%E4%BE%8B%E9%A1%8C-17"></a><a aria-hidden="true"class="hash-link" href="#EntityClass.html_%25E4%25BE%258B%25E9%25A1%258C-17"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$employee </span>: cs.EmployeeEntity<span class="hljs-keyword"> var</span> <span class="hljs-variable">$status </span>: Object <span class="hljs-variable">$employee</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">725</span>) <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">lock</span>() ... <span class="hljs-comment">// 処理</span> <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$employee</span>.<span class="hljs-function">unlock</span>()<span class="hljs-keyword"> If</span>(<span class="hljs-variable">$status</span>.success)<span class="hljs-function">    ALERT</span>(<span class="hljs-string">"エンティティのロックは解除されました。"</span>)<span class="hljs-keyword"> End if</span></code></pre><style><![CDATA[ h2 { background: #d9ebff;}]]></style></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#EmailObjectClass.html"><span class="arrow-prev">←</span><span>Email</span></a><a class="docs-next button" href="#EntitySelectionClass.html"><span class="function-name-prevnext">EntitySelection</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#EntityClass.html_attributename">.<em>attributeName</em></a></li><li><a href="#EntityClass.html_clone">.clone()</a></li><li><a href="#EntityClass.html_diff">.diff()</a></li><li><a href="#EntityClass.html_drop">.drop()</a></li><li><a href="#EntityClass.html_first">.first()</a></li><li><a href="#EntityClass.html_fromobject">.fromObject()</a></li><li><a href="#EntityClass.html_getdataclass">.getDataClass()</a></li><li><a href="#EntityClass.html_getkey">.getKey()</a></li><li><a href="#EntityClass.html_getremotecontextattributes">.getRemoteContextAttributes()</a></li><li><a href="#EntityClass.html_getselection">.getSelection()</a></li><li><a href="#EntityClass.html_getstamp">.getStamp()</a></li><li><a href="#EntityClass.html_indexof">.indexOf()</a></li><li><a href="#EntityClass.html_isnew">.isNew()</a></li><li><a href="#EntityClass.html_last">.last()</a></li><li><a href="#EntityClass.html_lock">.lock()</a></li><li><a href="#EntityClass.html_next">.next()</a></li><li><a href="#EntityClass.html_previous">.previous()</a></li><li><a href="#EntityClass.html_reload-">.reload( )</a></li><li><a href="#EntityClass.html_save">.save()</a></li><li><a href="#EntityClass.html_toobject">.toObject()</a></li><li><a href="#EntityClass.html_touched-">.touched( )</a></li><li><a href="#EntityClass.html_touchedattributes-">.touchedAttributes()</a></li><li><a href="#EntityClass.html_unlock">.unlock()</a></li></ul></nav></div></div></body></html>