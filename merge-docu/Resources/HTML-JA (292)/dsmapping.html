<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="ja"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>データモデルオブジェクト · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="ORDA は、下地であるデータベースストラクチャーへの自動マッピングに基づいた技術です。 ORDA は、エンティティやエンティティセレクションオブジェクトを介してデータへのアクセスも提供します。 結果的に ORDA は、データモデルオブジェクト一式の形でデータベース全体を公開します。"name="description" /><meta content="ja" name="docsearch:language" /><meta content="データモデルオブジェクト · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="ORDA は、下地であるデータベースストラクチャーへの自動マッピングに基づいた技術です。 ORDA は、エンティティやエンティティセレクションオブジェクトを介してデータへのアクセスも提供します。 結果的に ORDA は、データモデルオブジェクト一式の形でデータベース全体を公開します。"property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#dsMapping.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">データモデルオブジェクト<a aria-hidden="true" class="anchor" id="dsmapping.html"></a></h1></header><article><div><p><span>ORDA は、下地であるデータベースストラクチャーへの自動マッピングに基づいた技術です。 ORDAは、エンティティやエンティティセレクションオブジェクトを介してデータへのアクセスも提供します。 結果的に ORDAは、データモデルオブジェクト一式の形でデータベース全体を公開します。</span></p><h2><span><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%83%81%E3%83%A3%E3%83%BC%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2582%25B9%25E3%2583%2588%25E3%2583%25A9%25E3%2582%25AF%25E3%2583%2581%25E3%2583%25A3%25E3%2583%25BC%25E3%2583%259E%25E3%2583%2583%25E3%2583%2594%25E3%2583%25B3%25E3%2582%25B0"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>ストラクチャーマッピング</span></h2><p><span><a href="#dsmapping.html_ds"><code>ds</code></a> および<a href="#dsmapping.html_open-datastore"><code>Opendatastore</code></a> コマンドを使ってデータストアを呼び出すと、戻り値の <a href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25B9%25E3%2583%2588%25E3%2582%25A2">データストア</a> オブジェクトには、対応する 4Dストラクチャーのテーブルとフィールドへの参照が属性として格納されています:</span></p><ul><li><span>テーブルはデータクラスへとマップされます。</span></li><li><span>フィールドはストレージ属性へとマップされます。</span></li><li><span>リレーションはリレーション属性へとマップされます。ストラクチャーエディター内で定義されたリレーション名はリレーション属性名として使用されます。</span></li></ul><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/datastoreMapping.png" /></span></p><h3><span><a aria-hidden="true" class="anchor" id="dsmapping.html_%E5%A4%89%E6%8F%9B%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E5%25A4%2589%25E6%258F%259B%25E3%2581%25AE%25E3%2583%25AB%25E3%2583%25BC%25E3%2583%25AB"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>変換のルール</span></h3><p><span>変換の際には以下のルールが適用されます:</span></p><ul><li><span>テーブル、フィールド、そしてリレーション名はオブジェクトプロパティ名へとマップされます。それらの名前が標準のオブジェクト命名規則に則っているようにしてください (<a href="#identifiers.html">識別子の命名規則</a> 参照)。</span></li><li><span>データストアは単一のプライマリーキーを持つテーブルのみを参照します。以下のテーブルは参照されません:</span><ul><li><span>プライマリーキーがないテーブル</span></li><li><span>複合プライマリーキーを持つテーブル</span></li></ul></li><li><span>BLOBフィールドは、<a href="#dsmapping.html_blob-%25E3%2581%25AE%25E7%25A8%25AE%25E9%25A1%259E">BLOBオブジェクト</a> 型の属性として利用可能です。</span></li></ul><blockquote><p><span>ORDA のデータストアマッピングでは、次のものは考慮されません:</span></p><ul><li><span>テーブルあるいはフィールドの"非表示"オプション<br />- <code>SET TABLE TITLES</code> あるいは <code>SET FIELD TITLES</code>を通して定義されたバーチャルストラクチャー<br />- リレーションの"手動"あるいは"自動"プロパティ</span></li></ul></blockquote><h3><span><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%88%E3%82%A2%E3%81%AE%E5%88%A9%E7%94%A8"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2583%25AA%25E3%2583%25A2%25E3%2583%25BC%25E3%2583%2588%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25B9%25E3%2583%2588%25E3%2582%25A2%25E3%2581%25AE%25E5%2588%25A9%25E7%2594%25A8"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>リモートデータストアの利用</span></h3><p><span><code>Open datastore</code> コマンドまたは <a href="#gettingStarted.html">REST リクエスト</a>によってリモートデータストアにアクセスする場合、<strong>RESTリソースとして公開</strong>プロパティが設定されているテーブルとフィールドのみ利用可能です。</span></p><p><span>このプロパティは、データストアにデータクラスおよび属性として公開したい各テーブルおよびフィールドについて 4Dストラクチャーのレベルで設定する必要があります:</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/ExposeDataclass.png" /></span></p><h3><span><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%83%87%E3%83%BC%E3%82%BF%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2583%25A2%25E3%2583%2587%25E3%2583%25AB%25E3%2581%25AE%25E3%2582%25A2%25E3%2583%2583%25E3%2583%2597%25E3%2583%2587%25E3%2583%25BC%25E3%2583%2588"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>データモデルのアップデート</span></h3><p><span>データベースストラクチャーレベルで変更がおこなわれると、カレントの ORDA モデルレイヤーは無効化されます。これらの変更には、以下のものが含まれます:</span></p><ul><li><span>テーブル、フィールド、リレーションの追加または削除</span></li><li><span>テーブル、フィールド、リレーションの名称変更</span></li><li><span>フィールドの核となるプロパティ (型、重複不可、インデックス、自動インクリメント、null値サポートなど)の変更</span></li></ul><p><span>カレントの ORDA モデルレイヤーが無効化されると、その後 4D または 4D Server のローカルの<code>ds</code> データストアを呼び出した時にモデルレイヤーが自動的に再読み込みされ、更新されます。ただし、エンティティやエンティティセレクションなど、ORDAオブジェクトへの既存の参照は、再生成されるまではそれらが作成されたときのモデルを使用し続けるという点に注意してください。</span></p><p><span>また、アップデートされた ORDAモデルレイヤーは、以下のコンテキストにおいては自動的には利用可能にはなりません:</span></p><ul><li><span>4D Server に接続したリモートの 4D --リモートのアプリケーションはサーバーに再接続する必要があります</span></li><li><span><code>Open datastore</code> または <a href="#gettingStarted.html">REST 呼び出し</a> を使用して開かれたリモートデータストア --新しいセッションを開く必要があります</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2582%25AA%25E3%2583%2596%25E3%2582%25B8%25E3%2582%25A7%25E3%2582%25AF%25E3%2583%2588%25E3%2581%25AE%25E5%25AE%259A%25E7%25BE%25A9"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>オブジェクトの定義</span></h2><h3><span><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%88%E3%82%A2"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25B9%25E3%2583%2588%25E3%2582%25A2"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>データストア</span></h3><p><span>データストアは、データベースへのインターフェースオブジェクトです。データベース全体を反映したものをオブジェクトとしてビルドします。 データストアは <strong>モデル</strong> と<strong>データ</strong> から構成されています:</span></p><ul><li><span>モデルにはデータストアを構成するすべてのデータクラスが格納され、その詳細な情報も含まれます。これはその下地にあるデータベース自体からは独立した存在です。</span></li><li><span>データとは、そのモデル内で使用・保存される情報を指します。たとえば、従業員の名前、住所、生年月日などはデータストア内で扱うことができるデータに含まれます。</span></li></ul><p><span>コード内で扱うにあたっては、データストアはオブジェクトであり、公開されているすべての <a href="#dsmapping.html_dataclass">データクラス</a> をプロパティとして持ちます。</span></p><p><span>4D では次のデータストアを扱うことができます:</span></p><ul><li><span>カレント 4D データベースに基づいた、ローカルデータストア。これは、<code>ds</code>コマンドで返されるメインデータストアです。</span></li><li><span>リモートデータベースによって RESTリソースとして公開された、一つ以上のリモートデータストア。これらは、<code>Open datastore</code>コマンドで返されます。</span></li></ul><p><span>データストアは単一の、ローカルあるいはリモートのデータベースを参照します。</span></p><p><span>データストアオブジェクト自身は、オブジェクトとしてコピーすることはできません:</span></p><pre><span><code class="hljs css language-4d"><span class="hljs-variable">$mydatastore</span>:=<span class="hljs-function">OB Copy</span>(ds) <span class="hljs-comment">// null を返します</span></code></span></pre><p>しかしながらデータストアプロパティは取得可能です:</p><pre><code class="hljs css language-4d"><span class="hljs-function"> ARRAY TEXT</span>(<span class="hljs-variable">$prop</span>;<span class="hljs-number">0</span>)<span class="hljs-function"> OB GET PROPERTY NAMES</span>(ds;<span class="hljs-variable">$prop</span>)  <span class="hljs-comment">// $prop にはすべてのデータクラスの名前が格納されます</span></code></pre><p>メイン (デフォルト) のデータストアは <code>ds</code> コマンドを通して常に利用可能です。<code>Opendatastore</code> コマンドを使えば、あらゆるリモートデータストアを参照することができます。</p><h3><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%83%87%E3%83%BC%E3%82%BF%E3%82%AF%E3%83%A9%E3%82%B9"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25B9"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>データクラス</h3><p>データクラスとは、テーブルに相当するものです。 オブジェクトモデルとして使用され、リレーショナル属性(データクラス間のリレーションに基づいてビルドされた属性) を含めてすべてのフィールドを属性として参照します。リレーショナル属性はクエリにおいて通常の属性のように使用することができます。</p><p>4D プロジェクト内のすべてのデータクラスは、<code>ds</code> データストアのプロパティとして利用可能です。<code>Open datastore</code> コマンドまたは <a href="#gettingStarted.html">REST リクエスト</a>によってアクセスするリモートデータストアの場合、データストアのデータクラスとして公開したい各テーブルについて 4Dストラクチャーのレベルで <strong>RESTリソースとして公開</strong> プロパティを設定する必要があります。</p><p>たとえば、4D ストラクチャー内の以下のテーブルについて考えます。</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/companyTable.png" /></p><p><code>Company</code> テーブルは <code>ds</code>データストア内のデータクラスとして自動的に利用可能です。 以下のように書くことができます:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">var</span> <span class="hljs-variable">$compClass </span>: cs.Company <span class="hljs-comment">// Company クラスのオブジェクト変数として $compClass を宣言します</span><span class="hljs-variable">$compClass</span>:=ds.Company <span class="hljs-comment">// Company データクラスへの参照を $compClass に代入します</span></code></pre><p>データクラスオブジェクトは以下のものを格納することができます:</p><ul><li>attributes</li><li>リレーション属性</li></ul><p>データクラスは実際のデータベースの概略を提供し、概念的なデータモデルの管理を可能にします。データクラスはデータストアをクエリする唯一の方法です。 クエリは単一のデータクラスを通して実行されます。クエリはデータクラスの属性およびリレーション属性名に基づいてビルドされます。リレーション属性は、一つのクエリ内で複数のリンクされたテーブルを用いる手段です。</p><p>データクラスオブジェクト自身は、オブジェクトとしてコピーすることはできません:</p><pre><code class="hljs css language-4d"><span class="hljs-variable">$mydataclass</span>:=<span class="hljs-function">OB Copy</span>(ds.Employee) <span class="hljs-comment">// null を返します</span></code></pre><p>しかしながらデータクラスプロパティは取得可能です:</p><pre><code class="hljs css language-code4d">ARRAY <span class="hljs-constructor">TEXT($<span class="hljs-params">prop</span>;0)</span>OB GET PROPERTY <span class="hljs-constructor">NAMES(<span class="hljs-params">ds</span>.Employee;$<span class="hljs-params">prop</span>)</span><span class="hljs-comment">// $prop にはすべてのデータクラス属性の名前が格納されます</span></code></pre><h3><a aria-hidden="true" class="anchor" id="dsmapping.html_%E5%B1%9E%E6%80%A7"></a><a aria-hidden="true"class="hash-link" href="#dsmapping.html_%25E5%25B1%259E%25E6%2580%25A7"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>属性</h3><p>データクラスプロパティは、下地にあるフィールドやリレーションを説明する属性オブジェクトです。 たとえば:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$nameAttribute</span>:=ds.Company.name <span class="hljs-comment">// クラス属性への参照</span> <span class="hljs-variable">$revenuesAttribute</span>:=ds.Company[<span class="hljs-string">"revenues"</span>] <span class="hljs-comment">// 別の書き方</span></code></pre><p>このコードは、<code>$nameAttribute</code> および<code>$revenuesAttribute</code> に、<code>Company</code> クラスの nameおよび revenues 属性の参照をそれぞれ代入します。このシンタックスは属性内に保管されている値を返すのではありません。その代わりに、属性自身への参照を返します。値を管理するためには、<a href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3">エンティティ</a>を使用する必要があります。</p><p>テーブル内の適格なフィールドはすべて、親 <a href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25B9">データクラス</a> の属性として利用可能です。 <code>Open datastore</code> コマンドまたは<a href="#gettingStarted.html">REST リクエスト</a>によってアクセスするリモートデータストアの場合、データクラスの属性として公開したい各フィールドについて 4D ストラクチャーのレベルで<strong>RESTリソースとして公開</strong> プロパティを設定する必要があります。</p><h4><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E5%B1%9E%E6%80%A7%E3%81%A8%E3%83%AA%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%B1%9E%E6%80%A7"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2582%25B9%25E3%2583%2588%25E3%2583%25AC%25E3%2583%25BC%25E3%2582%25B8%25E5%25B1%259E%25E6%2580%25A7%25E3%2581%25A8%25E3%2583%25AA%25E3%2583%25AC%25E3%2583%25BC%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%25E5%25B1%259E%25E6%2580%25A7"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>ストレージ属性とリレーション属性</h4><p>データクラス属性にはいくつかの種類があります。ストレージ、リレートエンティティ、リレートエンティティズです。 スカラーである属性(単一の値のみを提供するもの) は標準の 4D データ型 (整数、テキスト、オブジェクトなど) をサポートします。</p><ul><li><strong>ストレージ属性</strong> は4Dデータベース内のフィールドに相当するもので、インデックスをつけることができます。ストレージ属性に割り当てられた値は、保存時にエンティティの一部として保存されます。ストレージ属性にアクセスしたとき、その値はデータストアから直接取り出されます。ストレージ属性はエンティティを構成するもっとも基礎的な要素であり、名前とデータ型により定義されます。</li><li><strong>リレーション属性</strong> は他のエンティティへのアクセスを提供します。リレーション属性は単一のエンティティ (あるいはエンティティなし) あるいはエンティティセレクション (0からNまでのエンティティ)のどちらかになります。 リレーション属性はリレーショナルストラクチャーの "クラシックな"リレーションに基づいており、リレートエンティティあるいはリレートエンティティズへの直接的なアクセスを提供します。リレーション属性は、ORDA においては名前を使用することで直接的に利用可能です。</li></ul><p>たとえば、以下の部分的なデータベースストラクチャーと、そのリレーションプロパティについて考えます:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/relationProperties.png" /></p><p>すべてのストレージ属性は自動的に利用可能です:</p><ul><li>Project データクラス内: "ID", "name", および "companyID"</li><li>Company データクラス内: "ID", "name", および "discount"</li></ul><p>これに加えて、以下のリレーション属性もまた自動的に利用可能になります:</p><ul><li>Project データクラス内: "リレートエンティティ" 型の <strong>theClient</strong>属性。各 Project (クライアント) に対して最大 1つの Companyが あります。</li><li>Company データクラス内: "リレートエンティティズ"型の<strong>companyProjects</strong> 属性。各 Company に対して不定数の Projectがあります。</li></ul><blockquote><p>データベースリレーションの手動あるいは自動プロパティは、ORDA においては何の効力も持ちません。</p></blockquote><p>すべてのデータクラス属性はデータクラスのプロパティとして公開されています:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/dataclassProperties.png" /></p><p>これらのオブジェクトは属性を表しますが、データへのアクセスは与えないという点に注意してください。 データの読み書きは<a href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E5%25B1%259E%25E6%2580%25A7%25E3%2581%25AE%25E4%25BD%25BF%25E7%2594%25A8">エンティティオブジェクト</a> を通しておこなわれます。</p><h4><a aria-hidden="true" class="anchor" id="dsmapping.html_%E8%A8%88%E7%AE%97%E5%B1%9E%E6%80%A7"></a><a aria-hidden="true"class="hash-link" href="#dsmapping.html_%25E8%25A8%2588%25E7%25AE%2597%25E5%25B1%259E%25E6%2580%25A7"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>計算属性</h4><p><a href="#dsmapping.html_%25E8%25A8%2588%25E7%25AE%2597%25E5%25B1%259E%25E6%2580%25A7">計算属性</a> は、<a href="#dsmapping.html_entity-%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25B9">Entityクラスの定義</a> で <code>get &lt;attributeName&gt;</code> 関数を使用して宣言されます。この属性値はアクセスされるたびに評価され、保存されません。計算属性は、基礎となるデータベースストラクチャーには属しませんが、その上に構築され、データモデルの属性と同様に使用することができます。</p><h3><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%82%A8%E3%83%B3%E3%83%86%E3%82%A3%E3%83%86%E3%82%A3"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>エンティティ</h3><p>エンティティとは、レコードに相当するものです。 実際にはデータベース内のレコードを参照するオブジェクトです。エンティティは、<a href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25B9">データクラス</a>のインスタンスとも解釈可能なオブジェクトです。同時にエンティティは、データストアがもとにしているデータベースに相関するデータも格納しています。</p><p>エンティティの目的はデータの管理 (作成、更新、削除) です。エンティティセレクションを用いてエンティティ参照を取得した場合、その参照にはエンティティセレクションについての情報も保持されるため、セレクションを走査することが可能です。</p><p>エンティティオブジェクト自身は、オブジェクトとしてコピーすることはできません:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$myentity</span>:=<span class="hljs-function">OB Copy</span>(ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>)) <span class="hljs-comment">// null を返します</span></code></pre><p>しかしながらエンティティプロパティは取得可能です:</p><pre><code class="hljs css language-4d"><span class="hljs-function"> ARRAY TEXT</span>(<span class="hljs-variable">$prop</span>;<span class="hljs-number">0</span>)<span class="hljs-function"> OB GET PROPERTY NAMES</span>(ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>);<span class="hljs-variable">$prop</span>)  <span class="hljs-comment">// $prop にはすべてのエンティティ属性の名前が格納されます</span></code></pre><h3><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%82%A8%E3%83%B3%E3%83%86%E3%82%A3%E3%83%86%E3%82%A3%E3%82%BB%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2582%25BB%25E3%2583%25AC%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>エンティティセレクション</h3><p>エンティティセレクションとは、同じデータクラスに所属する一つ以上のエンティティへの参照を格納しているオブジェクトのことです。通常、クエリの結果として、あるいはリレーション属性の戻り値として作成されます。 エンティティセレクションは、データクラスから0個、1個、あるいは X個のエンティティを格納することができます (Xはデータクラスに格納されているエンティティの総数です)。</p><p>例:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">var</span> <span class="hljs-variable">$e </span>: cs.EmployeeSelection <span class="hljs-comment">// EmployeeSelection クラスのオブジェクト変数として $e を宣言します</span><span class="hljs-variable">$e</span>:=ds.Employee.<span class="hljs-function">all</span>() <span class="hljs-comment">// 結果のエンティティセレクションへの参照を $e に代入します</span></code></pre><p>エンティティセレクションは "順列あり" あるいは "順列なし" 状態のどちらかです (<a href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2582%25BB%25E3%2583%25AC%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%25E3%2581%25AE%25E9%25A0%2586%25E5%2588%2597%25E3%2581%2582%25E3%2582%258A%25E9%25A0%2586%25E5%2588%2597%25E3%2581%25AA%25E3%2581%2597">後述参照</a>)。</p><blockquote><p>また、<a href="#dsmapping.html_%25E5%2585%25B1%25E6%259C%2589%25E5%258F%25AF%25E8%2583%25BD%25E8%25BF%25BD%25E5%258A%25A0%25E5%258F%25AF%25E8%2583%25BD%25E3%2581%25AA%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2582%25BB%25E3%2583%25AC%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3">どのように作成されたか</a>に応じて、エンティティセレクションは "共有可能" あるいは "追加可能" 状態のどちらかです。</p></blockquote><p>エンティティセレクションオブジェクト自身は、オブジェクトとしてコピーすることはできません:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$myentitysel</span>:=<span class="hljs-function">OB Copy</span>(ds.Employee.<span class="hljs-function">all</span>()) <span class="hljs-comment">// null を返します</span></code></pre><p>しかしながらエンティティセレクションプロパティは取得可能です:</p><pre><code class="hljs css language-4d"><span class="hljs-function"> ARRAY TEXT</span>(<span class="hljs-variable">$prop</span>;<span class="hljs-number">0</span>)<span class="hljs-function"> OB GET PROPERTY NAMES</span>(ds.Employee.<span class="hljs-function">all</span>();<span class="hljs-variable">$prop</span>)  <span class="hljs-comment">// $prop にはエンティティセレクションのプロパティ名が格納されます</span>  <span class="hljs-comment">// ("length", "00", "01"...)</span></code></pre><h4><a aria-hidden="true" class="anchor" id="dsmapping.html_%E3%82%A8%E3%83%B3%E3%83%86%E3%82%A3%E3%83%86%E3%82%A3%E3%82%BB%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%A0%86%E5%88%97%E3%81%82%E3%82%8A%E9%A0%86%E5%88%97%E3%81%AA%E3%81%97"></a><a aria-hidden="true" class="hash-link" href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2582%25BB%25E3%2583%25AC%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3%25E3%2581%25AE%25E9%25A0%2586%25E5%2588%2597%25E3%2581%2582%25E3%2582%258A%25E9%25A0%2586%25E5%2588%2597%25E3%2581%25AA%25E3%2581%2597"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>エンティティセレクションの順列あり/順列なし</h4><p><code>orderBy( )</code> メソッドを使用した場合、あるいは特定のオプションを使用した場合は除き、4DORDA は最適化の観点からデフォルトで順列なしのエンティティセレクションを作成します。このドキュメントでは、指定されている場合を除き、"エンティティセレクション" は "順列なしのエンティティセレクション"を指すこととします。</p><p>順列ありのエンティティセレクションは、必要な場合において、あるいはオプションを使用して特別に要求した場合に限り作成されます。たとえば、以下のような場合です:</p><ul><li>セレクション (タイプを問わず) に対して、あるいはデータクラスに対して <code>orderBy( )</code>を使った場合の戻り値</li><li><code>newSelection( )</code> メソッドに <code>dk keep ordered</code>オプションを渡した場合の戻り値</li></ul><p>順列なしのエンティティセレクションは以下のような場合に作成されます:</p><ul><li>セレクション (タイプを問わず) に対して、あるいはデータクラスに対して標準の <code>query( )</code>を使った場合の戻り値</li><li>オプションなしで <code>newSelection( )</code> メソッドを使用した場合の戻り値</li><li>任意の演算メソッド (or( ), and( ), minus( ) ) を使った場合の戻り値(入力セレクションタイプは問いません)。</li></ul><blockquote><p>次のエンティティセレクションは常に <strong>順列あり</strong> となります。</p><ul><li>4D Server からリモートクライアントに返されるエンティティセレクション</li><li>リモートデータストアにおいて作成されるエンティティセレクション</li></ul></blockquote><p>順列ありのエンティティセレクションが順列なしのエンティティセレクションになった場合、重複したエンティティ参照はすべて削除されます。</p></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#overview.html"><span class="arrow-prev">←</span><span>ORDAとは何か</span></a><a class="docs-next button" href="#ordaClasses.html"><span>データモデルクラス</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#dsmapping.html_%25E3%2582%25B9%25E3%2583%2588%25E3%2583%25A9%25E3%2582%25AF%25E3%2583%2581%25E3%2583%25A3%25E3%2583%25BC%25E3%2583%259E%25E3%2583%2583%25E3%2583%2594%25E3%2583%25B3%25E3%2582%25B0">ストラクチャーマッピング</a><ul class="toc-headings"><li><a href="#dsmapping.html_%25E5%25A4%2589%25E6%258F%259B%25E3%2581%25AE%25E3%2583%25AB%25E3%2583%25BC%25E3%2583%25AB">変換のルール</a></li><li><a href="#dsmapping.html_%25E3%2583%25AA%25E3%2583%25A2%25E3%2583%25BC%25E3%2583%2588%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25B9%25E3%2583%2588%25E3%2582%25A2%25E3%2581%25AE%25E5%2588%25A9%25E7%2594%25A8">リモートデータストアの利用</a></li><li><a href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2583%25A2%25E3%2583%2587%25E3%2583%25AB%25E3%2581%25AE%25E3%2582%25A2%25E3%2583%2583%25E3%2583%2597%25E3%2583%2587%25E3%2583%25BC%25E3%2583%2588">データモデルのアップデート</a></li></ul></li><li><a href="#dsmapping.html_%25E3%2582%25AA%25E3%2583%2596%25E3%2582%25B8%25E3%2582%25A7%25E3%2582%25AF%25E3%2583%2588%25E3%2581%25AE%25E5%25AE%259A%25E7%25BE%25A9">オブジェクトの定義</a><ul class="toc-headings"><li><a href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25B9%25E3%2583%2588%25E3%2582%25A2">データストア</a></li><li><a href="#dsmapping.html_%25E3%2583%2587%25E3%2583%25BC%25E3%2582%25BF%25E3%2582%25AF%25E3%2583%25A9%25E3%2582%25B9">データクラス</a></li><li><a href="#dsmapping.html_%25E5%25B1%259E%25E6%2580%25A7">属性</a></li><li><a href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3">エンティティ</a></li><li><a href="#dsmapping.html_%25E3%2582%25A8%25E3%2583%25B3%25E3%2583%2586%25E3%2582%25A3%25E3%2583%2586%25E3%2582%25A3%25E3%2582%25BB%25E3%2583%25AC%25E3%2582%25AF%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%25B3">エンティティセレクション</a></li></ul></li></ul></nav></div></div></body></html>