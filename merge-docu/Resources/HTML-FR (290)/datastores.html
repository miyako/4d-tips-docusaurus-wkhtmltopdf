<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="fr"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Utiliser un datastore distant · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="Un [datastore](/docs/Rx/fr/ORDA/dsmapping.html#datastore) exposé sur une application 4D Server est accessible simultanément via différents clients :"name="description" /><meta content="fr" name="docsearch:language" /><meta content="Utiliser un datastore distant · 4D Documentation"property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="Un [datastore](/docs/Rx/fr/ORDA/dsmapping.html#datastore) exposé sur une application 4D Server est accessible simultanément via différents clients :"property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#remoteDatastores.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Utiliser un datastoredistant<a aria-hidden="true" class="anchor" id="datastores.html"></a></h1></header><article><div><p><span>Un <a href="#datastores.html_datastore">datastore</a>exposé sur une application 4D Server est accessible simultanémentvia différents clients :</span></p><ul><li><span>Les applications 4D distantes utilisant ORDA pour accéderau datastore principal à l’aide de la commande <code>ds</code>. Anoter que l'application 4D distante peut toujours accéder à la basede données en mode classique. Ces accès sont gérés par le<strong>serveur d'applications 4D</strong>.</span></li><li><span>D'autres applications 4D (4D Remote, 4D Server) ouvrantune session sur le datastore distant via la commande <a href="#datastores.html_open-datastore"><code>Open datastore</code></a>.Ces accès sont transmis par le <strong>serveur HTTPREST</strong>.</span></li><li><span>Les requêtes <a href="https://developer.4d.com/go-mobile/">4D for iOS ou 4D forAndroid</a> pour la mise à jour des applications mobiles. Ces accèssont remis par le <strong>serveur HTTP</strong>.</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="datastores.html_ouverture-des-sessions"></a><a aria-hidden="true"class="hash-link" href="#datastores.html_ouverture-des-sessions"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ouverture des sessions</span></h2><p><span>Lorsque vous travaillez avec un datastore distantréférencé par des appels à la commande <code>Open datastore</code>,la connexion entre les process qui effectuent la requête et ledatastore distant est gérée par des sessions.</span></p><p><span>Une session est créée sur le datastore distant pour gérerla connexion. Cette session est identifiée à l'aide d'un ID desession interne, associé au <code>localID</code> de l'application4D. Cette session gère automatiquement l'accès aux données, auxsélections d'entités ou aux entités.</span></p><p><span>Le <code>localID</code> est local à la machine qui seconnecte au datastore distant, ce qui signifie :</span></p><ul><li><span>Que si d'autres process de la même application doiventaccéder au même datastore distant, ils peuvent utiliser le même<code>localID</code> et partager alors la même session.</span></li><li><span>Que si un autre process de la même application ouvre lemême datastore distant, mais avec un autre <code>localID</code>, ilcréera une nouvelle session sur le datastore distant.</span></li><li><span>Que si un autre poste se connecte au même datastoredistant avec le même <code>localID</code>, il créera une autresession avec un autre cookie.</span></li></ul><p><span>Ces principes sont illustrés dans les graphiques suivants:</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/sessions.png" /></span></p><blockquote><p><span>Pour les sessions ouvertes par des requêtes REST, veuillezconsulter la page <a href="#authUsers.html">Utilisateurs etsessions</a>.</span></p></blockquote><h3><span><a aria-hidden="true" class="anchor" id="datastores.html_visionnage-des-sessions"></a><a aria-hidden="true"class="hash-link" href="#datastores.html_visionnage-des-sessions"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Visionnage des sessions</span></h3><p><span>Les process qui gèrent les sessions d'accès aux datastoreapparaissent dans la fenêtre d'administration de 4D Server:</span></p><ul><li><span>&lt;process name&gt;nom : "Gestionnaire REST : &lt; nomdu process &gt; "</span></li><li><span>type : type Worker Server HTTP</span></li><li><span>session : le nom de session est le nom d'utilisateurpassé à la commande <code>Open datastore</code>.</span></li></ul><p><span>Dans l'exemple suivant, deux process sont en coursd'exécution pour la même session :</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/sessionAdmin.png" /></span></p><h3><span><a aria-hidden="true" class="anchor" id="datastores.html_verrouillage-et-transactions"></a><a aria-hidden="true" class="hash-link" href="#datastores.html_verrouillage-et-transactions"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Verrouillage et transactions</span></h3><p><span>Les fonctionnalités ORDA relatives au verrouillaged'entité et aux transactions sont gérées au niveau du process dansles datastore distants, tout comme en mode client/serveur ORDA:</span></p><ul><li><span>Si un process verrouille une entité à partir d'undatastore distant, l'entité est verrouillée pour tous les autresprocess, même lorsque ces process partagent la même session (voir<a href="#datastores.html_entity-locking">Verrouillaged'entités</a>). Si plusieurs entités pointant vers le mêmeenregistrement ont été verrouillées dans un process, elles doiventtoutes être déverrouillées dans le process pour supprimer leverrou. Si un verrou a été mis sur une entité, il est supprimélorsqu'il n'existe plus de référence à cette entité enmémoire.</span></li><li><span>Les transactions peuvent être lancées, validées ouannulées séparément sur chaque datastore distant à l'aide desméthodes <code>dataStore.startTransaction( )</code>,<code>dataStore.cancelTransaction( )</code>, et<code>dataStore.validateTransaction( )</code>. Elles n’ont pasd’incidences sur les autres datastore.</span></li><li><span>Les commandes classiques du langage 4D (<code>STARTTRANSACTION</code>, <code>VALIDATE TRANSACTION</code>, <code>CANCELTRANSACTION</code>) s'appliquent uniquement au datastore principal(renvoyé par <code>ds</code>). Si une entité d'un datastore distantest verrouillée par une transaction dans un process, les autresprocess ne peuvent pas la mettre à jour, même si ces processpartagent la même session.</span></li><li><span>Les verrous sur les entités sont supprimés et lestransactions sont annulées :</span><ul><li><span>quand le processus est tué.</span></li><li><span>quand la session est fermée sur le serveur</span></li><li><span>lorsque la session est arrêtée à partir de la fenêtred’administration du serveur.</span></li></ul></li></ul><h3><span><a aria-hidden="true" class="anchor" id="datastores.html_fermeture-des-sessions"></a><a aria-hidden="true"class="hash-link" href="#datastores.html_fermeture-des-sessions"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Fermeture des sessions</span></h3><p><span>Une session est automatiquement fermée par 4D lorsqu'iln'y a pas eu d'activité durant son timeout. Le timeout par défautest de 60 mn mais cette valeur peut être paramétrée à l'aide duparamètre <em>connectionInfo</em> de la commande <code>Opendatastore</code>.</span></p><p><span>Si une demande est envoyée au datastore distant après lafermeture de la session, elle est automatiquement recréée sipossible (licence disponible, serveur non arrêté, etc.). A notercependant que le contexte de la session des verrous et destransactions est perdu (voir ci-dessus).</span></p><h2><span><a aria-hidden="true" class="anchor" id="datastores.html_optimisation-clientserveur"></a><a aria-hidden="true" class="hash-link" href="#datastores.html_optimisation-clientserveur"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Optimisation client/serveur</span></h2><p><span>4D optimise automatiquement les requêtes ORDA quiutilisent des entity selections ou qui chargent des entités dansdes configurations client/serveur (datastore accessible à distanceà l'aide de <code>ds</code> ou de <code>Open datastore</code>). Cesoptimisations accélèrent l'exécution de votre application 4D enréduisant drastiquement le volume d'informations transmises sur leréseau. Elles incluent :</span></p><ul><li><span>le <strong>contexte d'optimisation</strong></span></li><li><span>le <strong>cache ORDA</strong></span></li></ul><h3><span><a aria-hidden="true" class="anchor" id="datastores.html_contexte"></a><a aria-hidden="true" class="hash-link" href="#datastores.html_contexte"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Contexte</span></h3><p><span>Le contexte d'optimisation est fondé sur ce qui suit:</span></p><ul><li><p><span>Lorsqu'un client demande une sélection d'entité auserveur, 4D "apprend" automatiquement attributs de la sélectiond'entité sont réellement utilisés côté client lors de l'exécutiondu code, et génère un "contexte d'optimisation" correspondant. Cecontexte est relié à la sélection d'entité et stocke les attributsutilisés. Il sera mis à jour dynamiquement si d'autres attributssont utilisés par la suite. Les méthodes et fonctions suivantesdéclenchent la phase d'apprentissage :</span></p><ul><li><span><a href="#datastores.html_create-entity-selection"><code>Créer une entityselection</code></a></span></li><li><span><a href="#datastores.html_fromcollection"><code>dataClass.fromCollection()</code></a></span></li><li><span><a href="#datastores.html_all"><code>dataClass.all()</code></a></span></li><li><span><a href="#datastores.html_get"><code>dataClass.get()</code></a></span></li><li><span><a href="#datastores.html_query"><code>dataClass.query()</code></a></span></li><li><span><a href="#datastores.html_query"><code>entitySelection.query()</code></a></span></li></ul></li><li><p><span>Les requêtes ultérieures envoyées au serveur sur la mêmesélection d'entité réutilisent automatiquement le contexted'optimisation et lisent uniquement les attributs nécessairesdepuis le serveur, ce qui accélère le traitement. Par exemple, dansune <a href="#datastores.html_entity-selection-based-list-box">listbox de type entity selection</a>, la phase d'apprentissage a lieupendant l'affichage de la première ligne. L'affichage des lignessuivantes est optimisé. Les fonctions suivantes associentautomatiquement le contexte d'optimisation de l'entity selectiond'origine à l'entity selection retournée :</span></p><ul><li><span><a href="#datastores.html_and"><code>entitySelection.and()</code></a></span></li><li><span><a href="#datastores.html_minus"><code>entitySelection.minus()</code></a></span></li><li><span><a href="#datastores.html_or"><code>entitySelection.or()</code></a></span></li><li><span><a href="#datastores.html_orderBy"><code>entitySelection.orderBy()</code></a></span></li><li><span><a href="#datastores.html_slice"><code>entitySelection.slice()</code></a></span></li><li><span><a href="#datastores.html_drop"><code>entitySelection.drop()</code></a></span></li></ul></li><li><p><span>Un contexte d'optimisation existant peut être passé entant que propriété à une autre sélection d'entité de la mêmedataclass, ce qui permet d'éviter la phase d'apprentissage etd'accélérer l'application (voir <a href="#datastores.html_reusing-the-context-property">Utilisation de lapropriété context</a> ci-dessous).</span></p></li><li><p><span>Vous pouvez créer des contextes d'optimisationmanuellement à l'aide de la fonction <a href="#datastores.html_setremotecontextinfo"><code>dataStore.setRemoteContextInfo()</code></a>(voir <a href="#datastores.html_preconfiguring-contexts">Préconfiguration descontextes</a>).</span></p></li></ul><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/cs-optimization-process.png" /></span></p><h4><span><a aria-hidden="true" class="anchor" id="datastores.html_exemple"></a><a aria-hidden="true" class="hash-link" href="#datastores.html_exemple"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple</span></h4><p><span>Considérons le code suivant :</span></p><pre><span><code class="hljs css language-4d"> <span class="hljs-variable">$sel</span>:=<span class="hljs-variable">$ds</span>.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"firstname = ab@"</span>)<span class="hljs-keyword"> For each</span>(<span class="hljs-variable">$e</span>;<span class="hljs-variable">$sel</span>)    <span class="hljs-variable">$s</span>:=<span class="hljs-variable">$e</span>.firstname+<span class="hljs-string">" "</span>+<span class="hljs-variable">$e</span>.lastname+<span class="hljs-string">" works for "</span>+<span class="hljs-variable">$e</span>.employer.name <span class="hljs-comment">// $e.employer renvoie à la table Company </span><span class="hljs-keyword"> End for each</span></code></span></pre><p>Grâce à l'optimisation, cette requête récupérera uniquement lesdonnées des attributs utilisés (prénom, nom, employeur,employeur.name) dans <em>$sel</em> à partir de la deuxièmeitération de la boucle.</p><h4><a aria-hidden="true" class="anchor" id="datastores.html_r%C3%A9utiliser-la-propri%C3%A9t%C3%A9-context"></a><a aria-hidden="true"class="hash-link" href="#datastores.html_r%25C3%25A9utiliser-la-propri%25C3%25A9t%25C3%25A9-context"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Réutiliser la propriété context</h4><p>Vous pouvez tirer un meilleur parti de l'optimisation enutilisant la propriété <strong>context</strong>. Cette propriétéréférence un contexte d'optimisation "appris" pour une sélectiond'entités. Elle peut être passée comme paramètre aux fonctions ORDAqui retournent de nouvelles sélections d'entités, afin que lessélections d'entités demandent directement au serveur les attributsutilisés, sans passer par la phase d'apprentissage.</p><blockquote><p>Vous pouvez également créer des contextes à l'aide de lafonction <a href="#datastores.html_setremotecontextinfo"><code>.setRemoteContextInfo()</code></a>.</p></blockquote><p>All ORDA functions that handle entity selections support the<strong>context</strong> property (for example <a href="#datastores.html_query"><code>dataClass.query()</code></a> or<a href="#datastores.html_all"><code>dataClass.all()</code></a>).The same optimization context property can be passed to unlimitednumber of entity selections on the same dataclass. Il est toutefoisimportant de garder à l'esprit qu'un contexte est automatiquementmis à jour lorsque de nouveaux attributs sont utilisés dansd'autres parties du code. Si le même contexte est réutilisé dansdifférents codes, il risque d'être surchargé et de perdre enefficacité.</p><blockquote><p>A similar mechanism is implemented for entities that are loaded,so that only used attributes are requested (see the <a href="#datastores.html_get"><code>dataClass.get()</code></a>function).</p></blockquote><p><strong>Exemple avec<code>dataClass.query()</code>:</strong></p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$sel1</span>; <span class="hljs-variable">$sel2</span>; <span class="hljs-variable">$sel3</span>; <span class="hljs-variable">$sel4</span>; <span class="hljs-variable">$querysettings</span>; <span class="hljs-variable">$querysettings2 </span>: Object<span class="hljs-keyword"> var</span> <span class="hljs-variable">$data </span>: Collection <span class="hljs-variable">$querysettings</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"context"</span>;<span class="hljs-string">"shortList"</span>) <span class="hljs-variable">$querysettings2</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"context"</span>;<span class="hljs-string">"longList"</span>) <span class="hljs-variable">$sel1</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastname = S@"</span>;<span class="hljs-variable">$querysettings</span>) <span class="hljs-variable">$data</span>:=<span class="hljs-function">extractData</span>(<span class="hljs-variable">$sel1</span>) <span class="hljs-comment">// In extractData method an optimization is triggered   </span> <span class="hljs-comment">// and associated to context "shortList"</span> <span class="hljs-variable">$sel2</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastname = Sm@"</span>;<span class="hljs-variable">$querysettings</span>) <span class="hljs-variable">$data</span>:=<span class="hljs-function">extractData</span>(<span class="hljs-variable">$sel2</span>) <span class="hljs-comment">// In extractData method the optimization associated   </span> <span class="hljs-comment">// to context "shortList" is applied</span> <span class="hljs-variable">$sel3</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastname = Smith"</span>;<span class="hljs-variable">$querysettings2</span>) <span class="hljs-variable">$data</span>:=<span class="hljs-function">extractDetailedData</span>(<span class="hljs-variable">$sel3</span>) <span class="hljs-comment">// In extractDetailedData method an optimization  </span> <span class="hljs-comment">// is triggered and associated to context "longList"</span> <span class="hljs-variable">$sel4</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"lastname = Brown"</span>;<span class="hljs-variable">$querysettings2</span>) <span class="hljs-variable">$data</span>:=<span class="hljs-function">extractDetailedData</span>(<span class="hljs-variable">$sel4</span>) <span class="hljs-comment">// In extractDetailedData method the optimization  </span> <span class="hljs-comment">// associated to context "longList" is applied</span></code></pre><h4><a aria-hidden="true" class="anchor" id="datastores.html_listbox-bas%C3%A9e-sur-une-s%C3%A9lection-dentit%C3%A9s"></a><a aria-hidden="true" class="hash-link" href="#datastores.html_listbox-bas%25C3%25A9e-sur-une-s%25C3%25A9lection-dentit%25C3%25A9s"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Listbox basée sur une sélection d'entités</h4><p>L'optimisation d'une sélection d'entités s'appliqueautomatiquement aux listbox basées sur une sélection d'entités dansles configurations client/serveur, au moment d'afficher et dedérouler le contenu d'une listbox : seuls les attributs affichésdans la listbox sont demandés depuis le serveur.</p><p>Un contexte spécifique nommé "mode page" est également proposélorsque l'entité courante de la sélection est chargée à l'aide del'expression <strong>élément courant</strong> de la listbox (voir<a href="#datastores.html_list-box-types">List box de typecollection ou entity selection</a>). Cette fonctionnalité vouspermet de ne pas surcharger le contexte initial de la listbox dansce cas précis, notamment si la "page" requiert des attributssupplémentaires. A noter que seule l'utilisation de l'expression<strong>Élément courant</strong> permettra de créer/utiliser lecontexte de la page (l'accès via<code>entitySelection[index]</code> modifiera le contexte de lasélection d'entité).</p><p>Subsequent requests to server sent by entity browsing functionswill also support this optimization. The following functionsautomatically associate the optimization context of the sourceentity to the returned entity:</p><ul><li><a href="#datastores.html_next"><code>entity.next()</code></a></li><li><a href="#datastores.html_first"><code>entity.first()</code></a></li><li><a href="#datastores.html_last"><code>entity.last()</code></a></li><li><a href="#datastores.html_previous"><code>entity.previous()</code></a></li></ul><p>Par exemple, le code suivant charge l'entité sélectionnée etpermet de naviguer dans la sélection d'entités. Les entités sontchargées dans un contexte séparé et le contexte initial de lalistbox demeure inchangé :</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$myEntity</span>:=Form.currentElement <span class="hljs-comment">//expression de l'élément courant </span>  <span class="hljs-comment">//... faire quelque chose</span> <span class="hljs-variable">$myEntity</span>:=<span class="hljs-variable">$myEntity</span>.<span class="hljs-function">next</span>() <span class="hljs-comment">//charge la prochaine entité à l'aide du même contexte</span></code></pre><h4><a aria-hidden="true" class="anchor" id="datastores.html_preconfiguring-contexts"></a><a aria-hidden="true"class="hash-link" href="#datastores.html_preconfiguring-contexts"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Preconfiguring contexts</h4><p>An optimization context should be defined for every feature oralgorithm of your application, in order to have the bestperformances. For example, a context can be used for queries oncustomers, another context for queries on products, etc.</p><p>If you want to deliver final applications with the highest levelof optimization, you can preconfigure your contexts and thus savelearning phases by following these steps:</p><ol><li>Design your algorithms.</li><li>Run your application and let the automatic learning mechanismfill the optimization contexts.</li><li>Call the <a href="#datastores.html_getremotecontextinfo"><code>dataStore.getRemoteContextInfo()</code></a>or <a href="#datastores.html_getallremotecontexts"><code>dataStore.getAllRemoteContexts()</code></a>function to collect contexts. You can use the <a href="#datastores.html_getremotecontextattributes"><code>entitySelection.getRemoteContextAttributes()</code></a>and <a href="#datastores.html_getremotecontextattributes"><code>entity.getRemoteContextAttributes()</code></a>functions to analyse how your algorithms use attributes.</li><li>In the final step, call the <a href="#datastores.html_setremotecontextinfo"><code>dataStore.setRemoteContextInfo()</code></a>function to build contexts at application startup and <a href="#datastores.html_reusing-the-context-property">use them</a> inyour algorithms.</li></ol><h3><a aria-hidden="true" class="anchor" id="datastores.html_orda-cache"></a><a aria-hidden="true" class="hash-link" href="#datastores.html_orda-cache"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>ORDA cache</h3><p>For optimization reasons, data requested from the server viaORDA is loaded in the ORDA remote cache (which is different fromthe 4D cache). The ORDA cache is organized by dataclass, andexpires after 30 seconds.</p><p>The data contained in the cache is considered as expired whenthe timeout is reached. Any access to expired data will send arequest to the server. Expired data remains in the cache untilspace is needed.</p><p>By default, the ORDA cache is transparently handled by 4D.However, you can control its contents using the following ORDAclass functions:</p><ul><li><a href="#datastores.html_setremotecachesettings">dataClass.setRemoteCacheSettings()</a></li><li><a href="#datastores.html_getremotecache">dataClass.getRemoteCache()</a></li><li><a href="#datastores.html_clearremotecache">dataClass.clearRemoteCache()</a></li></ul></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#entities.html"><span class="arrow-prev">←</span> <span>Travailleravec des données</span></a><a class="docs-next button" href="#glossary.html"><span>Glossaire</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#datastores.html_ouverture-des-sessions">Ouverture dessessions</a><ul class="toc-headings"><li><a href="#datastores.html_visionnage-des-sessions">Visionnagedes sessions</a></li><li><a href="#datastores.html_verrouillage-et-transactions">Verrouillage ettransactions</a></li><li><a href="#datastores.html_fermeture-des-sessions">Fermeture dessessions</a></li></ul></li><li><a href="#datastores.html_optimisation-clientserveur">Optimisationclient/serveur</a><ul class="toc-headings"><li><a href="#datastores.html_contexte">Contexte</a></li><li><a href="#datastores.html_orda-cache">ORDA cache</a></li></ul></li></ul></nav></div></div></body></html>