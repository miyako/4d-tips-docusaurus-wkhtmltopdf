<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="fr"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Fichier d'historique (.journal) · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="Une application exploitée de manière continue enregistre en permanence des modifications, des ajouts ou des suppressions d’enregistrements. Réaliser des sauvegardes régulières des données est important mais ne permet pas, en cas d’incident, de récupérer les données saisies depuis la dernière sauvegarde. Pour répondre à ce besoin, 4D dispose d’un outil particulier : le fichier d’historique. Ce fichier permet d’assurer la sécurité permanente des données."name="description" /><meta content="fr" name="docsearch:language" /><meta content="Fichier d'historique (.journal) · 4D Documentation"property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="Une application exploitée de manière continue enregistre en permanence des modifications, des ajouts ou des suppressions d’enregistrements. Réaliser des sauvegardes régulières des données est important mais ne permet pas, en cas d’incident, de récupérer les données saisies depuis la dernière sauvegarde. Pour répondre à ce besoin, 4D dispose d’un outil particulier : le fichier d’historique. Ce fichier permet d’assurer la sécurité permanente des données."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#log.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Fichier d'historique(.journal)<a aria-hidden="true" class="anchor" id="log.html"></a></h1></header><article><div><p><span>Une application exploitée de manière continue enregistreen permanence des modifications, des ajouts ou des suppressionsd’enregistrements. Réaliser des sauvegardes régulières des donnéesest important mais ne permet pas, en cas d’incident, de récupérerles données saisies depuis la dernière sauvegarde. Pour répondre àce besoin, 4D dispose d’un outil particulier : le fichierd’historique. Ce fichier permet d’assurer la sécurité permanentedes données.</span></p><p><span>En outre, 4D travaille en permanence avec un cache dedonnées situé en mémoire. Ce principe permet d’accélérer lefonctionnement des applications ; en effet, les accès mémoire sontbien plus rapides que les accès disque. Ce principe permetd’accélérer le fonctionnement des applications ; en effet, lesaccès mémoire sont bien plus rapides que les accès disque. Si unincident survient sur l'application avant que les données stockéesdans le cache aient pu être écrites sur le disque, vous devrezintégrer le fichier d’historique courant afin de récupérerentièrement l'application.</span></p><p><span>Enfin, 4D dispose d'une fonction d'analyse du contenu dufichier d'historique, permettant également de faire remonter enarrière les opérations exécutées sur les données de l'application.Ces fonctions sont accessibles via le CSM : reportez-vous auxsections <a href="#analysis.html">Page Analyse d'activités</a> et<a href="#rollback.html">Page Retour arrière</a>.</span></p><h2><span><a aria-hidden="true" class="anchor" id="log.html_fonctionnement-du-fichier-dhistorique"></a><a aria-hidden="true"class="hash-link" href="#log.html_fonctionnement-du-fichier-dhistorique"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Fonctionnement du fichier d'historique</span></h2><p><span>L’historique généré par 4D se présente sous la forme d’unfichier dans lequel toutes les opérations effectuées sur lesdonnées des tables journalisées de l'application viennents’inscrire séquentiellement. Par défaut, toutes les tables sontjournalisées, c'est-à-dire incluses dans l'historique, mais vouspouvez en désélectionner certaines via la propriété <strong>Incluredans le fichier d'historique</strong>.</span></p><p><span>Ainsi, chaque opération effectuée par un utilisateurprovoque deux actions simultanées : une première sur le fichier dedonnées (l’instruction est exécutée normalement) et une secondedans le fichier d’historique (la description de l’opération y estenregistrée). Le fichier d’historique se construit de manièreindépendante, sans gêner ni ralentir le travail de l’utilisateur.Une application ne peut travailler qu’avec un seul fichierd’historique à la fois. Le fichier d’historique enregistre lestypes d’opérations suivants :</span></p><ul><li><span>Ouvertures et fermetures du fichier dedonnées,</span></li><li><span>Ouvertures et fermetures de process(contextes),</span></li><li><span>Ajouts d’enregistrements et de BLOBs,</span></li><li><span>Modifications d’enregistrements,</span></li><li><span>Suppressions d’enregistrements,</span></li><li><span>Créations et fermetures de transactions.</span></li></ul><p><span>Pour plus d’informations sur ces actions, reportez-vous àla section <a href="#analysis.html">Page Analyse d'activités</a> duCSM.</span></p><p><span>Le fichier d’historique est géré par 4D. Il prend encompte indifféremment toutes les opérations affectant le fichier dedonnées, que ce soient des manipulations effectuées par unutilisateur, des méthodes 4D, le moteur SQL, des plug-ins, unnavigaeur Web ou une application mobile.</span></p><p><span>Ce schéma résume le principe général de fonctionnement dufichier d’historique :</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/Backup/backup05.png" /></span></p><p><span>Le fichier d’historique courant est automatiquementsauvegardé avec le fichier de données courant. Ce mécanisme procuredeux avantages principaux :</span></p><ul><li><span>Eviter la saturation du disque accueillant le fichierd’historique. En effet, sans sauvegarde, l’historique grossiraitindéfiniment au fur et à mesure de l’exploitation de la base etfinirait par saturer votre disque. A chaque sauvegarde du fichierde données, 4D ou 4D Server ferme le fichier d’historique courantet débute immédiatement un nouveau fichier vide, évitant ainsi lerisque de saturation. L’ancien fichier d’historique est alorsarchivé puis éventuellement détruit, conformément au mécanisme desjeux de sauvegarde.</span></li><li><span>Conserver les fichiers d’historique correspondant auxsauvegardes, afin de pouvoir analyser ou réparer a posteriori uneapplication. En effet, l’intégration du fichier d’historique nepeut se faire que dans l'application qui lui correspond. Il estdonc important, pour pouvoir intégrer correctement un fichierd’historique dans une sauvegarde, de disposer de sauvegardes etd’historiques archivés simultanément.</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="log.html_cr%C3%A9er-le-fichier-dhistorique"></a><a aria-hidden="true" class="hash-link" href="#log.html_cr%25C3%25A9er-le-fichier-dhistorique"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Créer le fichier d’historique</span></h2><p><span>Par défaut, toute application créée avec 4D utilise unfichier d’historique (option définie dans la Page<strong>Général</strong> des Préférences de 4D). Le fichierd’historique est nommé par défaut <em>data.journal</em> et estplacé dans le dossier Data.</span></p><p><span>Vous pouvez à tout moment savoir si votre applicationutilise un fichier d’historique : l’option <strong>Utiliser lefichier d’historique</strong> est cochée dans la Page<strong>Sauvegarde/Configuration</strong> des Propriétés. Si vousavez désélectionné cette option ou si vous utilisez une applicationsans fichier d’historique et souhaitez mettre en place unestratégie de sauvegarde avec fichier d’historique, il vousappartient d’en créer un.</span></p><p><span>Pour créer un fichier d’historique :</span></p><ol><li><p><span>Dans la Page <strong>Sauvegarde/Configuration</strong> desPropriétés de structure, cochez l’option <strong>Utiliser lefichier d’historique</strong>. Le programme affiche une boîte dedialogue standard de création de fichier. Par défaut, le fichierd’historique est baptisé <em>data.journal</em>.</span></p></li><li><p><span>Conservez le nom du fichier par défaut ou choisissez-en unautre et déterminez l’emplacement du fichier. Si vous disposez d’aumoins deux disques durs, il est recommandé de placer le fichierd'historique sur un autre disque que celui contenant le projetd'application. Si le disque dur de l'application est perdu, vouspouvez toujours rappeler votre fichier d'historique.</span></p></li><li><p><span>Cliquez sur le bouton <strong>Enregistrer</strong>. Ledisque et le nom du fichier d’historique ouvert s’affichent alorsdans la zone <strong>“Utiliser le fichier d’historique”</strong> dela boîte de dialogue. Vous pouvez cliquer dans cette zone afind’afficher un pop up menu contenant l’enchaînement des dossiers àpartir du disque.</span></p></li><li><p><span>Validez la boîte de dialogue des Propriétés.</span></p></li></ol><p><span>Pour que vous puissiez directement créer un fichierd’historique, les données doivent se trouver dans une dessituations suivantes :</span></p><ul><li><span>Le fichier de données est vierge,</span></li><li><span>Vous venez d’effectuer une sauvegarde et aucunemodification sur les données n’a encore été effectuée.</span></li></ul><p><span>Si vous cliquez sur <strong>OK</strong>, la sauvegardedémarre immédiatement puis l’historique est activé. Si vous cliquezsur <strong>OK</strong>, la sauvegarde démarre immédiatement puisl’historique est activé. Si vous cliquez sur<strong>Annuler</strong>, la requête est enregistrée mais lacréation du fichier d’historique est différée et sera crééeuniquement après la prochaine sauvegarde de l'application. Cetteprécaution est indispensable car il vous faudra, pour restituer uneapplication après un éventuel incident, disposer d’une copie del'application dans laquelle pourront s’intégrer les opérationsenregistrées dans le fichier d’historique.</span></p><p><span>Sans autre manipulation de votre part, toutes lesopérations effectuées sur les données s’inscriront dans ce fichier,et il sera utilisé également lors des ouvertures ultérieures del'application.</span></p><p><span>Vous devrez créer un autre fichier d’historique si vouscréez un nouveau fichier de données. Vous devrez désigner ou créerun autre fichier d’historique si vous ouvrez un autre fichier dedonnées non associé à un fichier d’historique (ou si le fichierd’historique est manquant).</span></p><h2><span><a aria-hidden="true" class="anchor" id="log.html_fermer-lhistorique"></a><a aria-hidden="true" class="hash-link" href="#log.html_fermer-lhistorique"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Fermer l’historique</span></h2><p><span>Si vous souhaitez interrompre l’enregistrement du fichierd’historique courant, désélectionnez l’option <strong>Utiliser lefichier d’historique</strong> dans la Page<strong>Sauvegarde/Configuration</strong> desPropriétés.</span></p><p><span>4D affiche alors un message d’alerte afin d’attirer votreattention sur le fait que cette action vous prive de la sécuritéapportée par le fichier d’historique :</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/Backup/backup06.png" /></span></p><p><span>Si vous cliquez sur le bouton <strong>Fermer</strong>, lefichier d’historique courant est immédiatement refermé (il n’estpas nécessaire que la boîte de dialogue des Propriétés soit ensuitevalidée).</span></p><p><span>Si vous souhaitez fermer votre fichier d’historiquecourant parce qu’il devient trop important, il est préférabled’effectuer une sauvegarde du fichier de données, ce qui entraînerala sauvegarde de l’historique.</span></p><blockquote><p><span><strong>4D Server</strong> : La commande <code>New logfile</code> permet de refermer automatiquement l’historique courantet d’en démarrer un nouveau. Si le fichier d'historique devientinaccessible au cours de la session de travail, l'erreur 1274 estgénérée et 4D Server ne permet plus aux utilisateurs d'écrire ou demodifier des données. Lorsque le fichier d'historique est denouveau accessible, il est nécessaire d'effectuer unesauvegarde.</span></p></blockquote></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#settings.html"><span class="arrow-prev">←</span> <span>Paramètresde sauvegarde</span></a><a class="docs-next button" href="#restore.html"><span>Restitution</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#log.html_fonctionnement-du-fichier-dhistorique">Fonctionnement dufichier d'historique</a></li><li><a href="#log.html_cr%25C3%25A9er-le-fichier-dhistorique">Créerle fichier d’historique</a></li><li><a href="#log.html_fermer-lhistorique">Fermerl’historique</a></li></ul></nav></div></div></body></html>