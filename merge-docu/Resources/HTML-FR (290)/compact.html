<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="fr"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Page compactage · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="Cette page permet d’accéder aux fonctions de compactage du fichier de données et de structure."name="description" /><meta content="fr" name="docsearch:language" /><meta content="Page compactage · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="Cette page permet d’accéder aux fonctions de compactage du fichier de données et de structure."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#compact.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Pagecompactage<a aria-hidden="true" class="anchor" id="compact.html"></a></h1></header><article><div><p><span>Cette page permet d’accéder aux fonctions de compactage dufichier de données et de structure.</span></p><h2><span><a aria-hidden="true" class="anchor" id="compact.html_pourquoi-compacter-"></a><a aria-hidden="true" class="hash-link" href="#compact.html_pourquoi-compacter-"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Pourquoi compacter ?</span></h2><p><span>Le compactage d'un fichier répond à deux types de besoins:</span></p><ul><li><p><span><strong>Réduction de taille et optimisation desfichiers</strong> : les fichiers peuvent comporter des emplacementsinutilisés (des “trous”). En effet, lorsque vous supprimez desenregistrements, des formulaires, etc., l’emplacement qu’ilsoccupaient précédemment dans le fichier devient vacant. 4Dréutilise ces emplacements vides lorsque c’est possible, mais lataille des données étant variable, les suppressions oumodifications successives génèrent inévitablement des espacesinutilisables pour le programme. Il en va de même lorsqu’une grandequantité de données vient d’être supprimée : les emplacements videsrestent inaffectés dans le fichier. Le rapport entre la taille dufichier de données et l’espace réellement utilisé pour les donnéesest le taux d’occupation des données. Un taux trop faible peutentraîner, outre un gaspillage de place, une dégradation desperformances de la base. La fonction de compactage permet deréorganiser et d’optimiser le stockage des données afin de fairedisparaître les “trous”. Les zones “Informations” résument lesdonnées relatives à la fragmentation des fichiers et suggèrent lesopérations à effectuer. Les onglets de la page <a href="#compact.html_data">Informations</a> du CSM indiquent lafragmentation courante des fichiers de la base.</span></p></li><li><p><span><strong>Réenregistrement intégral des données</strong> enappliquant le formatage courant défini dans le fichier destructure. Ce principe est utile lorsque les données d'une mêmetable ont été stockées dans différents formats, par exemple aprèsun changement dans la structure de la base.</span></p></li></ul><blockquote><p><span>Le compactage n’est disponible qu’en mode maintenance. Sivous tentez d’effectuer cette opération en mode standard, une boîtede dialogue d’alerte vous prévient que l'application va être ferméepuis relancée en mode maintenance. Il est possible de compacter unfichier de données non ouvert par l'application (cf. paragraphe<a href="#compact.html_compact-records-and-indexes">Compacter lesenregistrements et les index</a> ci-dessous).</span></p></blockquote><h2><span><a aria-hidden="true" class="anchor" id="compact.html_le-compactage-standard"></a><a aria-hidden="true"class="hash-link" href="#compact.html_le-compactage-standard"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Le compactage standard</span></h2><p><span>Pour démarrer directement le compactage du fichier dedonnées ou de structure, cliquez sur le bouton correspondant dansla fenêtre du CSM.</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/MSC/MSC_compact.png" /></span></p><blockquote><p><span>Le compactage entraînant la duplication du fichierd’origine, le bouton est désactivé si la place sur le disquecontenant le fichier est insuffisante.</span></p></blockquote><p><span>Cette opération défragmente le fichier principal ainsi queles éventuels fichiers d’index. 4D effectue une copie des fichiersd’origine et les place dans un dossier nommé <strong>Replaced Files(Compacting)</strong>, créé à côté du fichier d’origine. Si vouseffectuez plusieurs compactages, un nouveau dossier est créé àchaque fois. Il est nommé “Replaced Files (Compacting)_1”,“Replaced Files (Compacting)_2”, etc. Vous pouvez modifier ledossier dans lequel les fichiers d’origine sont sauvegardés via lemode avancé.</span></p><p><span>A l’issue de l’opération, les fichiers défragmentésremplacent automatiquement les fichiers d’origine. L'applicationest immédiatement opérationnelle sans aucune autremanipulation.</span></p><blockquote><p><span>Lorsque la base est chiffrée, le compactage comprend lechiffrement et le déchiffrement et requiert ainsi la clé dechiffrement des données courante. Si aucune clé de chiffrementvalide n'a encore été fournie, une boîte de dialogue s'affiche pourvous demander de saisir la phrase secrète ou la clé desdonnées.</span></p></blockquote><p><span><strong>Attention :</strong> Chaque compactage entraîne laduplication du fichier d’origine et donc l’augmentation de lataille du dossier de l’application. Il est important de tenircompte de ce mécanisme (notamment sous macOS où les applications 4Dapparaissent sous forme de packages) pour que l’application negrossisse pas de façon excessive. Une intervention manuelle àl’intérieur du package peut être utile afin de supprimer les copiesdes fichiers d’origine.</span></p><h2><span><a aria-hidden="true" class="anchor" id="compact.html_voir-le-compte-rendu"></a><a aria-hidden="true"class="hash-link" href="#compact.html_voir-le-compte-rendu"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Voir le compte rendu</span></h2><p><span>Une fois le compactage terminé, 4D génère un fichier decompte-rendu dans le dossier Logs du projet. Ce fichier listel’ensemble des opérations qui ont été menées. Il est créé au formatxml et est nommé<em>ApplicationName</em><em>_Compact_Log_yyyy-mm-ddhh-mm-ss.xml</em>" où :</span></p><ul><li><span><em>ApplicationName</em> est le nom du fichier destructure sans extension, par exemple "Factures",</span></li><li><span><em>aaaa-mm-jj hh-mm-ss</em> est l'horodatage du fichier,basé sur la date et l'heure système locales au moment du lancementde l'opération de vérification, par exemple "2019-02-1115-20-45".</span></li></ul><p><span>Lorsque vous cliquez sur le bouton <strong>Voir le compterendu</strong>, 4D affiche le fichier de compte-rendu le plusrécent dans le navigateur par défaut de l’ordinateur.</span></p><h2><span><a aria-hidden="true" class="anchor" id="compact.html_mode-avanc%C3%A9"></a><a aria-hidden="true" class="hash-link" href="#compact.html_mode-avanc%25C3%25A9"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Mode avancé</span></h2><p><span>La page Compactage comporte un bouton<strong>Avancé</strong>, permettant d’accéder à une page d’optionspour le compactage des fichiers de données et destructure.</span></p><h3><span><a aria-hidden="true" class="anchor" id="compact.html_compacter-les-enregistrements-et-les-index"></a><a aria-hidden="true"class="hash-link" href="#compact.html_compacter-les-enregistrements-et-les-index"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Compacter les enregistrements et les index</span></h3><p><span>La zone <strong>Compacter les enregistrements et lesindex</strong> affiche le chemin d’accès du fichier de donnéescourant ainsi qu’un bouton <strong>[...]</strong> permettant dedésigner un autre fichier de données. Lorsque vous cliquez sur cebouton, une boîte de dialogue standard d’ouverture de documentss’affiche, vous permettant de désigner le fichier de données àcompacter. Vous devez sélectionner un fichier de données compatibleavec le fichier de structure ouvert. Une fois la boîte de dialoguevalidée, le chemin d’accès du fichier à compacter est indiqué dansla fenêtre.</span></p><p><span>Le second bouton <strong>[...]</strong> permet de désignerun autre emplacement pour les sauvegardes des fichiers originauxeffectuées avant compactage. Cette option permet notamment decompacter des fichiers volumineux en utilisant différentsdisques.</span></p><h3><span><a aria-hidden="true" class="anchor" id="compact.html_forcer-la-mise-%C3%A0-jour-des-enregistrements"></a><a aria-hidden="true"class="hash-link" href="#compact.html_forcer-la-mise-%25C3%25A0-jour-des-enregistrements"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Forcer la mise à jour des enregistrements</span></h3><p><span>Lorsque cette option est cochée, 4D réécrit chaqueenregistrement de chaque table lors de l’opération de compactage,en fonction de sa description en structure. Lorsque l’option n’estpas cochée, 4D réorganise uniquement le stockage des données sur ledisque. Cette option est utile dans les cas suivants :</span></p><ul><li><p><span>Lorsque des modifications de types de champs ont étéapportées à la structure d’une application après que des donnéesont été saisies. Par exemple, vous pouvez avoir changé le type d’unchamp Entier long en Réel. 4D autorise même des modifications entredes types très différents (avec risques de pertes de données), parexemple un champ Réel peut être changé en Texte et inversement.Dans ce cas, 4D ne convertit pas rétroactivement les données déjàsaisies, elles ne sont converties que si les enregistrements sontchargés puis sauvegardés. L’option permet de forcer la conversionde toutes les données.</span></p></li><li><p><span>Lorsqu’une option de stockage externe des données de typeTexte, Image ou BLOB a été modifiée après que des données aient étésaisies. Ce cas peut notamment se produire après conversion d’unebase en version 4D antérieure à la v13. Comme pour le cas duretypage ci-dessus, 4D ne modifie pas rétroactivement les donnéesdéjà saisies. Pour cela, vous pouvez forcer la mise à jour desenregistrements afin d’appliquer le nouveau mode de stockage auxenregistrements déjà saisis.</span></p></li><li><p><span>Lorsque des champs ou des tables ont été supprimé(e)s.Dans ce cas, le compactage avec mise à jour des enregistrementspermet de récupérer la place de ces données supprimées et donc deréduire la taille du fichier.</span></p></li></ul><blockquote><p><span>La sélection de cette option entraîne la mise à jour detous les index.</span></p></blockquote><h3><span><a aria-hidden="true" class="anchor" id="compact.html_compacter-la-table-dadresses"></a><a aria-hidden="true" class="hash-link" href="#compact.html_compacter-la-table-dadresses"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Compacter la table d’adresses</span></h3><p><span>(option accessible uniquement lorsque la précédente estcochée)</span></p><p><span>Cette option provoque la reconstruction complète de latable d’adresses des enregistrements au moment du compactage. Cetteopération permet d’optimiser la taille de la table d’adresses. Elleest principalement utile dans les bases de données où de trèsnombreux enregistrements ont été créés puis supprimés. Dans lesautres cas, l’optimisation ne sera pas déterminante.</span></p><p><span>A noter que cette option ralentit le compactage de façonconséquente et qu’elle rend invalides les ensembles sauvegardés viala commande <code>SAVE SET</code>. Il est d’ailleurs fortementrecommandé dans ce cas de supprimer les ensembles sauvegardés carleur utilisation peut conduire à des sélections de donnéeserronées.</span></p><blockquote><ul><li><span>Le compactage tient compte des enregistrements des tablesplacées dans la corbeille. La présence d’un grand nombred’enregistrements dans la corbeille peut constituer un facteur deralentissement supplémentaire pour l’opération.</span></li><li><span>L'utilisation de cette option rend la table d'adresses,et donc la base de données, incompatibles avec le fichierd'historique courant (s'il en existe un). Il sera automatiquementsauvegardé et un nouveau fichier d'historique devra être créé auprochain lancement de l'application.</span></li><li><span>Vous pouvez déterminer si la table d'adresses a besoind'être compactée en comparant sa taille avec le nombre totald'enregistrements dans la Page <a href="#information.html">Informations</a> du CSM.</span></li></ul></blockquote></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#backup.html"><span class="arrow-prev">←</span> <span>PageSauvegarde</span></a><a class="docs-next button" href="#rollback.html"><span>Page Retour en arrière</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#compact.html_pourquoi-compacter-">Pourquoi compacter?</a></li><li><a href="#compact.html_le-compactage-standard">Le compactagestandard</a></li><li><a href="#compact.html_voir-le-compte-rendu">Voir le compterendu</a></li><li><a href="#compact.html_mode-avanc%25C3%25A9">Mode avancé</a><ul class="toc-headings"><li><a href="#compact.html_compacter-les-enregistrements-et-les-index">Compacterles enregistrements et les index</a></li><li><a href="#compact.html_forcer-la-mise-%25C3%25A0-jour-des-enregistrements">Forcerla mise à jour des enregistrements</a></li><li><a href="#compact.html_compacter-la-table-dadresses">Compacterla table d’adresses</a></li></ul></li></ul></nav></div></div></body></html>