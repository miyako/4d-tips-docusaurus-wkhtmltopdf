<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="fr"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Form Editor Macros · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="L'éditeur de formulaires 4D prend en charge les macros. Une macro est un ensemble d'instructions permettant de réaliser une action ou une séquence d'actions. Lorsqu'elle est appelée, la macro exécutera ses instructions et, automatiquement, les actions."name="description" /><meta content="fr" name="docsearch:language" /><meta content="Form Editor Macros · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="L'éditeur de formulaires 4D prend en charge les macros. Une macro est un ensemble d'instructions permettant de réaliser une action ou une séquence d'actions. Lorsqu'elle est appelée, la macro exécutera ses instructions et, automatiquement, les actions."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#macros.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Form EditorMacros<a aria-hidden="true" class="anchor" id="macros.html"></a></h1></header><article><div><p><span>L'éditeur de formulaires 4D prend en charge les macros.Une macro est un ensemble d'instructions permettant de réaliser uneaction ou une séquence d'actions. Lorsqu'elle est appelée, la macroexécutera ses instructions et, automatiquement, lesactions.</span></p><p><span>Par exemple, si vous avez un rapport récurrent avec unemise en forme spécifique (par exemple, certains textes doiventapparaître en rouge et certains textes en vert), vous pouvez créerune macro pour définir automatiquement la couleur. Vous pouvezcréer des macros pour l'éditeur de 4D Form qui peuvent :</span></p><ul><li><span>Créer et exécuter du code 4D</span></li><li><span>Afficher les boîtes de dialogue</span></li><li><span>Sélectionnez des objets de formulaire</span></li><li><span>Ajouter / supprimer / modifier des formulaires, desobjets de formulaire ainsi que leurs propriétés</span></li><li><span>Modifier les fichiers de projet (mettre à jour,supprimer)</span></li></ul><p><span>Le code des macros prend en charge les <a href="#classes.html">class functions (fonctions de classe)</a> et les<a href="#propertiesReference.html">propriétés d'objet deformulaire en JSON</a> pour vous permettre de définir n'importequelle fonctionnalité personnalisée dans l'éditeur deformulaire.</span></p><p><span>Des macros peuvent être définies pour le projet hôte oupour les composants du projet. Habituellement, vous créez une macroet l'installez dans les composants que vous utilisez pour ledéveloppement.</span></p><p><span>Lorsqu'elle est appelée, une macro remplace tous lescomportements précédemment spécifiés.</span></p><h2><span><a aria-hidden="true" class="anchor" id="macros.html_exemple-pratique"></a><a aria-hidden="true" class="hash-link" href="#macros.html_exemple-pratique"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple pratique</span></h2><p><span>Dans ce court exemple, vous verrez comment créer etappeler une macro qui ajoute un bouton d'alerte "Hello World!" dansle coin supérieur gauche de votre formulaire.</span></p><ol><li><span>Dans un fichier <code>formMacros.json</code> dans ledossier <code>Sources</code> de votre projet, entrez le codesuivant :</span></li></ol><pre><span><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {      <span class="hljs-string">"Add Hello World button"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AddButton"</span>     }   }}</code></span></pre><ol start="2"><li><p>Créez une classe 4D nommée <code>AddButton</code>.</p></li><li><p>Dans la classe <code>AddButton</code>, écrivez la fonctionsuivante :</p></li></ol><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$btnHello </span>: Object    <span class="hljs-comment">// Créer un bouton "Hello"</span>    <span class="hljs-variable">$btnHello</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"type"</span>; <span class="hljs-string">"button"</span>; \    <span class="hljs-string">"text"</span>; <span class="hljs-string">"Hello World!"</span>; \    <span class="hljs-string">"method"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"source"</span>; <span class="hljs-string">"ALERT(\"Hello World!\")"</span>); \    <span class="hljs-string">"events"</span>;<span class="hljs-function"> New collection</span>(<span class="hljs-string">"onClick"</span>); \    <span class="hljs-string">"width"</span>; <span class="hljs-number">120</span>; \    <span class="hljs-string">"height"</span>; <span class="hljs-number">20</span>; \    <span class="hljs-string">"top"</span>; <span class="hljs-number">0</span>; \    <span class="hljs-string">"left"</span>; <span class="hljs-number">0</span>)      <span class="hljs-comment">// Ajouter un bouton dans la page courante</span>    <span class="hljs-variable">$editor</span>.editor.currentPage.objects.btnHello:=<span class="hljs-variable">$btnHello  </span>    <span class="hljs-comment">// Sélectionner le nouveau bouton dans l'éditeur de formulaire</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">clear</span>() <span class="hljs-comment">//unselect elements</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">push</span>(<span class="hljs-string">"btnHello"</span>)        <span class="hljs-comment">// Notifier la modification à l'éditeur de formulaire 4D </span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentSelection"</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection;\          <span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><p>Vous pouvez alors appeler la macro : <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex1.png" /> <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex2.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_appeler-des-macros-dans-l%C3%A9diteur-de-formulaires"></a><a aria-hidden="true"class="hash-link" href="#macros.html_appeler-des-macros-dans-l%25C3%25A9diteur-de-formulaires"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Appeler des macros dans l'éditeur de formulaires</h2><p>Lorsque des macros sont définies dans votre projet 4D, vouspouvez appeler une macro à l'aide du menu contextuel de l'éditeurde formulaires :</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroSelect.png" /></p><p>Ce menu est crée selon le(s) <a href="#macros.html_location-of-macros">fichier(s) de définition demacro</a> <code>formMacros.json</code>. Macro items are sorted inalphabetical order.</p><p>Ce menu peut être appelé dans une zone vide ou une sélectiondans le formulaire. Les objets sélectionnés sont passés à<code>$editor.currentSelection</code> ou<code>$editor.target</code> dans la fonction <a href="#macros.html_oninvoke"><code>onInvoke</code></a> de la macro.</p><p>Une seule macro peut exécuter plusieurs opérations. Si elle estsélectionnée, la fonction <strong>Annuler</strong> de l'éditeur deformulaires peut être utilisée pour inverser les opérations demacro.</p><h2><a aria-hidden="true" class="anchor" id="macros.html_emplacement-du-fichier-de-macro"></a><a aria-hidden="true" class="hash-link" href="#macros.html_emplacement-du-fichier-de-macro"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Emplacement du fichier de macro</h2><p>Toutes les macros de l'éditeur de formulaire 4D sont définiesdans un seul fichier JSON par projet ou composant :<code>FormMacros.json</code>.</p><p>Ce fichier doit se trouver dans le dossier<strong>Projet</strong> &gt;<strong>Sources</strong> de l'hôte oudu composant :</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroStructure.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_d%C3%A9claration-de-macros"></a><a aria-hidden="true"class="hash-link" href="#macros.html_d%25C3%25A9claration-de-macros"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Déclaration de macros</h2><p>La structure du fichier <code>formMacros.json</code> est lasuivante :</p><pre><code class="hljs css language-js">{    <span class="hljs-string">"macros"</span>: {            &lt;macroName&gt;: {                <span class="hljs-string">"class"</span>: &lt;className&gt;,                &lt;customProperty&gt; : &lt;value&gt;        }    }}</code></pre><p>Voici la description du contenu du fichier JSON :</p><table><thead><tr><th>Attribut</th><th></th><th></th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>macros</td><td></td><td></td><td>object</td><td>liste des macros définis</td></tr><tr><td></td><td><code>&lt;macroName&gt;</code></td><td></td><td>object</td><td>définition de la macro</td></tr><tr><td></td><td></td><td>class</td><td>string</td><td>nom de classe de la macro</td></tr><tr><td></td><td></td><td><code>&lt;customProperty&gt;</code></td><td>any</td><td>(optionnel) valeur personnalisée à récupérer dans leconstructeur</td></tr></tbody></table><p>Les propriétés personnalisées, lorsqu'elles sont utilisées, sontpassées à la fonction <a href="#macros.html_class-constructor">constructeur</a> de la macro.</p><h3><a aria-hidden="true" class="anchor" id="macros.html_exemple"></a><a aria-hidden="true" class="hash-link"href="#macros.html_exemple"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple</h3><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Open Macros file"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"OpenMacro"</span>     },     <span class="hljs-string">"Align to Right on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"right"</span>     },     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><h2><a aria-hidden="true" class="anchor" id="macros.html_instancier-des-macros-dans-4d"></a><a aria-hidden="true" class="hash-link" href="#macros.html_instancier-des-macros-dans-4d"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Instancier des macros dans 4D</h2><p>Chaque macro que vous souhaitez instancier dans votre projet oucomposant doit être déclarée en tant que <a href="#classes.html">classe 4D</a>.</p><p>Le nom de la classe doit correspondre au nom défini à l'aide del'attribut <a href="#macros.html_creating-macros">class</a> dufichier <code>formMacros.json</code>.</p><p>Les macros sont instanciées au lancement de l'application. Parconséquent, si vous modifiez la structure de la classe de macro(ajouter une fonction, modifier un paramètre, etc.) ou le <a href="#macros.html_class-constructor">constructeur</a>, vous devrezredémarrer l'application pour appliquer les modifications.</p><h2><a aria-hidden="true" class="anchor" id="macros.html_fonctions-macro"></a><a aria-hidden="true" class="hash-link" href="#macros.html_fonctions-macro"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Fonctions macro</h2><p>Chaque classe de macro peut contenir un <code>Classconstructor</code> (constructeur de classe) et deux fonctions :<code>onInvoke()</code> et <code>onError()</code>.</p><h3><a aria-hidden="true" class="anchor" id="macros.html_class-constructor"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructor"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_class-constructormacro--object"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructormacro--object"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor($macro : Object)</h4><table><thead><tr><th>Paramètres</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$macro</td><td>Object</td><td>Objet de déclaration de macro (dans le fichier<code>formMacros.json</code>)</td></tr></tbody></table><p>Les macros sont instanciées à l'aide d'une fonction <a href="#macros.html_class-constructor">class constructor</a>, le caséchéant.</p><p>Le class constructor est appelé une fois lors de l'instanciationde classe, qui se produit au démarrage de l'application.</p><p>Les propriétés personnalisées ajoutées à la <a href="#macros.html_declaring-macros">déclaration macro</a> sontretournées dans le paramètre de la fonction class contructor.</p><h4><a aria-hidden="true" class="anchor" id="macros.html_exemple-1"></a><a aria-hidden="true" class="hash-link"href="#macros.html_exemple-1"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple</h4><p>Dans le fichier <code>formMacros.json</code> :</p><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><p>Vous pouvez écrire :</p><pre><code class="hljs css language-4d"><span class="hljs-comment">// Class "AlignOnTarget"</span><span class="hljs-keyword">Class constructor</span>(<span class="hljs-variable">$macro </span>: Object)    <span class="hljs-literal">This</span>.myParameter:=<span class="hljs-variable">$macro</span>.myParam <span class="hljs-comment">//gauche</span>    ...</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_oninvoke"></a><a aria-hidden="true" class="hash-link"href="#macros.html_oninvoke"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_oninvokeeditor--object---result--object"></a><a aria-hidden="true"class="hash-link" href="#macros.html_oninvokeeditor--object---result--object"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke($editor : Object) -&gt; $result : Object</h4><table><thead><tr><th>Paramètres</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$editor</td><td>Object</td><td>Objet Form Editor Macro Proxy contenant les propriétés duformulaire</td></tr><tr><td>$result</td><td>Object</td><td>Objet Form Editor Macro Proxy retournant des propriétésmodifiées par la macro (facultatif)</td></tr></tbody></table><p>La fonction <code>onInvoke</code> est automatiquement exécutée àchaque fois que la macro est appelée.</p><p>Lorsque la fonction est appelée, elle reçoit dans la propriété<code>$editor.editor</code> une copie de tous les éléments duformulaire avec leurs valeurs courantes. Vous pouvez ensuiteexécuter n'importe quelle opération sur ces propriétés.</p><p>Une fois les opérations terminées, si la macro entraîne lamodification, l'ajout ou la suppression d'objets, vous pouveztransmettre les propriétés modifiées résultantes dans<code>$result</code>. Le processeur de macros analysera lespropriétés retournées et appliquera les opérations nécessaires dansle formulaire. Évidemment, moins vous retournez de propriétés,moins le traitement prendra du temps.</p><p>Voici les propriétés retournées dans le paramètre<em>$editor</em> :</p><table><thead><tr><th>Propriété</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$editor.editor.form</td><td>Object</td><td>The entire form</td></tr><tr><td>$editor.editor.file</td><td>File</td><td>File object of the form file</td></tr><tr><td>$editor.editor.name</td><td>Chaine</td><td>Name of the form</td></tr><tr><td>$editor.editor.table</td><td>number</td><td>Table number of the form, 0 for project form</td></tr><tr><td>$editor.editor.currentPageNumber</td><td>number</td><td>The number of the current page</td></tr><tr><td>$editor.editor.currentPage</td><td>Object</td><td>The current page, containing all the form objects and the entryorder of the page</td></tr><tr><td>$editor.editor.currentSelection</td><td>Collection</td><td>Collection of names of selected objects</td></tr><tr><td>$editor.editor.formProperties</td><td>Object</td><td>Properties of the current form</td></tr><tr><td>$editor.editor.target</td><td>string</td><td>Name of the object under the mouse when clicked on a macro</td></tr></tbody></table><p>Here are the properties that you can pass in the<code>$result</code> object if you want the macro processor toexecute a modification. All properties are optional:</p><table><thead><tr><th>Propriété</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>currentPage</td><td>Object</td><td>currentPage including objects modified by the macro, ifany</td></tr><tr><td>currentSelection</td><td>Collection</td><td>currentSelection if modified by the macro</td></tr><tr><td>formProperties</td><td>Object</td><td>formProperties if modified by the macro</td></tr><tr><td>editor.groups</td><td>Object</td><td>group info, if groups are modified by the macro</td></tr><tr><td>editor.views</td><td>Object</td><td>view info, if views are modified by the macro</td></tr><tr><td>editor.activeView</td><td>Chaine</td><td>Active view name</td></tr></tbody></table><p>Par exemple, si des objets de la page courante et des groupesont été modifiés, vous pouvez écrire ce qui suit :</p><pre><code class="hljs css language-4d">    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage ; \             <span class="hljs-string">"editor"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"groups"</span>; <span class="hljs-variable">$editor</span>.editor.form.editor.groups))</code></pre><h4><a aria-hidden="true" class="anchor" id="macros.html_attribut-method"></a><a aria-hidden="true" class="hash-link" href="#macros.html_attribut-method"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>attribut <code>method</code></h4><p>When handling the <code>method</code> attribute of form objects,you can define the attribute value in two ways in macros:</p><ul><li><p>Using a <a href="#macros.html_method">string containing themethod file name/path</a>.</p></li><li><p>Using an object with the following structure:</p></li></ul><table><thead><tr><th>Propriété</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td>source</td><td>Chaine</td><td>Code de la méthode</td></tr></tbody></table><p>4D créera un fichier en utilisant le nom de l'objet dans ledossier "objectMethods" avec le contenu de l'attribut<code>source</code>. Cette fonctionnalité n'est disponible que pourle code macro.</p><h4><a aria-hidden="true" class="anchor" id="macros.html_propri%C3%A9t%C3%A9-4did-dans-currentpageobjects"></a><a aria-hidden="true"class="hash-link" href="#macros.html_propri%25C3%25A9t%25C3%25A9-4did-dans-currentpageobjects"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Propriété <code>$4dId</code> dans<code>currentPage.objects</code></h4><p>La propriété <code>$4dId</code> définit un ID unique pour chaqueobjet de la page courante. Cette clé est utilisée par le processeurde macros pour gérer les modifications dans<code>$result.currentPage</code> :</p><ul><li>si la clé <code>$4dId</code> est manquante à la fois dans leformulaire et dans un objet dans <code>$result</code>, l'objet estcréé.</li><li>si la clé <code>$4dId</code> existe dans le formulaire mais estmanquante dans <code>$result</code>, l'objet est supprimé.</li><li>si la clé <code>$4dId</code> existe à la fois dans leformulaire et dans un objet dans <code>$result</code> l'objet estmodifié.</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_exemple-2"></a><a aria-hidden="true" class="hash-link"href="#macros.html_exemple-2"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple</h4><p>You want to define a macro function that will apply the redcolor and italic font style to any selected object(s).</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$name </span>: Text<span class="hljs-keyword">    If</span> (<span class="hljs-variable">$editor</span>.editor.currentSelection.length&gt;<span class="hljs-number">0</span>)               <span class="hljs-comment">// Définir le contour en rouge et le style en italique pour chaque objet sélectionné</span><span class="hljs-keyword">        For each</span> (<span class="hljs-variable">$name</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection)            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].stroke:=<span class="hljs-string">"red"</span>            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].fontStyle:=<span class="hljs-string">"italic"</span><span class="hljs-keyword">        End for each</span><span class="hljs-keyword">     Else</span> <span class="hljs-function">        ALERT</span>(<span class="hljs-string">"Please select a form object."</span>)<span class="hljs-keyword">    End if</span>     <span class="hljs-comment">// Notifier la modification à 4D</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_onerror"></a><a aria-hidden="true" class="hash-link"href="#macros.html_onerror"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_onerroreditor--object-resultmacro--object--error--collection"></a><a aria-hidden="true" class="hash-link" href="#macros.html_onerroreditor--object-resultmacro--object--error--collection"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError($editor : Object; $resultMacro : Object ; $error: Collection)</h4><table><thead><tr><th>Paramètres</th><th></th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$editor</td><td></td><td>Object</td><td>Object send to <a href="#macros.html_oninvoke">onInvoke</a></td></tr><tr><td>$resultMacro</td><td></td><td>Object</td><td>Object returned by <a href="#macros.html_oninvoke">onInvoke</a></td></tr><tr><td>$error</td><td></td><td>Collection</td><td>Error stack</td></tr><tr><td></td><td>[].errCode</td><td>Nombre</td><td>Code d'erreur</td></tr><tr><td></td><td>[].message</td><td>Text</td><td>Description of the error</td></tr><tr><td></td><td>[].componentSignature</td><td>Text</td><td>Internal component signature</td></tr></tbody></table><p>La fonction <code>onError</code> est exécutée lorsque leprocesseur de macros rencontre une erreur.</p><p>Lors de l'exécution d'une macro, si 4D rencontre une erreur quiempêche l'annulation de la macro, il n'exécute pas la macro. C'estle cas par exemple si l'exécution d'une macro se traduirait par:</p><ul><li>supprimer ou modifier un script dont le fichier est en lectureseule.</li><li>créer deux objets avec le même ID interne.</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_exemple-3"></a><a aria-hidden="true" class="hash-link"href="#macros.html_exemple-3"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple</h4><p>In a macro class definition, you can write the following genericerror code:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onError</span>(<span class="hljs-variable">$editor </span>: Object; <span class="hljs-variable">$resultMacro </span>: Object; <span class="hljs-variable">$error </span>: Collection)<span class="hljs-keyword">    var</span> <span class="hljs-variable">$obj </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$txt </span>: Text    <span class="hljs-variable">$txt</span>:=<span class="hljs-string">""</span><span class="hljs-keyword">    For each</span> (<span class="hljs-variable">$obj</span>; <span class="hljs-variable">$error</span>)        <span class="hljs-variable">$txt</span>:=<span class="hljs-variable">$txt</span>+<span class="hljs-variable">$obj</span>.message+<span class="hljs-string">" \n"</span><span class="hljs-keyword">    End for each</span> <span class="hljs-function">    ALERT</span>(<span class="hljs-variable">$txt</span>)</code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#formEditor.html"><span class="arrow-prev">←</span> <span>Éditeurde formulaire</span></a><a class="docs-next button" href="#objectLibrary.html"><span>Bibliothèques d'objets</span><span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#macros.html_exemple-pratique">Exemplepratique</a></li><li><a href="#macros.html_appeler-des-macros-dans-l%25C3%25A9diteur-de-formulaires">Appeler des macros dans l'éditeur de formulaires</a></li><li><a href="#macros.html_emplacement-du-fichier-de-macro">Emplacement dufichier de macro</a></li><li><a href="#macros.html_d%25C3%25A9claration-de-macros">Déclaration demacros</a><ul class="toc-headings"><li><a href="#macros.html_exemple">Exemple</a></li></ul></li><li><a href="#macros.html_instancier-des-macros-dans-4d">Instancierdes macros dans 4D</a></li><li><a href="#macros.html_fonctions-macro">Fonctions macro</a><ul class="toc-headings"><li><a href="#macros.html_class-constructor">Classconstructor</a></li><li><a href="#macros.html_oninvoke">onInvoke()</a></li><li><a href="#macros.html_onerror">onError()</a></li></ul></li></ul></nav></div></div></body></html>