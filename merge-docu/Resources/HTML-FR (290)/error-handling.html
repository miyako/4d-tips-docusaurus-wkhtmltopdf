<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="fr"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Gestion des erreurs · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="Le traitement des erreurs consiste à anticiper les erreurs pouvant survenir dans votre application et à y répondre. 4D fournit un support complet pour la détection et la signalisation des erreurs lors de l'exécution, ainsi que pour l'analyse de leurs conditions."name="description" /><meta content="fr" name="docsearch:language" /><meta content="Gestion des erreurs · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="Le traitement des erreurs consiste à anticiper les erreurs pouvant survenir dans votre application et à y répondre. 4D fournit un support complet pour la détection et la signalisation des erreurs lors de l'exécution, ainsi que pour l'analyse de leurs conditions."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#error-handling.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Gestion deserreurs<a aria-hidden="true" class="anchor" id="error-handling.html"></a></h1></header><article><div><p><span>Le traitement des erreurs consiste à anticiper les erreurspouvant survenir dans votre application et à y répondre. 4D fournitun support complet pour la détection et la signalisation deserreurs lors de l'exécution, ainsi que pour l'analyse de leursconditions.</span></p><p><span>La gestion des erreurs répond à deux besoins principaux:</span></p><ul><li><span>rechercher et corriger les éventuels bugs et erreurs dansvotre code pendant la phase de développement,</span></li><li><span>détecter et récupérer des erreurs inattendues dans lesapplications déployées; vous pouvez notamment remplacer les boîtesde dialogue d'erreur système (disque plein, fichier manquant, etc.)par votre propre interface.</span></li></ul><blockquote><blockquote><p><span>Il est fortement recommandé d'installer une méthode degestion des erreurs sur 4D Server, pour tout le code exécuté sur leserveur. Cette méthode éviterait d'afficher des boîtes de dialogueinattendues sur le serveur et pourrait consigner les erreurs dansun fichier consacré en vue d'analyses ultérieures.</span></p></blockquote></blockquote><h2><span><a aria-hidden="true" class="anchor" id="error-handling.html_erreur-ou-statut"></a><a aria-hidden="true"class="hash-link" href="#error-handling.html_erreur-ou-statut"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Erreur ou statut</span></h2><p><span>De nombreuses fonctions de classe 4D, telles que<code>entity.save()</code> ou <code>transporter.send()</code>,retournent un objet <em>status</em>. Cet objet permet de stockerles erreurs "prévisibles" dans le contexte d'exécution, tellesqu'un mot de passe invalide, une entité verrouillée, etc., qui nestoppe pas l'exécution du programme. Cette catégorie d'erreurs peutêtre gérée par du code habituel.</span></p><p><span>D'autres erreurs "imprévisibles" peuvent inclure uneerreur en écriture sur le disque, une panne de réseau ou touteinterruption inattendue. Cette catégorie d'erreurs génère desexceptions et doit être traitée par une méthode de gestion deserreurs.</span></p><h2><span><a aria-hidden="true" class="anchor" id="error-handling.html_installer-une-m%C3%A9thode-de-gestion-des-erreurs"></a><a aria-hidden="true" class="hash-link" href="#error-handling.html_installer-une-m%25C3%25A9thode-de-gestion-des-erreurs"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Installer une méthode de gestion des erreurs</span></h2><p><span>Dans 4D, toutes les erreurs peuvent être capturées ettraitées dans une méthode projet spécifique, la méthode de<strong>gestion des erreurs</strong> (ou méthode de <strong>captured'erreurs</strong>).</span></p><p><span>Cette méthode projet est installée pour le process encours et sera automatiquement appelée pour toute erreur survenantdans le process, en mode interprété ou compilé. Pour<em>installer</em> cette méthode projet, il vous suffit d’appelerla commande <code>APPELER SUR ERREUR</code> avec le nom de laméthode projet en paramètre. Par exemple :</span></p><pre><span><code class="hljs css language-4d"><span class="hljs-function">APPELER SUR ERREUR</span>(<span class="hljs-string">"IO_ERRORS"</span>) <span class="hljs-comment">//Installe la méthode de gestion des erreurs</span></code></span></pre><p>Pour ne plus détecter d'erreurs et redonner le contrôle à 4D,appelez la méthode <code>ON ERR CALL</code> à l'aide d'une chaînevide :</p><pre><code class="hljs css language-4d"><span class="hljs-function">ON ERR CALL</span>(<span class="hljs-string">""</span>) <span class="hljs-comment">//redonne le contrôle à 4D</span></code></pre><p>La commande <code>Method called on error</code> vous permet deconnaître le nom de la méthode installée par <code>ON ERRCALL</code> pour le process courant. Cela est particulièrementutile dans le contexte du code générique car il vous permet demodifier temporairement puis de restaurer la méthode de captured'erreur :</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$methCurrent</span>:=Method called on error<span class="hljs-function"> ON ERR CALL</span>(<span class="hljs-string">"NewMethod"</span>)  <span class="hljs-comment">//Si le document ne peut pas être ouvert, une erreur est générée</span> <span class="hljs-variable">$ref</span>:=<span class="hljs-function">Open document</span>(<span class="hljs-string">"MyDocument"</span>)  <span class="hljs-comment">//Rétablissement de la méthode précédente</span><span class="hljs-function"> ON ERR CALL</span>(<span class="hljs-variable">$methCurrent</span>)</code></pre><h3><a aria-hidden="true" class="anchor" id="error-handling.html_port%C3%A9e-et-composants"></a><a aria-hidden="true" class="hash-link" href="#error-handling.html_port%25C3%25A9e-et-composants"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Portée et composants</h3><p>Vous pouvez définir une seule méthode d'erreur pour l'ensemblede l'application ou différentes méthodes par module d'application.Cependant, une seule méthode peut être installée par process.</p><p>Une méthode de gestion des erreurs installée par la commande<code>APPELER SUR ERREUR</code> s'applique uniquement àl'application en cours d'exécution. En cas d'erreur générée par un<strong>composant</strong>, la méthode <code>APPELER SURERREUR</code> de l'application hôte n'est pas appelée, etinversement.</p><h3><a aria-hidden="true" class="anchor" id="error-handling.html_g%C3%A9rer-les-erreurs-dans-une-m%C3%A9thode"></a><a aria-hidden="true"class="hash-link" href="#error-handling.html_g%25C3%25A9rer-les-erreurs-dans-une-m%25C3%25A9thode"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Gérer les erreurs dans une méthode</h3><p>Dans la méthode d'erreur personnalisée, vous pouvez accéder àplusieurs informations qui vous aideront à identifier l'erreur:</p><ul><li><p>Variables système (*) :</p><ul><li><code>Error</code> (entier long): Code d'erreur</li><li><code>Error method</code> (texte) : nom de la méthode ayantengendré l'erreur</li><li><code>Error line</code> (entier long) : Numéro de ligne de laméthode ayant généré l'erreur</li><li><code>Error formula</code> (texte) : formule du code 4D (textebrut) à l'origine de l'erreur.</li></ul></li></ul><p>(<em>) 4D conserve automatiquement le nombre de variablesappelées <strong>variables système</strong>, qui répondent àdifférents besoins. Consultez le manuel Language de 4D</em>.</p><ul><li>La commande <code>GET LAST ERROR STACK</code> qui retourne lesinformations sur la pile d'erreur courant de l'application 4D.</li><li>la commande <code>Get call chain</code> qui retourne unecollection d'objets décrivant chaque étape de la chaîne d'appel dela méthode dans le process courant.</li></ul><h4><a aria-hidden="true" class="anchor" id="error-handling.html_exemple"></a><a aria-hidden="true" class="hash-link" href="#error-handling.html_exemple"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Exemple</h4><p>Voici un système de gestion des erreurs simple :</p><pre><code class="hljs css language-4d"><span class="hljs-comment">//installer la méthode de gestion d'erreur</span><span class="hljs-function">ON ERR CALL</span>(<span class="hljs-string">"errorMethod"</span>) <span class="hljs-comment">//... exécuter le code</span><span class="hljs-function"> ON ERR CALL</span>(<span class="hljs-string">""</span>) <span class="hljs-comment">//redonner le contrôle à 4D</span></code></pre><pre><code class="hljs css language-4d"><span class="hljs-comment">// méthode projet errorMethod</span><span class="hljs-keyword"> If</span>(Error#<span class="hljs-number">1006</span>) <span class="hljs-comment">//ceci n'est pas une interruption générée par l'utilisateur</span><span class="hljs-function">    ALERT</span>(<span class="hljs-string">"L'erreur "</span>+<span class="hljs-function">String</span>(Error)+<span class="hljs-string">" s'est produite"</span>. Le code en question est : \<span class="hljs-string">""</span>+Error formula+<span class="hljs-string">"\""</span>)<span class="hljs-keyword"> End if</span></code></pre><h3><a aria-hidden="true" class="anchor" id="error-handling.html_utiliser-une-m%C3%A9thode-de-gestion-des-erreurs-vide"></a><a aria-hidden="true" class="hash-link" href="#error-handling.html_utiliser-une-m%25C3%25A9thode-de-gestion-des-erreurs-vide"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Utiliser une méthode de gestion des erreurs vide</h3><p>Si vous souhaitez cacher la boite de dialogue d'erreur standard,vous pouvez installer une méthode de gestion d'erreurs vide. Lavariable système <code>Error</code> peut être testée dans n'importequelle méthode, c'est-à-dire en dehors de la méthode de gestiond'erreurs :</p><pre><code class="hljs css language-4d"><span class="hljs-function">ON ERR CALL</span>(<span class="hljs-string">"emptyMethod"</span>) <span class="hljs-comment">//emptyMethod existe mais elle est vide</span><span class="hljs-variable">$doc</span>:=<span class="hljs-function">Open document</span>( <span class="hljs-string">"myFile.txt"</span>)<span class="hljs-keyword">If</span> (Error=<span class="hljs-number">-43</span>)<span class="hljs-function">    ALERT</span>(<span class="hljs-string">"File not found."</span>)<span class="hljs-keyword">End if</span>ON ERR CALL.(<span class="hljs-string">""</span>)<span class="hljs-keyword">End if</span>ON ERR CALL.(<span class="hljs-string">""</span>)</code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#looping.html"><span class="arrow-prev">←</span> <span>Structuresrépétitives (ou "boucles")</span></a><a class="docs-next button"href="#interpreted-compiled.html"><span>Modes interprété etcompilé</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#error-handling.html_erreur-ou-statut">Erreur oustatut</a></li><li><a href="#error-handling.html_installer-une-m%25C3%25A9thode-de-gestion-des-erreurs">Installer une méthode de gestion des erreurs</a><ul class="toc-headings"><li><a href="#error-handling.html_port%25C3%25A9e-et-composants">Portée etcomposants</a></li><li><a href="#error-handling.html_g%25C3%25A9rer-les-erreurs-dans-une-m%25C3%25A9thode">Gérer les erreurs dans une méthode</a></li><li><a href="#error-handling.html_utiliser-une-m%25C3%25A9thode-de-gestion-des-erreurs-vide">Utiliser une méthode de gestion des erreurs vide</a></li></ul></li></ul></nav></div></div></body></html>