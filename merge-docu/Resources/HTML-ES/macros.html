<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="es"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Macros del editor de formularios · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="El editor de formularios 4D soporta macros. Una macro es un conjunto de instrucciones que permiten realizar una acción o una secuencia de acciones. Cuando se llama, la macro ejecutará sus instrucciones y realiza automáticamente la(s) acción(es)."name="description" /><meta content="es" name="docsearch:language" /><meta content="Macros del editor de formularios · 4D Documentation"property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="El editor de formularios 4D soporta macros. Una macro es un conjunto de instrucciones que permiten realizar una acción o una secuencia de acciones. Cuando se llama, la macro ejecutará sus instrucciones y realiza automáticamente la(s) acción(es)."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#macros.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Macros del editor deformularios<a aria-hidden="true" class="anchor" id="macros.html"></a></h1></header><article><div><p><span>El editor de formularios 4D soporta macros. Una macro esun conjunto de instrucciones que permiten realizar una acción o unasecuencia de acciones. Cuando se llama, la macro ejecutará susinstrucciones y realiza automáticamente la(s)acción(es).</span></p><p><span>Por ejemplo, si tiene un informe recurrente con un formatoespecífico (por ejemplo, cierto texto debe aparecer en rojo ycierto texto debe aparecer en verde), puede crear una macro paradefinir automáticamente el color. Puede crear macros para el editorde formularios 4D que pueden:</span></p><ul><li><span>Crear y ejecutar código 4D</span></li><li><span>Mostrar las cajas de diálogo</span></li><li><span>Seleccione los objetos de formulario</span></li><li><span>Añadir / eliminar / modificar los formularios, losobjetos de formulario así como sus propiedades</span></li><li><span>Modificar los archivos del proyecto (actualizar,eliminar)</span></li></ul><p><span>El código de las macros soporta <a href="#classes.html">funciones de clase</a> y las <a href="#propertiesReference.html">propiedades de objeto de formulario enJSON</a> para permitir definir toda funcionalidad personalizada enel editor de formularios.</span></p><p><span>Las macros pueden definirse para el proyecto local o paracomponentes dentro del proyecto. Por lo general, se crea una macroy se instala dentro de los componentes que se utilizan para eldesarrollo.</span></p><p><span>Cuando se llama, una macro anula todo comportamientoespecificado previamente.</span></p><h2><span><a aria-hidden="true" class="anchor" id="macros.html_ejemplo-pr%C3%A1ctico"></a><a aria-hidden="true"class="hash-link" href="#macros.html_ejemplo-pr%25C3%25A1ctico"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ejemplo práctico</span></h2><p><span>En este breve ejemplo, verá cómo crear y llamar a unamacro que añade un botón de alerta "Hello World" en la esquinasuperior izquierda de su formulario.</span></p><ol><li><span>En un archivo <code>formMacros.json</code> dentro de lacarpeta <code>Sources</code> de su proyecto, escriba:</span></li></ol><pre><span><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {      <span class="hljs-string">"Add Hello World button"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AddButton"</span>     }   }}</code></span></pre><ol start="2"><li><p>Cree una clase 4D llamada <code>AddButton</code>.</p></li><li><p>En la clase <code>AddButton</code>, escriba la siguientefunción:</p></li></ol><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$btnHello </span>: Object    <span class="hljs-comment">// Crea un botón "Hello"</span>      <span class="hljs-variable">$btnHello</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"type"</span>; <span class="hljs-string">"button"</span>; \    <span class="hljs-string">"text"</span>; <span class="hljs-string">"Hello World!"</span>; \    <span class="hljs-string">"method"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"source"</span>; <span class="hljs-string">"ALERT(\"Hello World!\")"</span>); \    <span class="hljs-string">"events"</span>;<span class="hljs-function"> New collection</span>(<span class="hljs-string">"onClick"</span>); \    <span class="hljs-string">"width"</span>; <span class="hljs-number">120</span>; \    <span class="hljs-string">"height"</span>; <span class="hljs-number">20</span>; \    <span class="hljs-string">"top"</span>; <span class="hljs-number">0</span>; \    <span class="hljs-string">"left"</span>; <span class="hljs-number">0</span>)      <span class="hljs-comment">// Añadir un botón en la página actual</span>    <span class="hljs-variable">$editor</span>.editor.currentPage.objects.btnHello:=<span class="hljs-variable">$btnHello  </span>    <span class="hljs-comment">// Seleccionar el nuevo botón en el editor de formularios</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">clear</span>() <span class="hljs-comment">//deseleccionar elementos</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">push</span>(<span class="hljs-string">"btnHello"</span>)        <span class="hljs-comment">//Notificar la modificación al editor de formularios 4D</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentSelection"</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection;\N          <span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><p>A continuación, puede llamar a la macro: <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex1.png" /> <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex2.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_llamar-a-las-macros-en-el-editor-de-formularios"></a><a aria-hidden="true"class="hash-link" href="#macros.html_llamar-a-las-macros-en-el-editor-de-formularios"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Llamar a las macros en el editor de formularios</h2><p>Cuando las macros están definidas en su proyecto 4D, puedellamar una macro utilizando el menú contextual del editor deformularios:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroSelect.png" /></p><p>Este menú se crea sobre el <a href="#macros.html_location-of-macros">archivo de definición demacros</a> <code>formMacros.json</code>. Los elementos de la macrose clasifican en orden alfabético.</p><p>Este menú puede ser llamado en un área vacía o en una selecciónen el formulario. El objeto seleccionado se pasa a<code>$editor.currentSelection</code> o <code>$editor.target</code>en la función <a href="#macros.html_oninvoke"><code>onInvoke</code></a> de la macro.</p><p>Una sola macro puede ejecutar varias operaciones. Si seselecciona, la función <strong>Deshacer</strong> del editor deformularios puede utilizarse para revertir las operaciones de lasmacros de forma global.</p><h2><a aria-hidden="true" class="anchor" id="macros.html_ubicaci%C3%B3n-del-archivo-de-macro"></a><a aria-hidden="true"class="hash-link" href="#macros.html_ubicaci%25C3%25B3n-del-archivo-de-macro"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ubicación del archivo de macro</h2><p>Todas las macros del editor de formularios 4D se definen en unúnico archivo JSON por proyecto o componente:<code>FormMacros.json</code>.</p><p>Este archivo debe estar ubicado en la carpeta<strong>Project</strong> &gt; <strong>Sources</strong> local o delcomponente:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroStructure.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_declaraci%C3%B3n-de-macros"></a><a aria-hidden="true"class="hash-link" href="#macros.html_declaraci%25C3%25B3n-de-macros"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Declaración de macros</h2><p>La estructura del archivo <code>formMacros.json</code> es lasiguiente:</p><pre><code class="hljs css language-js">{    <span class="hljs-string">"macros"</span>: {            &lt;macroName&gt;: {                <span class="hljs-string">"class"</span>: &lt;className&gt;,                &lt;customProperty&gt; : &lt;value&gt;        }    }}</code></pre><p>Esta es la descripción del contenido del archivo JSON:</p><table><thead><tr><th>Atributo</th><th></th><th></th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td>macros</td><td></td><td></td><td>objeto</td><td>lista de macros definidas</td></tr><tr><td></td><td><code>&lt;macroName&gt;</code></td><td></td><td>objeto</td><td>definición de la macro</td></tr><tr><td></td><td></td><td>class</td><td>cadena</td><td>nombre de clase de la macro</td></tr><tr><td></td><td></td><td><code>&lt;customProperty&gt;</code></td><td>any</td><td>(opcional) valor personalizado a recuperar en elconstructor</td></tr></tbody></table><p>Las propiedades personalizadas, cuando se utilizan, se pasan ala función <a href="#macros.html_class-constructor">constructor</a>de la macro.</p><h3><a aria-hidden="true" class="anchor" id="macros.html_ejemplo"></a><a aria-hidden="true" class="hash-link"href="#macros.html_ejemplo"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ejemplo</h3><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Open Macros file"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"OpenMacro"</span>     },     <span class="hljs-string">"Align to Right on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"right"</span>     },     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><h2><a aria-hidden="true" class="anchor" id="macros.html_instanciar-las-macros-en-4d"></a><a aria-hidden="true"class="hash-link" href="#macros.html_instanciar-las-macros-en-4d"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Instanciar las macros en 4D</h2><p>Cada macro que quiera instanciar en su proyecto o componentedebe ser declarada como una <a href="#classes.html">clase4D</a>.</p><p>El nombre de la clase debe coincidir con el nombre definidomediante el atributo <a href="#macros.html_creating-macros">class</a> del archivo<code>formMacros.json</code>.</p><p>Las macros se instancian al iniciar la aplicación. Por lo tanto,si se modifica la estructura de la clase de macro (añadir unafunción, modificar un parámetro... o el <a href="#macros.html_class-constructor">constructor</a> , tendrá quereiniciar la aplicación para aplicar los cambios.</p><h2><a aria-hidden="true" class="anchor" id="macros.html_funciones-macro"></a><a aria-hidden="true" class="hash-link" href="#macros.html_funciones-macro"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Funciones macro</h2><p>Cada clase de macro puede contener un <code>Classconstructor</code> y dos funciones: <code>onInvoke()</code> y<code>onError()</code>.</p><h3><a aria-hidden="true" class="anchor" id="macros.html_class-constructor"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructor"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_class-constructormacro--object"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructormacro--object"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor($macro : Object)</h4><table><thead><tr><th>Parámetros</th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td>$macro</td><td>Objeto</td><td>Objeto de declaración de macros (en el archivo<code>formMacros.json</code>)</td></tr></tbody></table><p>Las macros se instancian utilizando una función <a href="#macros.html_class-constructor">class constructor</a>, siexiste.</p><p>El class constructor se llama una vez durante la instanciaciónde clase, que se produce al inicio de la aplicación.</p><p>Las propiedades personalizadas añadidas a la <a href="#macros.html_declaring-macros">declaración macro</a> se devuelvenen el parámetro de la función class contructor.</p><h4><a aria-hidden="true" class="anchor" id="macros.html_ejemplo-1"></a><a aria-hidden="true" class="hash-link"href="#macros.html_ejemplo-1"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ejemplo</h4><p>En el archivo <code>formMacros.json</code>:</p><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><p>Puede escribir:</p><pre><code class="hljs css language-4d"><span class="hljs-comment">// Class "AlignOnTarget"</span><span class="hljs-keyword">Class constructor</span>(<span class="hljs-variable">$macro </span>: Object)    <span class="hljs-literal">This</span>.myParameter:=<span class="hljs-variable">$macro</span>.myParam <span class="hljs-comment">//left</span>    ...</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_oninvoke"></a><a aria-hidden="true" class="hash-link"href="#macros.html_oninvoke"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_oninvokeeditor--object---result--object"></a><a aria-hidden="true"class="hash-link" href="#macros.html_oninvokeeditor--object---result--object"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke($editor : Object) -&gt; $result : Object</h4><table><thead><tr><th>Parámetros</th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td>$editor</td><td>Objeto</td><td>Objeto Form Editor Macro Proxy que contiene las propiedades delformulario</td></tr><tr><td>$result</td><td>Objeto</td><td>Objeto Form Editor Macro Proxy que devuelve las propiedadesmodificadas por la macro (opcional)</td></tr></tbody></table><p>La función <code>onInvoke</code> se ejecuta automáticamente cadavez que se llama a la macro.</p><p>Cuando la función es llamada, recibe en la propiedad<code>$editor.editor</code> una copia de todos los elementos delformulario con sus valores actuales. Luego puede ejecutar cualquieroperación en estas propiedades.</p><p>Una vez completadas las operaciones, si la macro resulta en lamodificación, adición o eliminación de objetos, puede pasar laspropiedades editadas resultantes en <code>$result</code>. Elprocesador de macros analizará las propiedades devueltas y aplicarálas operaciones necesarias en el formulario. Obviamente, cuantomenos propiedades devuelva, menos tiempo requerirá elprocesamiento.</p><p>Estas son las propiedades devueltas en el parámetro<em>$editor</em>:</p><table><thead><tr><th>Propiedad</th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td>$editor.editor.form</td><td>Objeto</td><td>Formulario completo</td></tr><tr><td>$editor.editor.file</td><td>File</td><td>File object of the form file</td></tr><tr><td>$editor.editor.name</td><td>Cadena</td><td>Nombre del formulario</td></tr><tr><td>$editor.editor.table</td><td>number</td><td>Número de tabla del formulario, 0 para el formularioproyecto</td></tr><tr><td>$editor.editor.currentPageNumber</td><td>number</td><td>The number of the current page</td></tr><tr><td>$editor.editor.currentPage</td><td>Objeto</td><td>The current page, containing all the form objects and the entryorder of the page</td></tr><tr><td>$editor.editor.currentSelection</td><td>Collection</td><td>Colección de nombres de objetos seleccionados</td></tr><tr><td>$editor.editor.formProperties</td><td>Objeto</td><td>Properties of the current form</td></tr><tr><td>$editor.editor.target</td><td>cadena</td><td>Name of the object under the mouse when clicked on a macro</td></tr></tbody></table><p>Here are the properties that you can pass in the<code>$result</code> object if you want the macro processor toexecute a modification. Todas las propiedades son opcionales:</p><table><thead><tr><th>Propiedad</th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td>currentPage</td><td>Objeto</td><td>currentPage including objects modified by the macro, ifany</td></tr><tr><td>currentSelection</td><td>Collection</td><td>currentSelection si es modificada por la macro</td></tr><tr><td>formProperties</td><td>Objeto</td><td>formProperties si es modificado por la macro</td></tr><tr><td>editor.groups</td><td>Objeto</td><td>información de grupo, si los grupos son modificados por lamacro</td></tr><tr><td>editor.views</td><td>Objeto</td><td>ver información, si las vistas son modificadas por lamacro</td></tr><tr><td>editor.activeView</td><td>Cadena</td><td>Nombres de vistas activos</td></tr></tbody></table><p>For example, if objects of the current page and groups have beenmodified, you can write:</p><pre><code class="hljs css language-4d">    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage ; \             <span class="hljs-string">"editor"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"groups"</span>; <span class="hljs-variable">$editor</span>.editor.form.editor.groups))</code></pre><h4><a aria-hidden="true" class="anchor" id="macros.html_atributo-method"></a><a aria-hidden="true" class="hash-link" href="#macros.html_atributo-method"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>atributo <code>method</code></h4><p>When handling the <code>method</code> attribute of form objects,you can define the attribute value in two ways in macros:</p><ul><li><p>Using a <a href="#macros.html_method">string containing themethod file name/path</a>.</p></li><li><p>Utilizando un objeto con la siguiente estructura:</p></li></ul><table><thead><tr><th>Propiedad</th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td>source</td><td>Cadena</td><td>Código del método</td></tr></tbody></table><p>4D will create a file using the object name in the"objectMethods" folder with the content of <code>source</code>attribute. Esta función solo está disponible para el códigomacro.</p><h4><a aria-hidden="true" class="anchor" id="macros.html_propiedad-4did-en-currentpageobjects"></a><a aria-hidden="true"class="hash-link" href="#macros.html_propiedad-4did-en-currentpageobjects"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Propiedad <code>$4dId</code> en<code>currentPage.objects</code></h4><p>La propiedad <code>$4dId</code> define un ID único para cadaobjeto de la página actual. Esta clave es utilizada por elprocesador de macros para controlar los cambios en<code>$result.currentPage</code>:</p><ul><li>si la llave <code>$4dId</code> falta tanto en el formulario yen un objeto en <code>$result</code>, el objeto se crea.</li><li>si la llave <code>$4dId</code> existe en el formulario perofalta en <code>$result</code>, el objeto se elimina.</li><li>si la llave <code>$4dId</code> existe tanto en el formulario yen un objeto en <code>$result</code>, el objeto se modifica.</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_ejemplo-2"></a><a aria-hidden="true" class="hash-link"href="#macros.html_ejemplo-2"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ejemplo</h4><p>Quiere definir una función macro que aplique el color rojo y elestilo de letra itálica a cualquier objeto seleccionado.</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$name </span>: Text<span class="hljs-keyword">    If</span> (<span class="hljs-variable">$editor</span>.editor.currentSelection.length&gt;<span class="hljs-number">0</span>)               <span class="hljs-comment">// Define el contorno en rojo y el estilo en itálica para cada objeto seleccionado</span><span class="hljs-keyword">        For each</span> (<span class="hljs-variable">$name</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection)            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].stroke:=<span class="hljs-string">"red"</span>            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].fontStyle:=<span class="hljs-string">"italic"</span><span class="hljs-keyword">        End for each</span><span class="hljs-keyword">     Else</span> <span class="hljs-function">        ALERT</span>(<span class="hljs-string">"Please select a form object."</span>)<span class="hljs-keyword">    End if</span>     <span class="hljs-comment">// Notificar la modificación a 4D</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_onerror"></a><a aria-hidden="true" class="hash-link"href="#macros.html_onerror"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_onerroreditor--object-resultmacro--object--error--collection"></a><a aria-hidden="true" class="hash-link" href="#macros.html_onerroreditor--object-resultmacro--object--error--collection"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError($editor : Object; $resultMacro : Object ; $error: Collection)</h4><table><thead><tr><th>Parámetros</th><th></th><th>Tipo</th><th>Descripción</th></tr></thead><tbody><tr><td>$editor</td><td></td><td>Objeto</td><td>Objeto enviado a <a href="#macros.html_oninvoke">onInvoke</a></td></tr><tr><td>$resultMacro</td><td></td><td>Objeto</td><td>Objeto devuelto por <a href="#macros.html_oninvoke">onInvoke</a></td></tr><tr><td>$error</td><td></td><td>Collection</td><td>Pila de errores</td></tr><tr><td></td><td>[].errCode</td><td>Número</td><td>Código de error</td></tr><tr><td></td><td>[].message</td><td>Texto</td><td>Descripción del error</td></tr><tr><td></td><td>[].componentSignature</td><td>Texto</td><td>Firma del componente interno</td></tr></tbody></table><p>La función <code>onError</code> se ejecuta cuando el procesadorde macros encuentra un error.</p><p>Cuando se ejecuta una macro, si 4D encuentra un error que impidela cancelación de la macro, no la ejecuta. Es el caso, por ejemplo,de que la ejecución de una macro resulte en:</p><ul><li>borrar o modificar un script cuyo archivo es de sólolectura.</li><li>crear dos objetos con el mismo ID interno.</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_ejemplo-3"></a><a aria-hidden="true" class="hash-link"href="#macros.html_ejemplo-3"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ejemplo</h4><p>En la definición de una clase macro, se puede escribir elsiguiente código de error genérico:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onError</span>(<span class="hljs-variable">$editor </span>: Object; <span class="hljs-variable">$resultMacro </span>: Object; <span class="hljs-variable">$error </span>: Collection)<span class="hljs-keyword">    var</span> <span class="hljs-variable">$obj </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$txt </span>: Text    <span class="hljs-variable">$txt</span>:=<span class="hljs-string">""</span><span class="hljs-keyword">    For each</span> (<span class="hljs-variable">$obj</span>; <span class="hljs-variable">$error</span>)        <span class="hljs-variable">$txt</span>:=<span class="hljs-variable">$txt</span>+<span class="hljs-variable">$obj</span>.message+<span class="hljs-string">" \n"</span><span class="hljs-keyword">    End for each</span> <span class="hljs-function">    ALERT</span>(<span class="hljs-variable">$txt</span>)</code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#formEditor.html"><span class="arrow-prev">←</span> <span>Editorde formularios</span></a><a class="docs-next button" href="#objectLibrary.html"><span>Librerías de objetos</span><span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#macros.html_ejemplo-pr%25C3%25A1ctico">Ejemplopráctico</a></li><li><a href="#macros.html_llamar-a-las-macros-en-el-editor-de-formularios">Llamara las macros en el editor de formularios</a></li><li><a href="#macros.html_ubicaci%25C3%25B3n-del-archivo-de-macro">Ubicacióndel archivo de macro</a></li><li><a href="#macros.html_declaraci%25C3%25B3n-de-macros">Declaración demacros</a><ul class="toc-headings"><li><a href="#macros.html_ejemplo">Ejemplo</a></li></ul></li><li><a href="#macros.html_instanciar-las-macros-en-4d">Instanciarlas macros en 4D</a></li><li><a href="#macros.html_funciones-macro">Funciones macro</a><ul class="toc-headings"><li><a href="#macros.html_class-constructor">Classconstructor</a></li><li><a href="#macros.html_oninvoke">onInvoke()</a></li><li><a href="#macros.html_onerror">onError()</a></li></ul></li></ul></nav></div></div></body></html>