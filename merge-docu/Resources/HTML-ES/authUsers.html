<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="es"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Usuarios y sesiones · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="REST requests can benefit from [web user sessions](/docs/Rx/es/WebServer/sessions.html), providing extra features such as multiple requests handling, data sharing between the web client processes, and user privileges."name="description" /><meta content="es" name="docsearch:language" /><meta content="Usuarios y sesiones · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="REST requests can benefit from [web user sessions](/docs/Rx/es/WebServer/sessions.html), providing extra features such as multiple requests handling, data sharing between the web client processes, and user privileges."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#authUsers.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Usuarios ysesiones<a aria-hidden="true" class="anchor" id="authUsers.html"></a></h1></header><article><div><p><span>REST requests can benefit from <a href="#sessions.html">web user sessions</a>, providing extra featuressuch as multiple requests handling, data sharing between the webclient processes, and user privileges.</span></p><p><span>Como primer paso para abrir una sesión REST en el servidor4D, el usuario que envía la solicitud debe estarautenticado.</span></p><h2><span><a aria-hidden="true" class="anchor" id="authUsers.html_autenticaci%C3%B3n-de-los-usuarios"></a><a aria-hidden="true"class="hash-link" href="#authUsers.html_autenticaci%25C3%25B3n-de-los-usuarios"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Autenticación de los usuarios</span></h2><p><span>You log in a user to your application by calling <a href="#authUsers.html_directorylogin"><code>$directory/login</code></a>in a POST request including the user's name and password in theheader. This request calls the <code>On REST Authentication</code>database method (if it exists), where you can check the user'scredentials (see example below).</span></p><h2><span><a aria-hidden="true" class="anchor" id="authUsers.html_apertura-de-sesiones"></a><a aria-hidden="true"class="hash-link" href="#authUsers.html_apertura-de-sesiones"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Apertura de sesiones</span></h2><p><span>When <a href="#authUsers.html_enabling-sessions">scalablesessions are enabled</a> (recommended), if the <code>On RESTAuthentication</code> database method returns <code>true</code>, auser session is then automatically opened and you can handle itthrough the <code>Session</code> object and the <a href="#SessionClass.html">Session API</a>. Subsequent REST requests willreuse the same session cookie.</span></p><p><span>If the <code>On REST Authentication</code> database methodhas not been defined, a <code>guest</code> session isopened.</span></p><h2><span><a aria-hidden="true" class="anchor" id="authUsers.html_ejemplo"></a><a aria-hidden="true" class="hash-link" href="#authUsers.html_ejemplo"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Ejemplo</span></h2><p><span>In this example, the user enters their email and passwordin an html page that requests <a href="#authUsers.html_directorylogin"><code>$directory/login</code></a>in a POST (it is recommended to use an HTTPS connection to send thehtml page). The <code>On REST Authentication</code> database methodis called to validate the credentials and to set thesession.</span></p><p><span>Página de inicio de sesión HTML:</span></p><p><span><img alt="alt-text" src="https://developer.4d.com/docs/Rx/assets/en/REST/login.png" /></span></p><pre><span><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">bgcolor</span>=<span class="hljs-string">"#ffffff"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"demo"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">FORM</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"myForm"</span>&gt;</span>Email: <span class="hljs-tag">&lt;<span class="hljs-name">INPUT</span> <span class="hljs-attr">TYPE</span>=<span class="hljs-string">TEXT</span> <span class="hljs-attr">NAME</span>=<span class="hljs-string">userId</span> <span class="hljs-attr">VALUE</span>=<span class="hljs-string">""</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">BR</span>&gt;</span>Password: <span class="hljs-tag">&lt;<span class="hljs-name">INPUT</span> <span class="hljs-attr">TYPE</span>=<span class="hljs-string">TEXT</span> <span class="hljs-attr">NAME</span>=<span class="hljs-string">password</span> <span class="hljs-attr">VALUE</span>=<span class="hljs-string">""</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">BR</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"onClick()"</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"authenticationFailed"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"visibility:hidden;"</span>&gt;</span>Authentication failed<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">FORM</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendData</span>(<span class="hljs-params">data</span>) </span>{  <span class="hljs-keyword">var</span> XHR = <span class="hljs-keyword">new</span> XMLHttpRequest();  XHR.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status == <span class="hljs-number">200</span>) {            <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"authenticationOK.shtml"</span>;       }      <span class="hljs-keyword">else</span> {      <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"authenticationFailed"</span>).style.visibility = <span class="hljs-string">"visible"</span>;      }  };  XHR.open(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'http://127.0.0.1:8044/rest/$directory/login'</span>); <span class="hljs-comment">//rest server address</span>  XHR.setRequestHeader(<span class="hljs-string">'username-4D'</span>, data.userId);  XHR.setRequestHeader(<span class="hljs-string">'password-4D'</span>, data.password);  XHR.setRequestHeader(<span class="hljs-string">'session-4D-length'</span>, data.timeout);  XHR.send();};<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onClick</span>()</span>{sendData({<span class="hljs-attr">userId</span>:<span class="hljs-built_in">document</span>.forms[<span class="hljs-string">'myForm'</span>].elements[<span class="hljs-string">'userId'</span>].value , <span class="hljs-attr">password</span>:<span class="hljs-built_in">document</span>.forms[<span class="hljs-string">'myForm'</span>].elements[<span class="hljs-string">'password'</span>].value , <span class="hljs-attr">timeout</span>:<span class="hljs-number">120</span>})}</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></span></pre><p>When the login page is sent to the server, the <code>On RESTAuthentication</code> database method is called:</p><pre><code class="hljs css language-4d">    <span class="hljs-comment">//On REST Authentication</span>#<span class="hljs-function">DECLARE</span>(<span class="hljs-variable">$userId </span>: Text; <span class="hljs-variable">$password </span>: Text) -&gt; <span class="hljs-variable">$Accepted </span>: Boolean<span class="hljs-keyword">var</span> <span class="hljs-variable">$sales </span>: cs.SalesPersonsEntity<span class="hljs-variable">$Accepted</span>:=<span class="hljs-literal">False</span>    <span class="hljs-comment">//A '/rest' URL has been called with headers username-4D and password-4D</span><span class="hljs-keyword">If</span> (<span class="hljs-variable">$userId</span>#<span class="hljs-string">""</span>)    <span class="hljs-variable">$sales</span>:=ds.SalesPersons.<span class="hljs-function">query</span>(<span class="hljs-string">"email = :1"</span>; <span class="hljs-variable">$userId</span>).<span class="hljs-function">first</span>()<span class="hljs-keyword">    If</span> (<span class="hljs-variable">$sales</span>#<span class="hljs-literal">Null</span>)<span class="hljs-keyword">        If</span> (<span class="hljs-function">Verify password hash</span>(<span class="hljs-variable">$password</span>; <span class="hljs-variable">$sales</span>.password))<span class="hljs-function">            fillSession</span>(<span class="hljs-variable">$sales</span>)            <span class="hljs-variable">$Accepted</span>:=<span class="hljs-literal">True</span><span class="hljs-keyword">        End if</span><span class="hljs-keyword">     End if</span><span class="hljs-keyword"> End if</span> </code></pre><blockquote><p>As soon as it has been called and returned <code>True</code>,the <code>On REST Authentication</code> database method is nolonger called in the session.</p></blockquote><p>The <code>fillSession</code> project method initializes the usersession, for example:</p><pre><code class="hljs css language-4d">#<span class="hljs-function">DECLARE</span>(<span class="hljs-variable">$sales </span>: cs.SalesPersonsEntity)<span class="hljs-keyword">var</span> <span class="hljs-variable">$info </span>: Object<span class="hljs-variable">$info</span>:=<span class="hljs-function">New object</span>()<span class="hljs-variable">$info</span>.userName:=<span class="hljs-variable">$sales</span>.firstname+<span class="hljs-string">" "</span>+<span class="hljs-variable">$sales</span>.lastnameSession.<span class="hljs-function">setPrivileges</span>(<span class="hljs-variable">$info</span>)<span class="hljs-keyword">Use</span> (Session.storage)<span class="hljs-keyword">    If</span> (Session.storage.myTop3=<span class="hljs-literal">Null</span>)        Session.storage.myTop3:=<span class="hljs-variable">$sales</span>.customers.<span class="hljs-function">orderBy</span>(<span class="hljs-string">"totalPurchase desc"</span>).<span class="hljs-function">slice</span>(<span class="hljs-number">0</span>; <span class="hljs-number">3</span>)<span class="hljs-keyword">    End if</span><span class="hljs-keyword"> End use</span></code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#configuration.html"><span class="arrow-prev">←</span><span>Configuración del servidor</span></a><a class="docs-next button" href="#genInfo.html"><span>Obtener informacióndel servidor</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#authUsers.html_autenticaci%25C3%25B3n-de-los-usuarios">Autenticaciónde los usuarios</a></li><li><a href="#authUsers.html_apertura-de-sesiones">Apertura desesiones</a></li><li><a href="#authUsers.html_ejemplo">Ejemplo</a></li></ul></nav></div></div></body></html>