<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="es"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Copia de seguridad · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="Una copia de seguridad puede iniciarse de tres maneras:" name="description" /><meta content="es" name="docsearch:language" /><meta content="Copia de seguridad · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="Una copia de seguridad puede iniciarse de tres maneras:" property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#backup.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Copia deseguridad<a aria-hidden="true" class="anchor" id="backup.html"></a></h1></header><article><div><p><span>Una copia de seguridad puede iniciarse de tresmaneras:</span></p><ul><li><span>Manualmente, utilizando el comando <strong>Copia deseguridad...</strong> del menú 4D <strong>Archivo</strong> o elbotón <strong>Copia de seguridad</strong> del <a href="#backup.html">Centro de mantenimiento y seguridad</a>.</span></li><li><span>Automáticamente, utilizando el programador que se puededefinir en las Propiedades,</span></li><li><span>Por programación, utilizando el comando<code>BACKUP</code>.</span></li></ul><blockquote><p><span>4D Server: es posible iniciar una copia de seguridadmanualmente desde una máquina remota mediante un método que llamaal comando <code>BACKUP</code>. El comando se ejecutará, en todoslos casos, en el servidor.</span></p></blockquote><h2><span><a aria-hidden="true" class="anchor" id="backup.html_copia-de-seguridad-manual"></a><a aria-hidden="true"class="hash-link" href="#backup.html_copia-de-seguridad-manual"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Copia de seguridad manual</span></h2><ol><li><span>Seleccione el comando <strong>Backup...</strong> en elmenú 4D <strong>Archivo</strong>.<br />Aparece la ventana de copia de seguridad: <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/Backup/backup01.png" />Puede ver la ubicación de la carpeta de la copia de seguridadmediante el menú emergente situado junto al área "Destino de lacopia de seguridad". Esta ubicación se define en la página<strong>Copia de seguridad/configuración</strong> de lasPropiedades de la base.</span></li></ol><ul><li><span>También puede abrir el <a href="#overview.html">Centro demantenimiento y seguridad</a> de 4D y mostrar la <a href="#backup.html">página de copias de seguridad</a>.</span></li></ul><p><span>El botón <strong>Propiedades de la base...</strong>haceque se muestre la página Copia de seguridad/Configuración de lasPropiedades de la estructura.</span></p><ol start="2"><li><span>Haga clic en <strong>Copia de seguridad</strong> parainiciar la copia de seguridad utilizando los parámetrosactuales.</span></li></ol><h2><span><a aria-hidden="true" class="anchor" id="backup.html_backup-autom%C3%A1tico-peri%C3%B3dico"></a><a aria-hidden="true"class="hash-link" href="#backup.html_backup-autom%25C3%25A1tico-peri%25C3%25B3dico"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Backup automático periódico</span></h2><p><span>Las copias de seguridad programadas se inicianautomáticamente. Se configuran en la página<strong>Backup/Planificador</strong> de las **Propiedades**.</span></p><p><span>Las copias de seguridad se realizan automáticamente a lashoras definidas en esta página sin ningún tipo de intervención delusuario. Para más información sobre el uso de esta caja de diálogo,consulte <a href="#backup.html_scheduler">Definir las copias deseguridad periódicas</a>.</span></p><h2><span><a aria-hidden="true" class="anchor" id="backup.html_comando-backup"></a><a aria-hidden="true" class="hash-link" href="#backup.html_comando-backup"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Comando BACKUP</span></h2><p><span>Puede utilizar los métodos base <code>On BackupStartup</code> and <code>On Backup Shutdown</code> para controlarel proceso de copia de seguridad (consulte el manual <em>Lenguajede 4D</em>). Puede utilizar el método base <code>On BackupStartup</code> y <code>On Backup Shutdown</code>, para controlar elproceso de backup (ver el manual <em>Lenguaje de4D</em>).</span></p><h2><span><a aria-hidden="true" class="anchor" id="backup.html_c%C3%B3mo-funciona-la-copia-de-seguridad"></a><a aria-hidden="true"class="hash-link" href="#backup.html_c%25C3%25B3mo-funciona-la-copia-de-seguridad"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Cómo funciona la copia de seguridad</span></h2><p><span>Una vez iniciada la copia de seguridad, 4D muestra unacaja de diálogo con un termómetro que indica el progreso de lacopia de seguridad:</span></p><p><span><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/Backup/backupProgress.png" /></span></p><p><span>Este termómetro también se muestra en la página <a href="#backup.html">Backup del CSM</a> si ha utilizado esta caja dediálogo.</span></p><p><span>El botón <strong>Parar</strong> permite al usuariointerrumpir la copia de seguridad en cualquier momento (consulte<a href="#backup.html_handling-backup-issues">Manejar los problemasde la copia de seguridad</a> más adelante).</span></p><p><span>El estado de la última copia de seguridad (correcta ofallida) se almacena en el área de información de la <a href="#backup.html">página de copias de seguridad en el CSM</a> o en la<strong>página de mantenimiento</strong> de 4D Server. También seregistra en la base <strong>Backup journal.txt</strong>.</span></p><h3><span><a aria-hidden="true" class="anchor" id="backup.html_acceso-a-la-aplicaci%C3%B3n-durante-la-copia-de-seguridad"></a><a aria-hidden="true" class="hash-link" href="#backup.html_acceso-a-la-aplicaci%25C3%25B3n-durante-la-copia-de-seguridad"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Acceso a la aplicación durante la copia deseguridad</span></h3><p><span>4D bloquea los procesos relacionados con los tipos dearchivos incluidos en la copia de seguridad: si sólo se hace unacopia de seguridad de los archivos del proyecto, no se podráacceder a la estructura pero sí a los datos. Durante una copia deseguridad, el acceso a la aplicación está restringido por 4D enfunción del contexto.</span></p><p><span>Por el contrario, si sólo se hace una copia de seguridaddel archivo de datos, se sigue permitiendo el acceso a laestructura. En este caso, las posibilidades de acceso a laaplicación son las siguientes:</span></p><ul><li><span>Con 4D versión monopuesto, la aplicación está bloqueadatanto para lectura como para escritura; todos los procesos estáncongelados. No se puede realizar ninguna acción.</span></li><li><span>Con 4D Server, la aplicaci´n sólo está bloqueada enescritura; las máquinas cliente pueden ver los datos. Si unamáquina cliente envía una petición de adición, eliminación o cambioal servidor, aparece una ventana que pide al usuario que esperehasta el final de la copia de seguridad. Una vez guardada laaplicación, la ventana desaparece y se realiza la acción. Paracancelar la petición en proceso y no esperar a que finalice lacopia de seguridad, basta con hacer clic en el botón<strong>Cancelar la operación</strong>. Sin embargo, si la acciónque espera ser ejecutada proviene de un método lanzado antes de lacopia de seguridad, no debe cancelarla porque sólo se cancelan lasoperaciones que quedan por realizar. Además, un método parcialmenteejecutado puede causar inconsistencias lógicas en los datos. &gt;Cuando la acción que espera ser ejecutada proviene de un método yel usuario hace clic en el botón <strong>Cancelaroperación</strong>, 4D Server devuelve el error -9976 (Este comandono puede ejecutarse porque la copia de seguridad de la base está enprogreso).</span></li></ul><h3><span><a aria-hidden="true" class="anchor" id="backup.html_gesti%C3%B3n-de-los-problemas-de-las-copias-de-seguridad"></a><a aria-hidden="true" class="hash-link" href="#backup.html_gesti%25C3%25B3n-de-los-problemas-de-las-copias-de-seguridad"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Gestión de los problemas de las copias deseguridad</span></h3><p><span>Puede ocurrir que una copia de seguridad no se ejecutecorrectamente. Puede haber varias causas de fallo en la copia deseguridad: interrupción del usuario, archivo adjunto no encontrado,problemas en el disco de destino, transacción incompleta, etc. 4Dprocesa la incidencia según la causa.</span></p><p><span>En todos los casos, tenga en cuenta que el estado de laúltima copia de seguridad (correcta o fallida) se almacena en elárea de información de la <a href="#backup.html">página de copiasde seguridad en el CSM</a> o en la <strong>página demantenimiento</strong> de 4D Server, así como en el <strong>Backupjournal.txt</strong>.</span></p><ul><li><span><strong>Interrupción del usuario</strong>: el botón<strong>Parar</strong> de la caja de diálogo de progreso permite alos usuarios interrumpir la copia de seguridad en cualquiermomento. En este caso, la copia de elementos se detiene y se generael error 1406. Puedes interceptar este error en el método base<code>On Backup Shutdown</code>.</span></li><li><span><strong>Archivo adjunto no encontrado</strong>: cuando nose encuentra un archivo adjunto, 4D realiza una copia de seguridadparcial (copia de seguridad de los archivos de la aplicación y delos archivos adjuntos accesibles) y devuelve un error.</span></li><li><span><strong>Copia de seguridad imposible</strong> (discolleno o protegido contra escritura, disco ausente, fallo de disco,transacción incompleta, aplicación no lanzada en el momento de lacopia de seguridad automática programada, etc.): si se trata de unprimer error, 4D hará un segundo intento de realizar la copia deseguridad. La espera entre los dos intentos se define en la página<strong>Backup/Backup y Restauración</strong> de las Propiedades.Si el segundo intento falla, se muestra una caja de diálogo dealerta del sistema y se genera un error. Puedes interceptar esteerror en el método base <code>On BackupShutdown</code>.</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="backup.html_historial-de-copias-de-seguridad-backup-journal"></a><a aria-hidden="true"class="hash-link" href="#backup.html_historial-de-copias-de-seguridad-backup-journal"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Historial de copias de seguridad (BackupJournal)</span></h2><p><span>Para facilitar el seguimiento y la verificación de lascopias de seguridad, el módulo de copia de seguridad escribe unresumen de cada operación realizada en un archivo especial, que essimilar a un diario de actividades. Al igual que un manual de abordo, todas las operaciones de la base de datos (copias deseguridad, restauraciones, integraciones de archivos de registro)se registran en este archivo, tanto si se han programado como si sehan realizado manualmente. La fecha y la hora en que se produjeronestas operaciones también se anotan en el diario.</span></p><p><span>El historial de copia de seguridad se llama "BackupJournal[001].txt" y se coloca en la carpeta "Logs" del proyecto. Elhistorial de copias de seguridad puede abrirse con cualquier editorde texto.</span></p><h4><span><a aria-hidden="true" class="anchor" id="backup.html_gesti%C3%B3n-del-tama%C3%B1o-del-historial-de-copias-de-seguridad"></a><a aria-hidden="true" class="hash-link" href="#backup.html_gesti%25C3%25B3n-del-tama%25C3%25B1o-del-historial-de-copias-de-seguridad"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Gestión del tamaño del historial de copias deseguridad</span></h4><p><span>En determinadas estrategias de copia de seguridad (porejemplo, en el caso de que se realicen copias de seguridad denumerosos archivos adjuntos), el historial de copias de seguridadpuede alcanzar rápidamente un gran tamaño. Se pueden utilizar dosmecanismos para controlar este tamaño:</span></p><ul><li><span><strong>Copia de seguridad automática</strong>: antes decada copia de seguridad, la aplicación examina el tamaño delarchivo historial de copia de seguridad actual. Si es superior a 10MB, se archiva el archivo actual y se crea un nuevo archivo con elnúmero [xxx] incrementado, por ejemplo "Backup Journal[002].txt”.Una vez alcanzado el número de archivo 999, la numeración vuelve aempezar por el 1 y los archivos existentes seránsustituidos.</span></li><li><span><strong>Posibilidad de reducir la cantidad de informaciónregistrada</strong>: para ello, basta con modificar el valor de lallave <code>VerboseMode</code> en el archivo<em>Backup.4DSettings</em> del proyecto. Por defecto, esta llaveestá definida como True. Si cambia el valor de esta llave a False,sólo se almacenará en el diario de copias de seguridad lainformación principal: fecha y hora de inicio de la operación y loserrores encontrados. Las llaves XML relativas a la configuración dela copia de seguridad se describen en el manual <em>Backup de lasllaves XML 4D</em>.</span></li></ul><h2><span><a aria-hidden="true" class="anchor" id="backup.html_backuphistoryjson"></a><a aria-hidden="true" class="hash-link" href="#backup.html_backuphistoryjson"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>backupHistory.json</span></h2><p><span>Toda la información relativa a las últimas operaciones decopia de seguridad y restauración se almacena en el archivo<strong>backupHistory.json</strong> de la aplicación. Registra laruta de cada archivo guardado (incluidos los adjuntos), así como elnúmero, la fecha, la hora, la duración y el estado de cadaoperación. Para limitar el tamaño del archivo, el número deoperaciones registradas es el mismo que el número de copias deseguridad disponibles ("Conservar sólo los últimos X archivos decopia de seguridad") definido en las propiedades de la copia deseguridad.</span></p><p><span>El archivo <strong>backupHistory.json</strong> se crea enla carpeta de destino de la copia de seguridad actual. Puedeobtener la ruta real de este archivo utilizando la siguientedeclaración:</span></p><pre><span><code class="hljs css language-4d"><span class="hljs-variable">$backupHistory</span>:=<span class="hljs-function">Get 4D file</span>(Backup history file)</code></span></pre><blockquote><p><strong>Atención</strong><br />La eliminación o el desplazamiento del archivo<strong>backupHistory.json</strong> hará que se reinicie elsiguiente número de copia de seguridad. El archivo<strong>backupHistory.json</strong> está formateado para serutilizado por la aplicación 4D. Si lo que busca es un informelegible en las operaciones de copia de seguridad, quizá le resultemás preciso el diario de copias de seguridad.</p></blockquote></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#overview.html"><span class="arrow-prev">←</span><span>Generalidades</span></a><a class="docs-next button" href="#settings.html"><span>Parámetros de la copia de seguridad</span><span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#backup.html_copia-de-seguridad-manual">Copia deseguridad manual</a></li><li><a href="#backup.html_backup-autom%25C3%25A1tico-peri%25C3%25B3dico">Backupautomático periódico</a></li><li><a href="#backup.html_comando-backup">Comando BACKUP</a></li><li><a href="#backup.html_c%25C3%25B3mo-funciona-la-copia-de-seguridad">Cómofunciona la copia de seguridad</a><ul class="toc-headings"><li><a href="#backup.html_acceso-a-la-aplicaci%25C3%25B3n-durante-la-copia-de-seguridad">Acceso a la aplicación durante la copia de seguridad</a></li><li><a href="#backup.html_gesti%25C3%25B3n-de-los-problemas-de-las-copias-de-seguridad">Gestión de los problemas de las copias de seguridad</a></li></ul></li><li><a href="#backup.html_historial-de-copias-de-seguridad-backup-journal">Historialde copias de seguridad (Backup Journal)</a></li><li><a href="#backup.html_backuphistoryjson">backupHistory.json</a></li></ul></nav></div></div></body></html>