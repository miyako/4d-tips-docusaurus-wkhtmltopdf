<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="en"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Form Editor Macros · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="The 4D Form editor supports macros. A macro is a set of instructions to perform an action or a sequence of actions. When called upon, the macro will execute its instructions and automatically perform the action(s)."name="description" /><meta content="en" name="docsearch:language" /><meta content="Form Editor Macros · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="The 4D Form editor supports macros. A macro is a set of instructions to perform an action or a sequence of actions. When called upon, the macro will execute its instructions and automatically perform the action(s)."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#macros.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Form EditorMacros<a aria-hidden="true" class="anchor" id="macros.html"></a></h1></header><article><div><p><span>The 4D Form editor supports macros. A macro is a set ofinstructions to perform an action or a sequence of actions. Whencalled upon, the macro will execute its instructions andautomatically perform the action(s).</span></p><p><span>For example if you have a recurring report with specificformatting (e.g., certain text must appear in red and certain textmust appear in green), you can create a macro to automatically setthe color. You can create macros for the 4D Form editor thatcan:</span></p><ul><li><span>Create and execute 4D code</span></li><li><span>Display dialogs</span></li><li><span>Select form objects</span></li><li><span>Add / delete / modify forms, form objects as well astheir properties</span></li><li><span>Modify project files (update, delete)</span></li></ul><p><span>Macros code supports <a href="#classes.html">classfunctions</a> and <a href="#propertiesReference.html">form objectproperties in JSON</a> to let you define any custom feature in theForm editor.</span></p><p><span>Macros can been defined for the host project or forcomponents within the project. Usually, you will create a macro andinstall it within the components you use fordevelopment.</span></p><p><span>When called, a macro overrides any previously specifiedbehaviors.</span></p><h2><span><a aria-hidden="true" class="anchor" id="macros.html_hands-on-example"></a><a aria-hidden="true" class="hash-link" href="#macros.html_hands-on-example"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Hands-on example</span></h2><p><span>In this short example, you'll see how to create and call amacro that adds a "Hello World!" alert button in the top leftcorner of your form.</span></p><ol><li><span>In a <code>formMacros.json</code> file within the<code>Sources</code> folder of your project, you write:</span></li></ol><pre><span><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {      <span class="hljs-string">"Add Hello World button"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AddButton"</span>     }   }}</code></span></pre><ol start="2"><li><p>Create a 4D class named <code>AddButton</code>.</p></li><li><p>Within the <code>AddButton</code> class, write the followingfunction:</p></li></ol><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">        var</span> <span class="hljs-variable">$btnHello </span>: Object        <span class="hljs-comment">// Create a "Hello" button</span>    <span class="hljs-variable">$btnHello</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"type"</span>; <span class="hljs-string">"button"</span>; \    <span class="hljs-string">"text"</span>; <span class="hljs-string">"Hello World!"</span>; \    <span class="hljs-string">"method"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"source"</span>; <span class="hljs-string">"ALERT(\"Hello World!\")"</span>); \    <span class="hljs-string">"events"</span>;<span class="hljs-function"> New collection</span>(<span class="hljs-string">"onClick"</span>); \    <span class="hljs-string">"width"</span>; <span class="hljs-number">120</span>; \    <span class="hljs-string">"height"</span>; <span class="hljs-number">20</span>; \    <span class="hljs-string">"top"</span>; <span class="hljs-number">0</span>; \    <span class="hljs-string">"left"</span>; <span class="hljs-number">0</span>)          <span class="hljs-comment">// Add button in the current page</span>    <span class="hljs-variable">$editor</span>.editor.currentPage.objects.btnHello:=<span class="hljs-variable">$btnHello  </span>        <span class="hljs-comment">// Select the new button in the form editor</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">clear</span>() <span class="hljs-comment">//unselect elements</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">push</span>(<span class="hljs-string">"btnHello"</span>)            <span class="hljs-comment">// Notify the modification to the 4D Form editor</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentSelection"</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection;\          <span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><p>You can then call the macro: <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex1.png" /> <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex2.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_calling-macros-in-the-form-editor"></a><a aria-hidden="true" class="hash-link" href="#macros.html_calling-macros-in-the-form-editor"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Calling macros in the Form editor</h2><p>When macros are defined in your 4D project, you can call a macrousing the contextual menu of the Form editor:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroSelect.png" /></p><p>This menu is built upon the <code>formMacros.json</code><a href="#macros.html_location-of-macros">macro definitionfile(s)</a>. Macro items are sorted in alphabetical order.</p><p>This menu can be called in an empty area or a selection in theform. Selected object are passed to<code>$editor.currentSelection</code> or<code>$editor.target</code> in the <a href="#macros.html_oninvoke"><code>onInvoke</code></a> function of themacro.</p><p>A single macro can execute several operations. If selected, the<strong>Undo</strong> feature of the Form editor can be used toreverse macro operations globally.</p><h2><a aria-hidden="true" class="anchor" id="macros.html_location-of-macro-file"></a><a aria-hidden="true"class="hash-link" href="#macros.html_location-of-macro-file"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Location of macro file</h2><p>All 4D Form Editor macros are defined within a single JSON fileper project or component: <code>FormMacros.json</code>.</p><p>This file must be located in the host or component's<strong>Project</strong> &gt; <strong>Sources</strong> folder:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroStructure.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_declaring-macros"></a><a aria-hidden="true" class="hash-link" href="#macros.html_declaring-macros"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Declaring macros</h2><p>The structure of the <code>formMacros.json</code> file is thefollowing:</p><pre><code class="hljs css language-js">{    <span class="hljs-string">"macros"</span>: {            &lt;macroName&gt;: {                <span class="hljs-string">"class"</span>: &lt;className&gt;,                &lt;customProperty&gt; : &lt;value&gt;        }    }}</code></pre><p>Here is the description of the JSON file contents:</p><table><thead><tr><th>Attribute</th><th></th><th></th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>macros</td><td></td><td></td><td>object</td><td>list of defined macros</td></tr><tr><td></td><td><code>&lt;macroName&gt;</code></td><td></td><td>object</td><td>macro definition</td></tr><tr><td></td><td></td><td>class</td><td>string</td><td>macro class name</td></tr><tr><td></td><td></td><td><code>&lt;customProperty&gt;</code></td><td>any</td><td>(optional) custom value to retrieve in the constructor</td></tr></tbody></table><p>Custom properties, when used, are passed to the <a href="#macros.html_class-constructor">constructor</a> function of themacro.</p><h3><a aria-hidden="true" class="anchor" id="macros.html_example"></a><a aria-hidden="true" class="hash-link"href="#macros.html_example"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Example</h3><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Open Macros file"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"OpenMacro"</span>     },     <span class="hljs-string">"Align to Right on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"right"</span>     },     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><h2><a aria-hidden="true" class="anchor" id="macros.html_instantiating-macros-in-4d"></a><a aria-hidden="true"class="hash-link" href="#macros.html_instantiating-macros-in-4d"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Instantiating macros in 4D</h2><p>Each macro you want to instantiate in your project or componentmust be declared as a <a href="#classes.html">4D class</a>.</p><p>The class name must match the name defined using the <a href="#macros.html_creating-macros">class</a> attribute of the<code>formMacros.json</code> file.</p><p>Macros are instantiated at application startup. Consequently, ifyou modify the macro class structure (add a function, modify aparameter...) or the <a href="#macros.html_class-constructor">constructor</a>, you will have torestart the application to apply the changes.</p><h2><a aria-hidden="true" class="anchor" id="macros.html_macro-functions"></a><a aria-hidden="true" class="hash-link" href="#macros.html_macro-functions"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Macro Functions</h2><p>Every macro class can contain a <code>Class constructor</code>and two functions: <code>onInvoke()</code> and<code>onError()</code>.</p><h3><a aria-hidden="true" class="anchor" id="macros.html_class-constructor"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructor"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_class-constructormacro--object"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructormacro--object"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor($macro : Object)</h4><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$macro</td><td>Object</td><td>Macro declaration object (in the <code>formMacros.json</code>file)</td></tr></tbody></table><p>Macros are instantiated using a <a href="#macros.html_class-constructor">class constructor</a> function, ifit exists.</p><p>The class constructor is called once during class instantiation,which occurs at application startup.</p><p>Custom properties added to the <a href="#macros.html_declaring-macros">macro declaration</a> are returnedin the parameter of the class contructor function.</p><h4><a aria-hidden="true" class="anchor" id="macros.html_example-1"></a><a aria-hidden="true" class="hash-link"href="#macros.html_example-1"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Example</h4><p>In the <code>formMacros.json</code> file:</p><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><p>You can write:</p><pre><code class="hljs css language-4d"><span class="hljs-comment">// Class "AlignOnTarget"</span><span class="hljs-keyword">Class constructor</span>(<span class="hljs-variable">$macro </span>: Object)    <span class="hljs-literal">This</span>.myParameter:=<span class="hljs-variable">$macro</span>.myParam <span class="hljs-comment">//left</span>    ...</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_oninvoke"></a><a aria-hidden="true" class="hash-link"href="#macros.html_oninvoke"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_oninvokeeditor--object---result--object"></a><a aria-hidden="true"class="hash-link" href="#macros.html_oninvokeeditor--object---result--object"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke($editor : Object) -&gt; $result : Object</h4><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$editor</td><td>Object</td><td>Form Editor Macro Proxy object containing the formproperties</td></tr><tr><td>$result</td><td>Object</td><td>Form Editor Macro Proxy object returning properties modified bythe macro (optional)</td></tr></tbody></table><p>The <code>onInvoke</code> function is automatically executedeach time the macro is called.</p><p>When the function is called, it receives in the<code>$editor.editor</code> property a copy of all the elements ofthe form with their current values. You can then execute anyoperation on these properties.</p><p>Once operations are completed, if the macro results inmodifying, adding, or removing objects, you can pass the resultingedited properties in <code>$result</code>. The macro processor willparse the returned properties and apply necessary operations in theform. Obviously, the less properties you return, the less timeprocessing will require.</p><p>Here are the properties returned in the <em>$editor</em>parameter:</p><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$editor.editor.form</td><td>Object</td><td>The entire form</td></tr><tr><td>$editor.editor.file</td><td>File</td><td>File object of the form file</td></tr><tr><td>$editor.editor.name</td><td>String</td><td>Name of the form</td></tr><tr><td>$editor.editor.table</td><td>number</td><td>Table number of the form, 0 for project form</td></tr><tr><td>$editor.editor.currentPageNumber</td><td>number</td><td>The number of the current page</td></tr><tr><td>$editor.editor.currentPage</td><td>Object</td><td>The current page, containing all the form objects and the entryorder of the page</td></tr><tr><td>$editor.editor.currentSelection</td><td>Collection</td><td>Collection of names of selected objects</td></tr><tr><td>$editor.editor.formProperties</td><td>Object</td><td>Properties of the current form</td></tr><tr><td>$editor.editor.target</td><td>string</td><td>Name of the object under the mouse when clicked on a macro</td></tr></tbody></table><p>Here are the properties that you can pass in the<code>$result</code> object if you want the macro processor toexecute a modification. All properties are optional:</p><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>currentPage</td><td>Object</td><td>currentPage including objects modified by the macro, ifany</td></tr><tr><td>currentSelection</td><td>Collection</td><td>currentSelection if modified by the macro</td></tr><tr><td>formProperties</td><td>Object</td><td>formProperties if modified by the macro</td></tr><tr><td>editor.groups</td><td>Object</td><td>group info, if groups are modified by the macro</td></tr><tr><td>editor.views</td><td>Object</td><td>view info, if views are modified by the macro</td></tr><tr><td>editor.activeView</td><td>String</td><td>Active view name</td></tr></tbody></table><p>For example, if objects of the current page and groups have beenmodified, you can write:</p><pre><code class="hljs css language-4d">    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage ; \             <span class="hljs-string">"editor"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"groups"</span>; <span class="hljs-variable">$editor</span>.editor.form.editor.groups))</code></pre><h4><a aria-hidden="true" class="anchor" id="macros.html_method-attribute"></a><a aria-hidden="true" class="hash-link" href="#macros.html_method-attribute"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a><code>method</code> attribute</h4><p>When handling the <code>method</code> attribute of form objects,you can define the attribute value in two ways in macros:</p><ul><li><p>Using a <a href="#macros.html_method">string containing themethod file name/path</a>.</p></li><li><p>Using an object with the following structure:</p></li></ul><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>source</td><td>String</td><td>method code</td></tr></tbody></table><p>4D will create a file using the object name in the"objectMethods" folder with the content of <code>source</code>attribute. This feature is only available for macro code.</p><h4><a aria-hidden="true" class="anchor" id="macros.html_4did-property-in-currentpageobjects"></a><a aria-hidden="true"class="hash-link" href="#macros.html_4did-property-in-currentpageobjects"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a><code>$4dId</code> property in<code>currentPage.objects</code></h4><p>The <code>$4dId</code> property defines a unique ID for eachobject in the current page. This key is used by the macro processorto control changes in <code>$result.currentPage</code>:</p><ul><li>if the <code>$4dId</code> key is missing in both the form andan object in <code>$result</code>, the object is created.</li><li>if the <code>$4dId</code> key exists in the form but is missingin <code>$result</code>, the object is deleted.</li><li>if the <code>$4dId</code> key exists in both the form and anobject in <code>$result</code>, the object is modified.</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_example-2"></a><a aria-hidden="true" class="hash-link"href="#macros.html_example-2"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Example</h4><p>You want to define a macro function that will apply the redcolor and italic font style to any selected object(s).</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$name </span>: Text<span class="hljs-keyword">        If</span> (<span class="hljs-variable">$editor</span>.editor.currentSelection.length&gt;<span class="hljs-number">0</span>)               <span class="hljs-comment">// Set stroke to red and style to italic for each selected object</span><span class="hljs-keyword">        For each</span> (<span class="hljs-variable">$name</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection)            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].stroke:=<span class="hljs-string">"red"</span>            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].fontStyle:=<span class="hljs-string">"italic"</span><span class="hljs-keyword">        End for each</span><span class="hljs-keyword">             Else</span> <span class="hljs-function">        ALERT</span>(<span class="hljs-string">"Please select a form object."</span>)<span class="hljs-keyword">    End if</span>         <span class="hljs-comment">// Notify to 4D the modification</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_onerror"></a><a aria-hidden="true" class="hash-link"href="#macros.html_onerror"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_onerroreditor--object-resultmacro--object--error--collection"></a><a aria-hidden="true" class="hash-link" href="#macros.html_onerroreditor--object-resultmacro--object--error--collection"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError($editor : Object; $resultMacro : Object ; $error: Collection)</h4><table><thead><tr><th>Parameter</th><th></th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>$editor</td><td></td><td>Object</td><td>Object send to <a href="#macros.html_oninvoke">onInvoke</a></td></tr><tr><td>$resultMacro</td><td></td><td>Object</td><td>Object returned by <a href="#macros.html_oninvoke">onInvoke</a></td></tr><tr><td>$error</td><td></td><td>Collection</td><td>Error stack</td></tr><tr><td></td><td>[].errCode</td><td>Number</td><td>Error code</td></tr><tr><td></td><td>[].message</td><td>Text</td><td>Description of the error</td></tr><tr><td></td><td>[].componentSignature</td><td>Text</td><td>Internal component signature</td></tr></tbody></table><p>The <code>onError</code> function is executed when the macrosprocessor encounters an error.</p><p>When executing a macro, if 4D encounters an error which preventsthe macro from being cancelled, it does not execute the macro. Itis the case for example if executing a macro would result in:</p><ul><li>deleting or modifying a script whose file is read-only.</li><li>creating two objects with the same internal ID.</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_example-3"></a><a aria-hidden="true" class="hash-link"href="#macros.html_example-3"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Example</h4><p>In a macro class definition, you can write the following genericerror code:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onError</span>(<span class="hljs-variable">$editor </span>: Object; <span class="hljs-variable">$resultMacro </span>: Object; <span class="hljs-variable">$error </span>: Collection)<span class="hljs-keyword">    var</span> <span class="hljs-variable">$obj </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$txt </span>: Text    <span class="hljs-variable">$txt</span>:=<span class="hljs-string">""</span><span class="hljs-keyword">        For each</span> (<span class="hljs-variable">$obj</span>; <span class="hljs-variable">$error</span>)        <span class="hljs-variable">$txt</span>:=<span class="hljs-variable">$txt</span>+<span class="hljs-variable">$obj</span>.message+<span class="hljs-string">" \n"</span><span class="hljs-keyword">    End for each</span>     <span class="hljs-function">    ALERT</span>(<span class="hljs-variable">$txt</span>)</code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#formEditor.html"><span class="arrow-prev">←</span> <span>FormEditor</span></a><a class="docs-next button" href="#objectLibrary.html"><span>Object libraries</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#macros.html_hands-on-example">Hands-onexample</a></li><li><a href="#macros.html_calling-macros-in-the-form-editor">Calling macros inthe Form editor</a></li><li><a href="#macros.html_location-of-macro-file">Location of macrofile</a></li><li><a href="#macros.html_declaring-macros">Declaring macros</a><ul class="toc-headings"><li><a href="#macros.html_example">Example</a></li></ul></li><li><a href="#macros.html_instantiating-macros-in-4d">Instantiatingmacros in 4D</a></li><li><a href="#macros.html_macro-functions">Macro Functions</a><ul class="toc-headings"><li><a href="#macros.html_class-constructor">Classconstructor</a></li><li><a href="#macros.html_oninvoke">onInvoke()</a></li><li><a href="#macros.html_onerror">onError()</a></li></ul></li></ul></nav></div></div></body></html>