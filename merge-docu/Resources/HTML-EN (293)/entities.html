<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="en"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>Working with data · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="In ORDA, you access data through [entities](/docs/Rx/en/ORDA/dsmapping.html#entity) and [entity selections](/docs/Rx/en/ORDA/dsmapping.html#entity-selection). These objects allow you to create, update, query, or sort the data of the datastore."name="description" /><meta content="en" name="docsearch:language" /><meta content="Working with data · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="In ORDA, you access data through [entities](/docs/Rx/en/ORDA/dsmapping.html#entity) and [entity selections](/docs/Rx/en/ORDA/dsmapping.html#entity-selection). These objects allow you to create, update, query, or sort the data of the datastore."property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#entities.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">Working withdata<a aria-hidden="true" class="anchor" id="entities.html"></a></h1></header><article><div><p><span>In ORDA, you access data through <a href="#entities.html_entity">entities</a> and <a href="#entities.html_entity-selection">entity selections</a>. Theseobjects allow you to create, update, query, or sort the data of thedatastore.</span></p><h2><span><a aria-hidden="true" class="anchor" id="entities.html_creating-an-entity"></a><a aria-hidden="true" class="hash-link" href="#entities.html_creating-an-entity"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Creating an entity</span></h2><p><span>There are two ways to create a new entity in adataclass:</span></p><ul><li><span>Since entities are references to database records, youcan create entities by creating records using the "classic" 4Dlanguage and then reference them with ORDA methods such as<code>entity.next( )</code> or <code>entitySelection.first()</code>.</span></li><li><span>You can also create an entity using the<code>dataClass.new( )</code> method.</span></li></ul><p><span>Keep in mind that the entity is only created in memory. Ifyou want to add it to the datastore, you must call the<code>entity.save( )</code> method.</span></p><p><span>Entity attributes are directly available as properties ofthe entity object. For more information, please refer to <a href="#entities.html_using-entity-attributes">Using entityattributes</a>.</span></p><p><span>For example, we want to create a new entity in the"Employee" dataclass in the current datastore with "John" and"Dupont" assigned to the firstname and name attributes:</span></p><pre><span><code class="hljs css language-4d"><span class="hljs-keyword">var</span> <span class="hljs-variable">$myEntity </span>: cs.EmployeeEntity<span class="hljs-variable">$myEntity</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-comment">//Create a new object of the entity type</span><span class="hljs-variable">$myEntity</span>.name:=<span class="hljs-string">"Dupont"</span> <span class="hljs-comment">//assign 'Dupont' to the 'name' attribute</span><span class="hljs-variable">$myEntity</span>.firstname:=<span class="hljs-string">"John"</span> <span class="hljs-comment">//assign 'John' to the 'firstname' attribute</span><span class="hljs-variable">$myEntity</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">//save the entity</span></code></span></pre><blockquote><p>An entity is defined only in the process where it was created.You cannot, for example, store a reference to an entity in aninterprocess variable and use it in another process.</p></blockquote><h2><a aria-hidden="true" class="anchor" id="entities.html_entities-and-references"></a><a aria-hidden="true"class="hash-link" href="#entities.html_entities-and-references"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Entities and references</h2><p>An entity contains a reference to a 4D record. Differententities can reference the same 4D record. Also, since an entitycan be stored in a 4D object variable, different variables cancontain a reference to the same entity.</p><p>If you execute the following code:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$e1</span>; <span class="hljs-variable">$e2 </span>: cs.EmployeeEntity <span class="hljs-variable">$e1</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">//access the employee with ID 1</span> <span class="hljs-variable">$e2</span>:=<span class="hljs-variable">$e1</span> <span class="hljs-variable">$e1</span>.name:=<span class="hljs-string">"Hammer"</span>  <span class="hljs-comment">//both variables $e1 and $e2 share the reference to the same entity</span>  <span class="hljs-comment">//$e2.name contains "Hammer"</span></code></pre><p>This is illustrated by the following graphic:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/entityRef1.png" /></p><p>Now if you execute:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> var</span> <span class="hljs-variable">$e1</span>; <span class="hljs-variable">$e2 </span>: cs.EmployeeEntity <span class="hljs-variable">$e1</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-variable">$e2</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-variable">$e1</span>.name:=<span class="hljs-string">"Hammer"</span>  <span class="hljs-comment">//variable $e1 contains a reference to an entity</span>  <span class="hljs-comment">//variable $e2 contains another reference to another entity</span>  <span class="hljs-comment">//$e2.name contains "smith"</span></code></pre><p>This is illustrated by the following graphic:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/entityRef2.png" /></p><p>Note however that entities refer to the same record. In allcases, if you call the <code>entity.save( )</code> method, therecord will be updated (except in case of conflict, see <a href="#entities.html_entity-locking">Entity locking</a>).</p><p>In fact, <code>$e1</code> and <code>$e2</code> are not theentity itself, but a reference to the entity. It means that you canpass them directly to any function or method, and it will act likea pointer, and faster than a 4D pointer. For example:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword"> For each</span>(<span class="hljs-variable">$entity</span>;<span class="hljs-variable">$selection</span>)<span class="hljs-function">    do_Capitalize</span>(<span class="hljs-variable">$entity</span>)<span class="hljs-keyword"> End for each</span></code></pre><p>And the method is:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$entity</span>:=<span class="hljs-variable">$1</span> <span class="hljs-variable">$name</span>:=<span class="hljs-variable">$entity</span>.lastname<span class="hljs-keyword"> If</span>(<span class="hljs-function">Not</span>(<span class="hljs-variable">$name</span>=<span class="hljs-literal">Null</span>))    <span class="hljs-variable">$name</span>:=<span class="hljs-function">Uppercase</span>(<span class="hljs-function">Substring</span>(<span class="hljs-variable">$name</span>;<span class="hljs-number">1</span>;<span class="hljs-number">1</span>))+<span class="hljs-function">Lowercase</span>(<span class="hljs-function">Substring</span>(<span class="hljs-variable">$name</span>;<span class="hljs-number">2</span>))<span class="hljs-keyword"> End if</span> <span class="hljs-variable">$entity</span>.lastname:=<span class="hljs-variable">$name</span></code></pre><p>You can handle entities like any other object in 4D and passtheir references directly as <a href="#parameters.html">parameters</a>.</p><blockquote><p>With the entities, there is no concept of "current record" as inthe classic 4D language. You can use as many entities as you need,at the same time. There is also no automatic lock on an entity (see<a href="#entities.html_entity-locking">Entity locking</a>). Whenan entity is loaded, it uses the <a href="#entities.html_lazy-loading">lazy loading</a> mechanism, whichmeans that only the needed information is loaded. Nevertheless, inclient/server, the entity can be automatically loaded directly ifnecessary.</p></blockquote><h2><a aria-hidden="true" class="anchor" id="entities.html_using-entity-attributes"></a><a aria-hidden="true"class="hash-link" href="#entities.html_using-entity-attributes"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Using entity attributes</h2><p>Entity attributes store data and map corresponding fields in thecorresponding table. Entity attributes of the storage kind can beset or get as simple properties of the entity object, while entityof the <strong>relatedEntity</strong> or<strong>relatedEntities</strong> kind will return an entity or anentity selection.</p><blockquote><p>For more information on the attribute kind, please refer to the<a href="#entities.html_storage-and-relation-attributes">Storageand Relation attributes</a> paragraph.</p></blockquote><p>For example, to set a storage attribute:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$entity</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">//get employee attribute with ID 1</span> <span class="hljs-variable">$name</span>:=<span class="hljs-variable">$entity</span>.lastname <span class="hljs-comment">//get the employee name, e.g. "Smith"</span> <span class="hljs-variable">$entity</span>.lastname:=<span class="hljs-string">"Jones"</span> <span class="hljs-comment">//set the employee name</span> <span class="hljs-variable">$entity</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">//save the modifications</span></code></pre><blockquote><p>Database Blob fields (<a href="#blob.html">scalar blobs</a> areautomatically converted to and from blob object attributes(<a href="#blob.html"><code>4D.Blob</code></a>) when handledthrough ORDA. When saving a blob object attribute, keep in mindthat, unlike blob object size which is only limited by theavailable memory, Blob field size is limited to 2GB.</p></blockquote><p>Accessing a related attribute depends on the attribute kind. Forexample, with the following structure:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/entityAttributes.png" /></p><p>You can access data through the related object(s):</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$entity</span>:=ds.Project.<span class="hljs-function">all</span>().<span class="hljs-function">first</span>().theClient <span class="hljs-comment">//get the Company entity associated to the project</span> <span class="hljs-variable">$EntitySel</span>:=ds.Company.<span class="hljs-function">all</span>().<span class="hljs-function">first</span>().companyProjects <span class="hljs-comment">//get the selection of projects for the company</span></code></pre><p>Note that both <em>theClient</em> and <em>companyProjects</em>in the above example are primary relation attributes and representa direct relationship between the two dataclasses. However,relation attributes can also be built upon paths throughrelationships at several levels, including circular references. Forexample, consider the following structure:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/entityAttributes2.png" /></p><p>Each employee can be a manager and can have a manager. To getthe manager of the manager of an employee, you can simplywrite:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$myEmp</span>:=ds.Employee.<span class="hljs-function">get</span>(<span class="hljs-number">50</span>) <span class="hljs-variable">$manLev2</span>:=<span class="hljs-variable">$myEmp</span>.manager.manager.lastname</code></pre><h2><a aria-hidden="true" class="anchor" id="entities.html_assigning-values-to-relation-attributes"></a><a aria-hidden="true"class="hash-link" href="#entities.html_assigning-values-to-relation-attributes"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Assigning values to relation attributes</h2><p>In the ORDA architecture, relation attributes directly containdata related to entities:</p><ul><li>An N-&gt;1 type relation attribute(<strong>relatedEntity</strong> kind) contains an entity</li><li>A 1-&gt;N type relation attribute(<strong>relatedEntities</strong> kind) contains an entityselection</li></ul><p>Let's look at the following (simplified) structure:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/entityAttributes3.png" /></p><p>In this example, an entity in the "Employee" dataclass containsan object of type Entity in the "employer" attribute (or a nullvalue). An entity in the "Company" dataclass contains an object oftype EntitySelection in the "staff" attribute (or a nullvalue).</p><blockquote><p>In ORDA, the Automatic or Manual property of relations has noeffect.</p></blockquote><p>To assign a value directly to the "employer" attribute, you mustpass an existing entity from the "Company" dataclass. Forexample:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-comment">// create an employee</span> <span class="hljs-variable">$emp</span>.lastname:=<span class="hljs-string">"Smith"</span> <span class="hljs-comment">// assign a value to an attribute</span> <span class="hljs-variable">$emp</span>.employer:=ds.Company.<span class="hljs-function">query</span>(<span class="hljs-string">"name =:1"</span>;<span class="hljs-string">"4D"</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment">//assign a company entity</span> <span class="hljs-variable">$emp</span>.<span class="hljs-function">save</span>()</code></pre><p>4D provides an additional facility for entering a relationattribute for an N entity related to a "1" entity: you pass theprimary key of the "1" entity directly when assigning a value tothe relation attribute. For this to work, you pass data of typeNumber or Text (the primary key value) to the relation attribute.4D then automatically takes care of searching for the correspondingentity in the dataclass. For example:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$emp</span>:=ds.Employee.<span class="hljs-function">new</span>() <span class="hljs-variable">$emp</span>.lastname:=<span class="hljs-string">"Wesson"</span> <span class="hljs-variable">$emp</span>.employer:=<span class="hljs-number">2</span> <span class="hljs-comment">// assign a primary key to the relation attribute</span>  <span class="hljs-comment">//4D looks for the company whose primary key (in this case, its ID) is 2</span>  <span class="hljs-comment">//and assigns it to the employee</span> <span class="hljs-variable">$emp</span>.<span class="hljs-function">save</span>()</code></pre><p>This is particularly useful when you are importing large amountsof data from a relational database. This type of import usuallycontains an "ID" column, which references a primary key that youcan then assign directly to a relation attribute.</p><p>This also means that you can assign primary keys in the Nentities without corresponding entities having already been createdin the 1 datastore class. If you assign a primary key that does notexist in the related datastore class, it is nevertheless stored andassigned by 4D as soon as this "1" entity is created.</p><p>You can assign or modify the value of a "1" related entityattribute from the "N" dataclass directly through the relatedattribute. For example, if you want to modify the name attribute ofa related Company entity of an Employee entity, you can write:</p><pre><code class="hljs css language-code4d"> <span class="hljs-variable">$emp</span>:=ds<span class="hljs-selector-class">.Employee</span>.get(<span class="hljs-number">2</span>) <span class="hljs-comment">// load the Employee entity with primary key 2</span> <span class="hljs-variable">$emp</span><span class="hljs-selector-class">.employer</span><span class="hljs-selector-class">.name</span>:=<span class="hljs-string">"4D, Inc."</span> <span class="hljs-comment">//modify the name attribute of the related Company</span> <span class="hljs-variable">$emp</span><span class="hljs-selector-class">.employer</span>.save() <span class="hljs-comment">//save the related attribute</span>  <span class="hljs-comment">//the related entity is updated</span></code></pre><h2><a aria-hidden="true" class="anchor" id="entities.html_creating-an-entity-selection"></a><a aria-hidden="true" class="hash-link" href="#entities.html_creating-an-entity-selection"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Creating an entity selection</h2><p>You can create an object of type <a href="#entities.html_entity-selection">entity selection</a> asfollows:</p><ul><li>Querying the entities <a href="#entities.html_query">in adataclass</a> or in an <a href="#entities.html_query">existingentity selection</a>;</li><li>Using the <a href="#entities.html_all"><code>.all()</code></a>dataclass function to select all the entities in a dataclass;</li><li>Using the <code>Create entity selection</code> command or the<a href="#entities.html_newselection"><code>.newSelection()</code></a>dataclass function to create a blank entity selection;</li><li>Using the <a href="#entities.html_copy"><code>.copy()</code></a> function toduplicate an existing entity selection;</li><li>Using one of the various functions from the <a href="#EntitySelectionClass.html">Entity selection class</a> thatreturns a new entity selection, such as <a href="#entities.html_or"><code>.or()</code></a>;</li><li>Using a relation attribute of type "related entities" (seebelow).</li></ul><p>You can simultaneously create and use as many different entityselections as you want for a dataclass. Keep in mind that an entityselection only contains references to entities. Different entityselections can contain references to the same entities.</p><h3><a aria-hidden="true" class="anchor" id="entities.html_shareable-or-alterable-entity-selections"></a><a aria-hidden="true"class="hash-link" href="#entities.html_shareable-or-alterable-entity-selections"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Shareable or alterable entity selections</h3><p>An entity selection can be <strong>shareable</strong> (readableby multiple processes, but not alterable after creation) or<strong>alterable</strong> (supports the <a href="#entities.html_add"><code>.add()</code></a> function, but onlyusable by the current process).</p><h4><a aria-hidden="true" class="anchor" id="entities.html_properties"></a><a aria-hidden="true" class="hash-link" href="#entities.html_properties"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Properties</h4><p>A <strong>shareable</strong> entity selection has the followingcharacteristics:</p><ul><li>it can be stored in a shared object or shared collection, andcan be passed as parameter between several processes orworkers;</li><li>it can be stored in several shared objects or collections, orin a shared object or collection which already belongs to a group(it does not have a <em>locking identifier</em>);</li><li>it does not allow the addition of new entities. Trying to addan entity to a shareable entity selection will trigger an error(1637 - This entity selection cannot be altered). To add an entityto a shareable entity selection, you must first transform it into anon-shareable entity selection using the <a href="#entities.html_copy"><code>.copy()</code></a> function, beforecalling <a href="#entities.html_add"><code>.add()</code></a>.</li></ul><blockquote><p>Most entity selection functions (such as <a href="#entities.html_slice"><code>.slice()</code></a>, <a href="#entities.html_and"><code>.and()</code></a>...) support shareableentity selections since they do not need to alter the originalentity selection (they return a new one).</p></blockquote><p>An <strong>alterable</strong> entity selection has the followingcharacteristics:</p><ul><li>it cannot be shared between processes, nor be stored in ashared object or collection. Trying to store a non-shareable entityselection in a shared object or collection will trigger an error(-10721 - Not supported value type in a shared object or sharedcollection);</li><li>it accepts the addition of new entities, i.e. it is supportsthe <a href="#entities.html_add"><code>.add()</code></a>function.</li></ul><h4><a aria-hidden="true" class="anchor" id="entities.html_how-are-they-defined"></a><a aria-hidden="true"class="hash-link" href="#entities.html_how-are-they-defined"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>How are they defined?</h4><p>The <strong>shareable</strong> or <strong>alterable</strong>nature of an entity selection is defined when the entity selectionis created (it cannot be modified afterwards). You can know thenature of an entity selection using the <a href="#entities.html_isalterable">.isAlterable()</a> function or the<code>OB Is shared</code> command.</p><p>A new entity selection is <strong>shareable</strong> in thefollowing cases:</p><ul><li>the new entity selection results from an ORDA class functionapplied to a dataClass: <a href="#entities.html_all">dataClass.all()</a>, <a href="#entities.html_fromcollection">dataClass.fromCollection()</a>,<a href="#entities.html_query">dataClass.query()</a>,</li><li>the new entity selection is based upon a relation <a href="#entities.html_attributename">entity.<em>attributeName</em></a>(e.g. "company.employees") when <em>attributeName</em> is aone-to-many related attribute but the entity does not belong to anentity selection.</li><li>the new entity selection is explicitely copied as shareablewith <a href="#entities.html_copy">entitySelection.copy()</a> or<code>OB Copy</code> (i.e. with the <code>ck shared</code>option).</li></ul><p>Example:</p><pre><code class="hljs css language-4d"><span class="hljs-variable">$myComp</span>:=ds.Company.<span class="hljs-function">get</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">//$myComp does not belong to an entity selection</span><span class="hljs-variable">$employees</span>:=<span class="hljs-variable">$myComp</span>.employees <span class="hljs-comment">//$employees is shareable</span></code></pre><p>A new entity selection is <strong>alterable</strong> in thefollowing cases:</p><ul><li>the new entity selection created blank using the <a href="#entities.html_newselection">dataClass.newSelection()</a> functionor <code>Create entity selection</code> command,</li><li>the new entity selection is explicitely copied as alterablewith <a href="#entities.html_copy">entitySelection.copy()</a> or<code>OB Copy</code> (i.e. without the <code>ck shared</code>option).</li></ul><p>Example:</p><pre><code class="hljs css language-4d"><span class="hljs-variable">$toModify</span>:=ds.Company.<span class="hljs-function">all</span>().<span class="hljs-function">copy</span>() <span class="hljs-comment">//$toModify is alterable</span></code></pre><p>A new entity selection <strong>inherits</strong> from theoriginal entity selection nature in the following cases:</p><ul><li>the new entity selection results from one of the various ORDAclass functions applied to an existing entity selection (<a href="#entities.html_query">.query()</a>, <a href="#entities.html_slice">.slice()</a>, etc.) .</li><li>the new entity selection is based upon a relation:<ul><li><a href="#entities.html_attributename">entity.<em>attributeName</em></a>(e.g. "company.employees") when <em>attributeName</em> is aone-to-many related attribute and the entity belongs to an entityselection (same nature as <a href="#entities.html_getselection">.getSelection()</a> entityselection),</li><li><a href="#entities.html_attributename">entitySelection.<em>attributeName</em></a>(e.g. "employees.employer") when <em>attributeName</em> is arelated attribute (same nature as the entity selection),</li><li><a href="#entities.html_extract">.extract()</a> when theresulting collection contains entity selections (same nature as theentity selection).</li></ul></li></ul><p>Examples:</p><pre><code class="hljs css language-4d"><span class="hljs-variable">$highSal</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"salary &gt;= :1"</span>; <span class="hljs-number">1000000</span>)       <span class="hljs-comment">//$highSal is shareable because of the query on dataClass</span><span class="hljs-variable">$comp</span>:=<span class="hljs-variable">$highSal</span>.employer <span class="hljs-comment">//$comp is shareable because $highSal is shareable</span><span class="hljs-variable">$lowSal</span>:=ds.Employee.<span class="hljs-function">query</span>(<span class="hljs-string">"salary &lt;= :1"</span>; <span class="hljs-number">10000</span>).<span class="hljs-function">copy</span>()     <span class="hljs-comment">//$lowSal is alterable because of the copy()</span><span class="hljs-variable">$comp2</span>:=<span class="hljs-variable">$lowSal</span>.employer <span class="hljs-comment">//$comp2 is alterable because $lowSal is alterable</span></code></pre><h4><a aria-hidden="true" class="anchor" id="entities.html_sharing-an-entity-selection-between-processes-example"></a><a aria-hidden="true" class="hash-link" href="#entities.html_sharing-an-entity-selection-between-processes-example"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Sharing an entity selection between processes(example)</h4><p>You work with two entity selections that you want to pass to aworker process so that it can send mails to appropriatepersons:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">var</span> <span class="hljs-variable">$paid</span>; <span class="hljs-variable">$unpaid </span>: cs.InvoicesSelection<span class="hljs-comment">//We get entity selections for paid and unpaid invoices</span><span class="hljs-variable">$paid</span>:=ds.Invoices.<span class="hljs-function">query</span>(<span class="hljs-string">"status=:1"</span>; <span class="hljs-string">"Paid"</span>)<span class="hljs-variable">$unpaid</span>:=ds.Invoices.<span class="hljs-function">query</span>(<span class="hljs-string">"status=:1"</span>; <span class="hljs-string">"Unpaid"</span>)<span class="hljs-comment">//We pass entity selection references as parameters to the worker</span><span class="hljs-function">CALL WORKER</span>(<span class="hljs-string">"mailing"</span>; <span class="hljs-string">"sendMails"</span>; <span class="hljs-variable">$paid</span>; <span class="hljs-variable">$unpaid</span>) </code></pre><p>The <code>sendMails</code> method:</p><pre><code class="hljs css language-4d"> #<span class="hljs-function">DECLARE </span>(<span class="hljs-variable">$paid </span>: cs.InvoicesSelection; <span class="hljs-variable">$unpaid </span>: cs.InvoicesSelection)<span class="hljs-keyword"> var</span> <span class="hljs-variable">$invoice </span>: cs.InvoicesEntity<span class="hljs-keyword">  var</span> <span class="hljs-variable">$server</span>; <span class="hljs-variable">$transporter</span>; <span class="hljs-variable">$email</span>; <span class="hljs-variable">$status </span>: Object   <span class="hljs-comment">//Prepare emails</span> <span class="hljs-variable">$server</span>:=<span class="hljs-function">New object</span>() <span class="hljs-variable">$server</span>.host:=<span class="hljs-string">"exchange.company.com"</span> <span class="hljs-variable">$server</span>.user:=<span class="hljs-string">"myName@company.com"</span> <span class="hljs-variable">$server</span>.password:=<span class="hljs-string">"my!!password"</span> <span class="hljs-variable">$transporter</span>:=<span class="hljs-function">SMTP New transporter</span>(<span class="hljs-variable">$server</span>) <span class="hljs-variable">$email</span>:=<span class="hljs-function">New object</span>() <span class="hljs-variable">$email</span>.from:=<span class="hljs-string">"myName@company.com"</span>   <span class="hljs-comment">//Loops on entity selections</span><span class="hljs-keyword"> For each</span>(<span class="hljs-variable">$invoice</span>;<span class="hljs-variable">$paid</span>)    <span class="hljs-variable">$email</span>.to:=<span class="hljs-variable">$invoice</span>.customer.address <span class="hljs-comment">// email address of the customer</span>    <span class="hljs-variable">$email</span>.subject:=<span class="hljs-string">"Payment OK for invoice # "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$invoice</span>.number)    <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$transporter</span>.<span class="hljs-function">send</span>(<span class="hljs-variable">$email</span>)<span class="hljs-keyword"> End for each</span><span class="hljs-keyword">  For each</span>(<span class="hljs-variable">$invoice</span>;<span class="hljs-variable">$unpaid</span>)    <span class="hljs-variable">$email</span>.to:=<span class="hljs-variable">$invoice</span>.customer.address <span class="hljs-comment">// email address of the customer</span>    <span class="hljs-variable">$email</span>.subject:=<span class="hljs-string">"Please pay invoice # "</span>+<span class="hljs-function">String</span>(<span class="hljs-variable">$invoice</span>.number)    <span class="hljs-variable">$status</span>:=<span class="hljs-variable">$transporter</span>.<span class="hljs-function">send</span>(<span class="hljs-variable">$email</span>)<span class="hljs-keyword"> End for each</span></code></pre><h3><a aria-hidden="true" class="anchor" id="entities.html_entity-selections-and-storage-attributes"></a><a aria-hidden="true"class="hash-link" href="#entities.html_entity-selections-and-storage-attributes"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Entity selections and Storage attributes</h3><p>All storage attributes (text, number, boolean, date) areavailable as properties of entity selections as well as entities.When used in conjunction with an entity selection, a scalarattribute returns a collection of scalar values. For example:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$locals</span>:=ds.Person.<span class="hljs-function">query</span>(<span class="hljs-string">"city = :1"</span>;<span class="hljs-string">"San Jose"</span>) <span class="hljs-comment">//entity selection of people</span> <span class="hljs-variable">$localEmails</span>:=<span class="hljs-variable">$locals</span>.emailAddress <span class="hljs-comment">//collection of email addresses (strings)</span></code></pre><p>This code returns in <em>$localEmails</em> a collection of emailaddresses as strings.</p><h3><a aria-hidden="true" class="anchor" id="entities.html_entity-selections-and-relation-attributes"></a><a aria-hidden="true"class="hash-link" href="#entities.html_entity-selections-and-relation-attributes"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Entity selections and Relation attributes</h3><p>In addition to the variety of ways you can query, you can alsouse relation attributes as properties of entity selections toreturn new entity selections. For example, consider the followingstructure:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/entitySelectionRelationAttributes.png" /></p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$myParts</span>:=ds.Part.<span class="hljs-function">query</span>(<span class="hljs-string">"ID &lt; 100"</span>) <span class="hljs-comment">//Return parts with ID less than 100</span> <span class="hljs-variable">$myInvoices</span>:=<span class="hljs-variable">$myParts</span>.invoiceItems.invoice  <span class="hljs-comment">//All invoices with at least one line item related to a part in $myParts</span></code></pre><p>The last line will return in $myInvoices an entity selection ofall invoices that have at least one invoice item related to a partin the entity selection myParts. When a relation attribute is usedas a property of an entity selection, the result is always anotherentity selection, even if only one entity is returned. When arelation attribute is used as a property of an entity selection andno entities are returned, the result is an empty entity selection,not null.</p><h2><a aria-hidden="true" class="anchor" id="entities.html_entity-locking"></a><a aria-hidden="true" class="hash-link" href="#entities.html_entity-locking"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Entity Locking</h2><p>You often need to manage possible conflicts that might arisewhen several users or processes load and attempt to modify the sameentities at the same time. Record locking is a methodology used inrelational databases to avoid inconsistent updates to data. Theconcept is to either lock a record upon read so that no otherprocess can update it, or alternatively, to check when saving arecord to verify that some other process hasn’t modified it sinceit was read. The former is referred to as <strong>pessimisticrecord locking</strong> and it ensures that a modified record canbe written at the expense of locking records to other users. Thelatter is referred to as <strong>optimistic record locking</strong>and it trades the guarantee of write privileges to the record forthe flexibility of deciding write privileges only if the recordneeds to be updated. In pessimistic record locking, the record islocked even if there is no need to update it. In optimistic recordlocking, the validity of a record’s modification is decided atupdate time.</p><p>ORDA provides you with two entity locking modes:</p><ul><li>an automatic "optimistic" mode, suitable for mostapplications,</li><li>a "pessimistic" mode allowing you to lock entities prior totheir access.</li></ul><h3><a aria-hidden="true" class="anchor" id="entities.html_automatic-optimistic-lock"></a><a aria-hidden="true"class="hash-link" href="#entities.html_automatic-optimistic-lock"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Automatic optimistic lock</h3><p>This automatic mechanism is based on the concept of "optimisticlocking" which is particularly suited to the issues of webapplications. This concept is characterized by the followingoperating principles:</p><ul><li>All entities can always be loaded in read-write; there is no<em>a priori</em> "locking" of entities.</li><li>Each entity has an internal locking stamp that is incrementedeach time it is saved.</li><li>When a user or process tries to save an entity using the<code>entity.save( )</code> method, 4D compares the stamp value ofthe entity to be saved with that of the entity found in the data(in the case of a modification):<ul><li>When the values match, the entity is saved and the internalstamp value is incremented.</li><li>When the values do not match, it means that another user hasmodified this entity in the meantime. The save is not performed andan error is returned.</li></ul></li></ul><p>The following diagram illustrates optimistic locking:</p><ol><li><p>Two processes load the same entity.<br /><br /><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/optimisticLock1.png" /></p></li><li><p>The first process modifies the entity and validates the change.The <code>entity.save( )</code> method is called. The 4D engineautomatically compares the internal stamp value of the modifiedentity with that of the entity stored in the data. Since theymatch, the entity is saved and its stamp value isincremented.<br /><br /><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/optimisticLock2.png" /></p></li><li><p>The second process also modifies the loaded entity and validatesits changes. The <code>entity.save( )</code> method is called.Since the stamp value of the modified entity does not match the oneof the entity stored in the data, the save is not performed and anerror is returned.<br /><br /><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/optimisticLock3.png" /></p></li></ol><p>This can also be illustrated by the following code:</p><pre><code class="hljs css language-4d"> <span class="hljs-variable">$person1</span>:=ds.Person.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">//Reference to entity</span> <span class="hljs-variable">$person2</span>:=ds.Person.<span class="hljs-function">get</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">//Other reference to same entity</span> <span class="hljs-variable">$person1</span>.name:=<span class="hljs-string">"Bill"</span> <span class="hljs-variable">$result</span>:=<span class="hljs-variable">$person1</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">//$result.success=true, change saved</span> <span class="hljs-variable">$person2</span>.name:=<span class="hljs-string">"William"</span> <span class="hljs-variable">$result</span>:=<span class="hljs-variable">$person2</span>.<span class="hljs-function">save</span>() <span class="hljs-comment">//$result.success=false, change not saved</span></code></pre><p>In this example, we assign to $person1 a reference to the personentity with a key of 1. Then, we assign another reference of thesame entity to variable $person2. Using $person1, we change thefirst name of the person and save the entity. When we attempt to dothe same thing with $person2, 4D checks to make sure the entity ondisk is the same as when the reference in $person1 was firstassigned. Since it isn't the same, it returns false in the successproperty and doesn’t save the second modification.</p><p>When this situation occurs, you can, for example, reload theentity from the disk using the <code>entity.reload()</code> methodso that you can try to make the modification again. The<code>entity.save()</code> method also proposes an "automerge"option to save the entity in case processes modified attributesthat were not the same.</p><blockquote><p>Record stamps are not used in <strong>transactions</strong>because only a single copy of a record exists in this context.Whatever the number of entities that reference a record, the samecopy is modified thus <code>entity.save()</code> operations willnever generate stamp errors.</p></blockquote><h3><a aria-hidden="true" class="anchor" id="entities.html_pessimistic-lock"></a><a aria-hidden="true" class="hash-link" href="#entities.html_pessimistic-lock"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Pessimistic lock</h3><p>You can lock and unlock entities on demand when accessing data.When an entity is getting locked by a process, it is loaded inread/write in this process but it is locked for all otherprocesses. The entity can only be loaded in read-only mode in theseprocesses; its values cannot be edited or saved.</p><p>This feature is based upon two functions of the<code>Entity</code> class:</p><ul><li><a href="#entities.html_lock"><code>entity.lock()</code></a></li><li><a href="#entities.html_unlock"><code>entity.unlock()</code></a></li></ul><p>For more information, please refer to the descriptions for thesefunctions.</p><blockquote><p>Pessimistic locks can also be handled through the <a href="#lock.html">REST API</a>.</p></blockquote><h3><a aria-hidden="true" class="anchor" id="entities.html_concurrent-use-of-4d-classic-locks-and-orda-pessimistic-locks"></a><a aria-hidden="true" class="hash-link" href="#entities.html_concurrent-use-of-4d-classic-locks-and-orda-pessimistic-locks"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Concurrent use of 4D classic locks and ORDA pessimisticlocks</h3><p>Using both classic and ORDA commands to lock records is basedupon the following principles:</p><ul><li>A lock set with a classic 4D command on a record prevents ORDAto lock the entity matching the record.</li><li>A lock set with ORDA on an entity prevents classic 4D commandsto lock the record matching the entity.</li></ul><p>These principles are shown in the following diagram:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/concurrent1.png" /></p><p><strong>Transaction locks</strong> also apply to both classicand ORDA commands. In a multiprocess or a multi-user application, alock set within a transaction on a record by a classic command willresult in preventing any other processes to lock entities relatedto this record (or conversely), until the transaction is validatedor canceled.</p><ul><li>Example with a lock set by a classic command:<br /><br /><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/concurrent2.png" /></li><li>Example with a lock set by an ORDA function:<br /><br /><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/ORDA/concurrent3.png" /></li></ul></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#ordaClasses.html"><span class="arrow-prev">←</span> <span>DataModel Classes</span></a><a class="docs-next button" href="#datastores.html"><span>Using a remote datastore</span><span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#entities.html_creating-an-entity">Creating anentity</a></li><li><a href="#entities.html_entities-and-references">Entities andreferences</a></li><li><a href="#entities.html_using-entity-attributes">Using entityattributes</a></li><li><a href="#entities.html_assigning-values-to-relation-attributes">Assigningvalues to relation attributes</a></li><li><a href="#entities.html_creating-an-entity-selection">Creatingan entity selection</a><ul class="toc-headings"><li><a href="#entities.html_shareable-or-alterable-entity-selections">Shareableor alterable entity selections</a></li><li><a href="#entities.html_entity-selections-and-storage-attributes">Entityselections and Storage attributes</a></li><li><a href="#entities.html_entity-selections-and-relation-attributes">Entityselections and Relation attributes</a></li></ul></li><li><a href="#entities.html_entity-locking">Entity Locking</a><ul class="toc-headings"><li><a href="#entities.html_automatic-optimistic-lock">Automaticoptimistic lock</a></li><li><a href="#entities.html_pessimistic-lock">Pessimisticlock</a></li><li><a href="#entities.html_concurrent-use-of-4d-classic-locks-and-orda-pessimistic-locks">Concurrent use of 4D classic locks and ORDA pessimisticlocks</a></li></ul></li></ul></nav></div></div></body></html>