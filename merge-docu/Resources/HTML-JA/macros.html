<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE html><html lang="ja"><head><meta content="19 R5" name="docsearch:version" /><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><title>フォームエディターマクロ · 4D Documentation</title><meta content="width=device-width" name="viewport" /><meta content="Docusaurus" name="generator" /><meta content="4D のフォームエディターはマクロをサポートしています。 1つ以上のアクションを実行するための指示をマクロと呼びます。 呼び出されると、マクロは登録された指示を実行し、自動的に指定のアクションをおこないます。"name="description" /><meta content="ja" name="docsearch:language" /><meta content="フォームエディターマクロ · 4D Documentation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://4d.github.io/docs/Rx/index.html" property="og:url" /><meta content="4D のフォームエディターはマクロをサポートしています。 1つ以上のアクションを実行するための指示をマクロと呼びます。 呼び出されると、マクロは登録された指示を実行し、自動的に指定のアクションをおこないます。"property="og:description" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png"property="og:image" /><meta content="summary" name="twitter:card" /><meta content="https://4d.github.io/docs/Rx/img/logohome.png" name="twitter:image" /><link href="https://developer.4d.com/docs/Rx/img/4d.gif" rel="shortcut icon" /><link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/routeros.min.css"rel="stylesheet" /><link href="https://developer.4d.com/docs/Rx/css/main.css" rel="stylesheet" /></head><body class="sideNavVisible separateOnPageNav"><div class="navPusher" style="padding-top:0px!important;"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="#macros.md" rel="noreferrer noopener" target="_blank">Edit</a><h1 class="postHeaderTitle" id="__docusaurus">フォームエディターマクロ<a aria-hidden="true" class="anchor" id="macros.html"></a></h1></header><article><div><p><span>4D のフォームエディターはマクロをサポートしています。1つ以上のアクションを実行するための指示をマクロと呼びます。呼び出されると、マクロは登録された指示を実行し、自動的に指定のアクションをおこないます。</span></p><p><span>たとえば、定期レポートに特定のフォーマットが指定されている場合 (例:テキストによってフォントカラーが赤や緑であるなど)、マクロを作成してフォントカラーの設定を自動でおこなうことができます。4Dフォームエディターのマクロでは、次のことがおこなえます:</span></p><ul><li><span>4Dコードを作成・実行する</span></li><li><span>ダイアログを表示する</span></li><li><span>オブジェクトを選択する</span></li><li><span>フォームやフォームオブジェクトおよびそれらのプロパティを追加・編集・削除する</span></li><li><span>プロジェクトファイルを編集する (更新・削除)</span></li></ul><p><span>フォームエディター用のカスタム機能を定義するため、マクロコードは <a href="#classes.html">クラス関数</a> と <a href="#propertiesReference.html">JSON のフォームオブジェクトプロパティ</a>を使用できます。</span></p><p><span>ホストプロジェクトおよび、プロジェクト内のコンポーネントにてマクロを定義することができます。通常は開発用のコンポーネントにマクロをインストールして使用します。</span></p><p><span>マクロが呼び出されると、指定されている既存の動作はマクロによってオーバーライドされます。</span></p><h2><span><a aria-hidden="true" class="anchor" id="macros.html_%E4%BE%8B%E9%A1%8C"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</span></h2><p><span>フォームの左上に "Hello World" アラートボタンを追加するマクロを作成します。</span></p><ol><li><span>プロジェクトの <code>Sources</code> フォルダー内に配置された<code>formMacros.json</code> ファイルに、次のように書きます:</span></li></ol><pre><span><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {      <span class="hljs-string">"Add Hello World button"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AddButton"</span>     }   }}</code></span></pre><ol start="2"><li><p>次に、<code>AddButton</code> という名前の 4Dクラスを作成します。</p></li><li><p><code>AddButton</code> クラスに次の関数を定義します:</p></li></ol><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$btnHello </span>: Object    <span class="hljs-comment">// "Hello" ボタンを作成します</span>    <span class="hljs-variable">$btnHello</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"type"</span>; <span class="hljs-string">"button"</span>; \    <span class="hljs-string">"text"</span>; <span class="hljs-string">"Hello World!"</span>; \    <span class="hljs-string">"method"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"source"</span>; <span class="hljs-string">"ALERT(\"Hello World!\")"</span>); \    <span class="hljs-string">"events"</span>;<span class="hljs-function"> New collection</span>(<span class="hljs-string">"onClick"</span>); \    <span class="hljs-string">"width"</span>; <span class="hljs-number">120</span>; \    <span class="hljs-string">"height"</span>; <span class="hljs-number">20</span>; \    <span class="hljs-string">"top"</span>; <span class="hljs-number">0</span>; \    <span class="hljs-string">"left"</span>; <span class="hljs-number">0</span>)      <span class="hljs-comment">// 現在のページにボタンを追加します</span>    <span class="hljs-variable">$editor</span>.editor.currentPage.objects.btnHello:=<span class="hljs-variable">$btnHello  </span>    <span class="hljs-comment">// フォームエディター上で新規作成したボタンを選択します</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">clear</span>() <span class="hljs-comment">//unselect elements</span>    <span class="hljs-variable">$editor</span>.editor.currentSelection.<span class="hljs-function">push</span>(<span class="hljs-string">"btnHello"</span>)        <span class="hljs-comment">// 4D に変更内容を通知します</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentSelection"</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection;\          <span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><p>マクロを呼び出します: <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex1.png" /> <img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroex2.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%83%BC%E3%81%A7%E3%83%9E%E3%82%AF%E3%83%AD%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E3%2583%2595%25E3%2582%25A9%25E3%2583%25BC%25E3%2583%25A0%25E3%2582%25A8%25E3%2583%2587%25E3%2582%25A3%25E3%2582%25BF%25E3%2583%25BC%25E3%2581%25A7%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2582%2592%25E5%2591%25BC%25E3%2581%25B3%25E5%2587%25BA%25E3%2581%2599"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>フォームエディターでマクロを呼び出す</h2><p>4Dプロジェクトにマクロが定義されていると、フォームエディターのコンテキストメニューを使ってマクロを呼び出すことができます:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroSelect.png" /></p><p>このメニューは <code>formMacros.json</code> <a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2583%2595%25E3%2582%25A1%25E3%2582%25A4%25E3%2583%25AB%25E3%2581%25AE%25E5%25A0%25B4%25E6%2589%2580">マクロ定義ファイル</a> をもとに作成されています。 マクロメニュー項目はABC順に表示されます。</p><p>このメニューは、フォームエディター内で右クリックにより開くことができます。選択オブジェクトがある状態や、フォームオブジェクトの上でマクロを呼び出した場合は、それらのオブジェクト名がマクロの <a href="#macros.html_oninvoke"><code>onInvoke</code></a> 関数の<code>$editor.currentSelection</code> や <code>$editor.target</code>パラメーターに受け渡されます。</p><p>1つのマクロによって複数の処理を実行することができます。 マクロで実行した処理は、フォームエディターの<strong>取り消し</strong> 機能でもとに戻すことができます。</p><h2><a aria-hidden="true" class="anchor" id="macros.html_%E3%83%9E%E3%82%AF%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%A0%B4%E6%89%80"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2583%2595%25E3%2582%25A1%25E3%2582%25A4%25E3%2583%25AB%25E3%2581%25AE%25E5%25A0%25B4%25E6%2589%2580"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>マクロファイルの場所</h2><p>4Dフォームエディターマクロは、プロジェクトあるいはコンポーネントごとに 1つの JSONファイルによって定義されます:<code>FormMacros.json</code>。</p><p>このファイルは、ホストまたはコンポーネントプロジェクトの <strong>Project</strong> &gt;<strong>Sources</strong> フィルダーに配置しなければなりません:</p><p><img alt="" src="https://developer.4d.com/docs/Rx/assets/en/FormEditor/macroStructure.png" /></p><h2><a aria-hidden="true" class="anchor" id="macros.html_%E3%83%9E%E3%82%AF%E3%83%AD%E3%81%AE%E5%AE%A3%E8%A8%80"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2581%25AE%25E5%25AE%25A3%25E8%25A8%2580"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>マクロの宣言</h2><p><code>formMacros.json</code> ファイルの構造は次の通りです:</p><pre><code class="hljs css language-js">{    <span class="hljs-string">"macros"</span>: {            &lt;macroName&gt;: {                <span class="hljs-string">"class"</span>: &lt;className&gt;,                &lt;customProperty&gt; : &lt;value&gt;        }    }}</code></pre><p>JSONファイルの説明です:</p><table><thead><tr><th>属性</th><th></th><th></th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>macros</td><td></td><td></td><td>object</td><td>定義されたマクロのリスト</td></tr><tr><td></td><td><code>&lt;macroName&gt;</code></td><td></td><td>object</td><td>マクロ定義</td></tr><tr><td></td><td></td><td>class</td><td>string</td><td>マクロクラス名</td></tr><tr><td></td><td></td><td><code>&lt;customProperty&gt;</code></td><td>any</td><td>(任意) コンストラクターによって取得するカスタム値</td></tr></tbody></table><p>カスタムプロパティはマクロの <a href="#macros.html_class-constructor">constructor</a> 関数に受け渡されます。</p><h3><a aria-hidden="true" class="anchor" id="macros.html_%E4%BE%8B%E9%A1%8C-1"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C-1"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h3><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"Open Macros file"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"OpenMacro"</span>     },     <span class="hljs-string">"Align to Right on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"right"</span>     },     <span class="hljs-string">"Align to Left on Target Object"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><h2><a aria-hidden="true" class="anchor" id="macros.html_%E3%83%9E%E3%82%AF%E3%83%AD%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E5%8C%96"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2581%25AE%25E3%2582%25A4%25E3%2583%25B3%25E3%2582%25B9%25E3%2582%25BF%25E3%2583%25B3%25E3%2582%25B9%25E5%258C%2596"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>マクロのインスタンス化</h2><p>プロジェクトおよびコンポーネントにおいてインスタンス化するマクロは、それぞれ <a href="#classes.html">4Dクラス</a> として宣言する必要があります。</p><p>クラスの名称は、<code>formMacros.json</code> ファイルで <a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2581%25AE%25E5%25AE%25A3%25E8%25A8%2580">class</a> 属性に定義した名前と同一でなくてはなりません。</p><p>マクロは、アプリケーションの起動時にインスタンス化されます。そのため、関数の追加やパラメーターの編集など、マクロクラスになんらかの変更を加えた場合には、それらを反映するにはアプリケーションを再起動する必要があります。</p><h2><a aria-hidden="true" class="anchor" id="macros.html_%E3%83%9E%E3%82%AF%E3%83%AD%E9%96%A2%E6%95%B0"></a><a aria-hidden="true"class="hash-link" href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E9%2596%25A2%25E6%2595%25B0"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>マクロ関数</h2><p>マクロクラスは、1つの <code>Class constructor</code>のほかに、<code>onInvoke()</code> および <code>onError()</code> という2つの関数を持つことができます。</p><h3><a aria-hidden="true" class="anchor" id="macros.html_class-constructor"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructor"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_class-constructormacro--object"></a><a aria-hidden="true" class="hash-link" href="#macros.html_class-constructormacro--object"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>Class constructor($macro : Object)</h4><table><thead><tr><th>引数</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>$macro</td><td>オブジェクト</td><td><code>formMacros.json</code> ファイルのマクロ宣言オブジェクト</td></tr></tbody></table><p><a href="#macros.html_class-constructor">Class constructor</a>関数が定義されている場合、マクロはそれによってインスタンス化されます。</p><p>アプリケーションの起動時にクラスがインスタンス化される際に、このコンストラクターが呼び出されます。</p><p><a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2581%25AE%25E5%25AE%25A3%25E8%25A8%2580">マクロの宣言</a> に追加したカスタムプロパティは、クラスコンストラクターが引数として受け取ります。</p><h4><a aria-hidden="true" class="anchor" id="macros.html_%E4%BE%8B%E9%A1%8C-2"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C-2"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><p><code>formMacros.json</code> ファイルに次のようなマクロ宣言をした場合:</p><pre><code class="hljs css language-js">{   <span class="hljs-string">"macros"</span>: {     <span class="hljs-string">"最後に選択したオブジェクトを基準に左揃え"</span>: {       <span class="hljs-string">"class"</span>: <span class="hljs-string">"AlignOnTarget"</span>,       <span class="hljs-string">"myParam"</span>: <span class="hljs-string">"left"</span>     }   }}</code></pre><p>以下のように書くことができます:</p><pre><code class="hljs css language-4d"><span class="hljs-comment">// クラス "AlignOnTarget"</span><span class="hljs-keyword">Class constructor</span>(<span class="hljs-variable">$macro </span>: Object)    <span class="hljs-literal">This</span>.myParameter:=<span class="hljs-variable">$macro</span>.myParam <span class="hljs-comment">// left    ...</span></code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_oninvoke"></a><a aria-hidden="true" class="hash-link"href="#macros.html_oninvoke"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_oninvokeeditor--object---result--object"></a><a aria-hidden="true"class="hash-link" href="#macros.html_oninvokeeditor--object---result--object"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onInvoke($editor : Object) -&gt; $result : Object</h4><table><thead><tr><th>引数</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>$editor</td><td>オブジェクト</td><td>フォームプロパティを格納する Form Editor Macro Proxy オブジェクト</td></tr><tr><td>$result</td><td>オブジェクト</td><td>マクロによって変更されたフォームプロパティ (任意)</td></tr></tbody></table><p>マクロが呼び出されるたびに、<code>onInvoke</code> 関数が自動的に実行されます。</p><p>呼び出しの際、関数は <code>$editor.editor</code>プロパティに、フォームの全要素とそれらの現在値のコピーを受け取ります。つまり、これらのプロパティに対して、任意の処理を実行することができます。</p><p>マクロによってオブジェクトを変更・追加・削除した場合、操作を反映させるには最後に結果のプロパティを<code>$result</code> に返します。 返されたプロパティは解析され、フォームに対して変更が適用されます。戻り値に含まれるプロパティが少ないほど、この処理にかかる時間も削減されます。</p><p><em>$editor</em> 引数にて渡されるプロパティは次の通りです:</p><table><thead><tr><th>プロパティ</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>$editor.editor.form</td><td>オブジェクト</td><td>フォーム全体</td></tr><tr><td>$editor.editor.file</td><td>File</td><td>フォームファイルの Fileオブジェクト</td></tr><tr><td>$editor.editor.name</td><td>String</td><td>フォームの名称</td></tr><tr><td>$editor.editor.table</td><td>number</td><td>フォームのテーブル番号。プロジェクトフォームの場合は 0。</td></tr><tr><td>$editor.editor.currentPageNumber</td><td>number</td><td>現在のページの番号</td></tr><tr><td>$editor.editor.currentPage</td><td>オブジェクト</td><td>現在のページ (フォームオブジェクトおよび入力順序を格納)</td></tr><tr><td>$editor.editor.currentSelection</td><td>コレクション</td><td>選択されているオブジェクトの名称のコレクション</td></tr><tr><td>$editor.editor.formProperties</td><td>オブジェクト</td><td>カレントフォームのプロパティ</td></tr><tr><td>$editor.editor.target</td><td>string</td><td>マクロ呼び出し時にマウスカーソルが置かれているオブジェクトの名称</td></tr></tbody></table><p>マクロによる変更をフォームに反映させたい場合に、<code>$result</code>オブジェクトに渡せるプロパティの一覧です。 いずれのプロパティも任意です:</p><table><thead><tr><th>プロパティ</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>currentPage</td><td>オブジェクト</td><td>マクロによって変更されたオブジェクトを含む currentPage</td></tr><tr><td>currentSelection</td><td>コレクション</td><td>マクロによって変更された currentSelection</td></tr><tr><td>formProperties</td><td>オブジェクト</td><td>マクロによって変更された formProperties</td></tr><tr><td>editor.groups</td><td>オブジェクト</td><td>マクロによって変更されたグループ情報</td></tr><tr><td>editor.views</td><td>オブジェクト</td><td>マクロによって変更されたビュー情報</td></tr><tr><td>editor.activeView</td><td>String</td><td>有効なビュー名</td></tr></tbody></table><p>たとえば、currentPage と editor.groupsの内容が変わった場合には、戻り値を次のように設定します:</p><pre><code class="hljs css language-4d">    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage ; \             <span class="hljs-string">"editor"</span>;<span class="hljs-function"> New object</span>(<span class="hljs-string">"groups"</span>; <span class="hljs-variable">$editor</span>.editor.form.editor.groups))</code></pre><h4><a aria-hidden="true" class="anchor" id="macros.html_method-%E5%B1%9E%E6%80%A7"></a><a aria-hidden="true"class="hash-link" href="#macros.html_method-%25E5%25B1%259E%25E6%2580%25A7"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a><code>method</code> 属性</h4><p>フォームオブジェクトの <code>method</code> 属性を操作する場合、属性値は2通りの方法で定義できます:</p><ul><li><p><a href="#macros.html_%25E3%2583%25A1%25E3%2582%25BD%25E3%2583%2583%25E3%2583%2589">メソッドファイル名あるいはパスを指定する文字列</a> の使用</p></li><li><p>次の構造を持つオブジェクトの使用:</p></li></ul><table><thead><tr><th>プロパティ</th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td>source</td><td>文字列</td><td>メソッドコード</td></tr></tbody></table><p>後者の場合、4D は "objectMethods"フォルダー内に当該オブジェクト名を冠したファイルを作成し、<code>source</code>属性に指定したメソッドコードを格納します。 この機能はマクロコードの場合にのみ有効です。</p><h4><a aria-hidden="true" class="anchor" id="macros.html_currentpageobjects-%E3%81%AE-4did-%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3"></a><a aria-hidden="true" class="hash-link" href="#macros.html_currentpageobjects-%25E3%2581%25AE-4did-%25E3%2583%2597%25E3%2583%25AD%25E3%2583%2591%25E3%2583%2586%25E3%2582%25A3"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a><code>currentPage.objects</code> の <code>$4dId</code>プロパティ</h4><p><code>$4dId</code> プロパティは、現在のページにある各オブジェクトについて一意のIDを定義します。このキーは<code>$result.currentPage</code> の変更を反映させるのに使用されます:</p><ul><li>フォーム上および <code>$result</code> 内のオブジェクトの両方で <code>$4dId</code>キーが存在しない場合、そのオブジェクトは作成されます。</li><li>フォーム上で存在する <code>$4dId</code> キーが、<code>$result</code>内には存在しない場合、当該オブジェクトは削除されます。</li><li>フォーム上および <code>$result</code> 内のオブジェクトの両方で <code>$4dId</code>キーが存在する場合、そのオブジェクトは変更されます。</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_%E4%BE%8B%E9%A1%8C-3"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C-3"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><p>選択されているオブジェクトに対して、フォントカラーを赤に、フォントスタイルをイタリックに変更するマクロ関数を定義します。</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onInvoke</span>(<span class="hljs-variable">$editor </span>: Object)-&gt;<span class="hljs-variable">$result </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$name </span>: Text<span class="hljs-keyword">    If</span> (<span class="hljs-variable">$editor</span>.editor.currentSelection.length&gt;<span class="hljs-number">0</span>)               <span class="hljs-comment">// 選択されている各オブジェクトの stroke 属性を red に、style 属性を italic に設定します</span><span class="hljs-keyword">        For each</span> (<span class="hljs-variable">$name</span>; <span class="hljs-variable">$editor</span>.editor.currentSelection)            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].stroke:=<span class="hljs-string">"red"</span>            <span class="hljs-variable">$editor</span>.editor.currentPage.objects[<span class="hljs-variable">$name</span>].fontStyle:=<span class="hljs-string">"italic"</span><span class="hljs-keyword">        End for each</span><span class="hljs-keyword">     Else</span> <span class="hljs-function">        ALERT</span>(<span class="hljs-string">"フォームオブジェクトを選択してください。"</span>)<span class="hljs-keyword">    End if</span>     <span class="hljs-comment">// 4Dに変更を通知します</span>    <span class="hljs-variable">$result</span>:=<span class="hljs-function">New object</span>(<span class="hljs-string">"currentPage"</span>; <span class="hljs-variable">$editor</span>.editor.currentPage)</code></pre><h3><a aria-hidden="true" class="anchor" id="macros.html_onerror"></a><a aria-hidden="true" class="hash-link"href="#macros.html_onerror"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16"width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError()</h3><h4><a aria-hidden="true" class="anchor" id="macros.html_onerroreditor--object-resultmacro--object--error--collection"></a><a aria-hidden="true" class="hash-link" href="#macros.html_onerroreditor--object-resultmacro--object--error--collection"><svg aria-hidden="true"class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>onError($editor : Object; $resultMacro : Object ; $error: Collection)</h4><table><thead><tr><th>引数</th><th></th><th>タイプ</th><th>説明</th></tr></thead><tbody><tr><td>$editor</td><td></td><td>オブジェクト</td><td><a href="#macros.html_oninvoke">onInvoke</a> に渡されたオブジェクト</td></tr><tr><td>$resultMacro</td><td></td><td>オブジェクト</td><td><a href="#macros.html_oninvoke">onInvoke</a>によって返されたオブジェクト</td></tr><tr><td>$error</td><td></td><td>コレクション</td><td>エラースタック</td></tr><tr><td></td><td>[].errCode</td><td>数値</td><td>エラーコード</td></tr><tr><td></td><td>[].message</td><td>テキスト</td><td>エラーの詳細</td></tr><tr><td></td><td>[].componentSignature</td><td>テキスト</td><td>内部コンポーネントのシグネチャー</td></tr></tbody></table><p>マクロの実行時にエラーが発生した場合、<code>onError</code> 関数が実行されます。</p><p>マクロの実行時に発生したエラーが、マクロの取り消しを不可能にする内容の場合、マクロは実行されません。たとえば次のような場合が該当します:</p><ul><li>読み取り専用ファイルのスクリプトを変更・削除しようとしたとき</li><li>同じ内部ID を持つオブジェクトを複数作成しようとしたとき</li></ul><h4><a aria-hidden="true" class="anchor" id="macros.html_%E4%BE%8B%E9%A1%8C-4"></a><a aria-hidden="true" class="hash-link" href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C-4"><svg aria-hidden="true" class="hash-link-icon" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"fill-rule="evenodd"></path></svg></a>例題</h4><p>マクロクラス定義に、次のような汎用的なエラーコードを書くことができます:</p><pre><code class="hljs css language-4d"><span class="hljs-keyword">Function</span><span class="hljs-function"> onError</span>(<span class="hljs-variable">$editor </span>: Object; <span class="hljs-variable">$resultMacro </span>: Object; <span class="hljs-variable">$error </span>: Collection)<span class="hljs-keyword">    var</span> <span class="hljs-variable">$obj </span>: Object<span class="hljs-keyword">    var</span> <span class="hljs-variable">$txt </span>: Text    <span class="hljs-variable">$txt</span>:=<span class="hljs-string">""</span><span class="hljs-keyword">    For each</span> (<span class="hljs-variable">$obj</span>; <span class="hljs-variable">$error</span>)        <span class="hljs-variable">$txt</span>:=<span class="hljs-variable">$txt</span>+<span class="hljs-variable">$obj</span>.message+<span class="hljs-string">" \n"</span><span class="hljs-keyword">    End for each</span> <span class="hljs-function">    ALERT</span>(<span class="hljs-variable">$txt</span>)</code></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="#formEditor.html"><span class="arrow-prev">←</span><span>フォームエディター</span></a><a class="docs-next button" href="#objectLibrary.html"><span>オブジェクトライブラリ</span> <span class="arrow-next">→</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C">例題</a></li><li><a href="#macros.html_%25E3%2583%2595%25E3%2582%25A9%25E3%2583%25BC%25E3%2583%25A0%25E3%2582%25A8%25E3%2583%2587%25E3%2582%25A3%25E3%2582%25BF%25E3%2583%25BC%25E3%2581%25A7%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2582%2592%25E5%2591%25BC%25E3%2581%25B3%25E5%2587%25BA%25E3%2581%2599">フォームエディターでマクロを呼び出す</a></li><li><a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2583%2595%25E3%2582%25A1%25E3%2582%25A4%25E3%2583%25AB%25E3%2581%25AE%25E5%25A0%25B4%25E6%2589%2580">マクロファイルの場所</a></li><li><a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2581%25AE%25E5%25AE%25A3%25E8%25A8%2580">マクロの宣言</a><ul class="toc-headings"><li><a href="#macros.html_%25E4%25BE%258B%25E9%25A1%258C-1">例題</a></li></ul></li><li><a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E3%2581%25AE%25E3%2582%25A4%25E3%2583%25B3%25E3%2582%25B9%25E3%2582%25BF%25E3%2583%25B3%25E3%2582%25B9%25E5%258C%2596">マクロのインスタンス化</a></li><li><a href="#macros.html_%25E3%2583%259E%25E3%2582%25AF%25E3%2583%25AD%25E9%2596%25A2%25E6%2595%25B0">マクロ関数</a><ul class="toc-headings"><li><a href="#macros.html_class-constructor">Classconstructor</a></li><li><a href="#macros.html_oninvoke">onInvoke()</a></li><li><a href="#macros.html_onerror">onError()</a></li></ul></li></ul></nav></div></div></body></html>